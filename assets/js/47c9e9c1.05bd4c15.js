"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[2558],{34590:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var r=i(53416),t=i(25105),a=i(89999);const o={slug:"spring-ai-alibaba-observations",title:"Spring AI \u53ef\u89c2\u6d4b\u6027",date:new Date("2025-03-30T13:07:00.000Z"),authors:"yuluo",tags:["Spring AI observations","ZipKin"],keywords:["Spring AI observations","grafana","prometheus"],image:"/img/ai/observations/1.png"},s=void 0,l={authorsImageUrls:[void 0]},p=[{value:"Spring AI \u53ef\u89c2\u6d4b Example",id:"spring-ai-\u53ef\u89c2\u6d4b-example",level:2},{value:"Zipkin",id:"zipkin",level:3},{value:"\u4ee3\u7801\u548c\u73af\u5883\u51c6\u5907",id:"\u4ee3\u7801\u548c\u73af\u5883\u51c6\u5907",level:4},{value:"\u6548\u679c\u6f14\u793a",id:"\u6548\u679c\u6f14\u793a",level:4},{value:"\u8bbf\u95ee\u63a5\u53e3",id:"\u8bbf\u95ee\u63a5\u53e3",level:5},{value:"zipkin \u67e5\u770b\u8bf7\u6c42",id:"zipkin-\u67e5\u770b\u8bf7\u6c42",level:5},{value:"prometheus + Grafana",id:"prometheus--grafana",level:3},{value:"\u4ee3\u7801\u548c\u73af\u5883\u51c6\u5907",id:"\u4ee3\u7801\u548c\u73af\u5883\u51c6\u5907-1",level:4},{value:"\u6548\u679c\u6f14\u793a",id:"\u6548\u679c\u6f14\u793a-1",level:4}];function c(n){const e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:"Spring AI \u901a\u8fc7\u96c6\u6210 micrometer \u6765\u5b8c\u6210 Model \u4e2d\u89c2\u6d4b\u80fd\u529b\u3002MicroMeter \u672c\u8eab\u652f\u6301\u5bf9 otel\uff0czipkin \u7b49\u591a\u79cd\u5f62\u5f0f\u7684\u6570\u636e\u683c\u5f0f\u7684\u5bfc\u51fa\u3002\u6b64\u6587\u4e2d\u901a\u8fc7 zipkin \u548c grafana \u7684\u65b9\u5f0f\u6f14\u793a Spring AI \u7684\u53ef\u89c2\u6d4b\u529f\u80fd\u3002"}),"\n",(0,t.jsxs)(e.p,{children:["Github \u4ee3\u7801\u5730\u5740\uff1a",(0,t.jsx)(e.a,{href:"https://github.com/deigmata-paideias/deigmata-paideias/tree/main/ai/observations",children:"https://github.com/deigmata-paideias/deigmata-paideias/tree/main/ai/observations"})]}),"\n",(0,t.jsx)(e.h2,{id:"spring-ai-\u53ef\u89c2\u6d4b-example",children:"Spring AI \u53ef\u89c2\u6d4b Example"}),"\n",(0,t.jsx)(e.h3,{id:"zipkin",children:"Zipkin"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u4e5f\u53ef\u4ee5\u4f7f\u7528 jaeger \u4ee3\u66ff zipkin\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"\u4ee3\u7801\u548c\u73af\u5883\u51c6\u5907",children:"\u4ee3\u7801\u548c\u73af\u5883\u51c6\u5907"}),"\n",(0,t.jsx)(e.p,{children:"\u5f15\u5165 micrometer \u548c zipkin \u4f9d\u8d56\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-xml",children:"<dependencies>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-web</artifactId>\n        <version>3.4.2</version>\n    </dependency>\n\n    <dependency>\n        <groupId>com.alibaba.cloud.ai</groupId>\n        <artifactId>spring-ai-alibaba-starter</artifactId>\n        <version>1.0.0-M6.1</version>\n    </dependency>\n\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-actuator</artifactId>\n        <version>3.4.2</version>\n    </dependency>\n\n    <dependency>\n        <groupId>io.micrometer</groupId>\n        <artifactId>micrometer-tracing-bridge-brave</artifactId>\n        <version>1.5.0-M2</version>\n        <exclusions>\n            <exclusion>\n                <artifactId>slf4j-api</artifactId>\n                <groupId>org.slf4j</groupId>\n            </exclusion>\n        </exclusions>\n    </dependency>\n\n    <dependency>\n        <groupId>io.zipkin.reporter2</groupId>\n        <artifactId>zipkin-reporter-brave</artifactId>\n        <version>3.4.3</version>\n    </dependency>\n\n</dependencies>\n"})}),"\n",(0,t.jsx)(e.p,{children:"application.yml \u914d\u7f6e"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u914d\u7f6e Spring AI \u53ef\u89c2\u6d4b\u6027\u7684\u914d\u7f6e\u5f00\u5173\u548c actuator \u7684 endpoint \u76f8\u5173\u914d\u7f6e\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u5e76\u6ca1\u6709\u914d\u7f6e apikey\uff0cspring ai alibaba starter \u4f1a\u9ed8\u8ba4\u5728\u73af\u5883\u53d8\u91cf\u91cc\u67e5\u8be2\u76f8\u5173 key\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yml",children:' spring:\n  ai:\n\t# \u6ce8\u610f\uff1a\u89c2\u6d4b\u6570\u636e\u53ef\u80fd\u5b58\u5728\u654f\u611f\u4fe1\u606f\uff01\n    chat:\n      client:\n        observations:\n          # \u8bb0\u5f55\u8c03\u7528\u8f93\u5165\n          include-input: true\n      observations:\n        # \u8bb0\u5f55 LLMs \u8f93\u51fa\n        include-completion: true\n        # \u8bb0\u5f55 prompt\n        include-prompt: true\n        include-error-logging: true\n\n# \u90e8\u7f72\u65f6\u4e0d\u914d\u7f6e\uff0c\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        # \u5f00\u653e\u6240\u6709\u5916\u90e8\u7aef\u70b9\n        include: "*"\n  endpoint:\n    health:\n      # \u5e94\u7528\u5065\u5eb7\u72b6\u6001\u68c0\u67e5\uff0c\u643a\u5e26\u8be6\u7ec6\u65b0\u5b66\u5e74\n      show-details: always\n  tracing:\n    sampling:\n        # trace \u91c7\u6837\u4fe1\u606f\uff0c\u8bb0\u5f55\u6bcf\u4e2a\u8bf7\u6c42\n        probability: 1.0\n'})}),"\n",(0,t.jsx)(e.p,{children:"docker compose zipkin"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u672c\u4f8b\u4e2d\u5c06\u76d1\u63a7\u6570\u636e\u5bfc\u5165\u5230 zipkin"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yml",children:"services:\n\n  zipkin:\n    image: 'openzipkin/zipkin:latest'\n    container_name: \"sa-zipkin\"\n    ports:\n      - '9411:9411'\n"})}),"\n",(0,t.jsx)(e.p,{children:"chat \u5e94\u7528"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:'@RestController\n@RequestMapping("/chat")\npublic class ChatController {\n\n\tprivate final ChatClient client;\n\n\tprivate ChatController(ChatModel model) {\n\n\t\tthis.client = ChatClient.builder(model)\n\t\t\t\t.build();\n\t}\n\n\t@GetMapping\n\tpublic Flux<String> chat(\n\t\t\t@RequestParam("prompt") String prompt,\n\t\t\tHttpServletResponse response\n\t) {\n\n\t\tresponse.setCharacterEncoding("UTF-8");\n\t\treturn client.prompt()\n\t\t\t\t.user(prompt)\n\t\t\t\t.stream()\n\t\t\t\t.content();\n\t}\n}\n'})}),"\n",(0,t.jsx)(e.h4,{id:"\u6548\u679c\u6f14\u793a",children:"\u6548\u679c\u6f14\u793a"}),"\n",(0,t.jsx)(e.h5,{id:"\u8bbf\u95ee\u63a5\u53e3",children:"\u8bbf\u95ee\u63a5\u53e3"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-shell",children:"# request\ncurl http://localhost:8080/chat?prompt=\u4f60\u597d\n\n# response\n\u4f60\u597d\uff01\u4eca\u5929\u8fc7\u5f97\u600e\u4e48\u6837\uff1f\n"})}),"\n",(0,t.jsx)(e.h5,{id:"zipkin-\u67e5\u770b\u8bf7\u6c42",children:"zipkin \u67e5\u770b\u8bf7\u6c42"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{alt:"zipkin",src:i(48967).A+"",width:"1908",height:"893"})}),"\n",(0,t.jsx)(e.p,{children:"\u53ef\u4ee5\u770b\u5230\uff0c\u8bf7\u6c42\u7684\u76f8\u5173\u4fe1\u606f\u5df2\u7ecf\u6253\u5370\u5230\u4e86 zipkin \u63a7\u5236\u53f0\u3002"}),"\n",(0,t.jsx)(e.h3,{id:"prometheus--grafana",children:"prometheus + Grafana"}),"\n",(0,t.jsx)(e.h4,{id:"\u4ee3\u7801\u548c\u73af\u5883\u51c6\u5907-1",children:"\u4ee3\u7801\u548c\u73af\u5883\u51c6\u5907"}),"\n",(0,t.jsx)(e.p,{children:"pom.yml"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u5c06\u4e0a\u9762 zipkin \u7684\u4f9d\u8d56\u66ff\u6362\u4e3a\uff1a"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-web</artifactId>\n    <version>3.4.2</version>\n</dependency>\n\n<dependency>\n    <groupId>com.alibaba.cloud.ai</groupId>\n    <artifactId>spring-ai-alibaba-starter</artifactId>\n    <version>1.0.0-M6.1</version>\n</dependency>\n\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-actuator</artifactId>\n    <version>3.4.2</version>\n</dependency>\n\n<dependency>\n    <groupId>io.micrometer</groupId>\n    <artifactId>micrometer-registry-prometheus</artifactId>\n    <version>1.14.5</version>\n</dependency>\n"})}),"\n",(0,t.jsx)(e.p,{children:"application.yml \u6539\u4e3a\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yml",children:'spring:\n  application:\n    name: "spring-ai-observations-example"\n\n  ai:\n    # \u6ce8\u610f\uff1a\u89c2\u6d4b\u6570\u636e\u53ef\u80fd\u5b58\u5728\u654f\u611f\u4fe1\u606f\uff01\n    chat:\n      client:\n        observations:\n          # \u8bb0\u5f55\u8c03\u7528\u8f93\u5165\n          include-input: true\n      observations:\n        # \u8bb0\u5f55 LLMs \u8f93\u51fa\n        include-completion: true\n        # \u8bb0\u5f55 prompt\n        include-prompt: true\n        include-error-logging: true\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n  endpoint:\n    health:\n      show-details: always\n  tracing:\n    sampling:\n      probability: 1.0\n  prometheus:\n    metrics:\n      export:\n        enabled: true\n  metrics:\n    tags:\n      application: ${spring.application.name}\n'})}),"\n",(0,t.jsx)(e.p,{children:"\u90e8\u7f72 grafana \u548c prometheus \u548c docker-compose.yml"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yml",children:'services:\n\n  prometheus:\n    container_name: "sa-prometheus"\n    hostname: "sa-prometheus"\n    image: prom/prometheus:latest\n    volumes:\n      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml\n    ports:\n      - "9090:9090"\n\n  grafana:\n    image: grafana/grafana\n    hostname: "sa-grafana"\n    container_name: "sa-grafana"\n    ports:\n      - "3000:3000"\n\nnetworks:\n  bridge:\n    driver: bridge\n'})}),"\n",(0,t.jsx)(e.p,{children:"prometheus \u914d\u7f6e\u6587\u4ef6\uff1a(\u5728 docker \u4e2d\u542f\u52a8\u65f6\uff0c\u9700\u8981\u6ce8\u610f job targets \u914d\u7f6e\u6210\u5bbf\u4e3b\u673a\u7684 ipv4 \u5730\u5740\uff0c\u5426\u5219\u4f1a\u8fde\u63a5\u5931\u8d25\uff01)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yml",children:'scrape_configs:\n  - job_name: "prometheus"\n    static_configs:\n      - targets: ["localhost:9090"]\n    # prometheus \u4e0a\u9762\u662f\u9ed8\u8ba4\u7684\u6570\u636e\n\n  # \u6293\u53d6\u4efb\u52a1\u914d\u7f6e\n  - job_name: \'policy-prometheus\'\n    # \u6293\u53d6\u76ee\u6807\u7684\u8def\u5f84,\u5176\u4e2d?\u66ff\u6362\u4e3a\u8981\u76d1\u542c\u7684\u670d\u52a1\u524d\u7f00\u7aef\u53e3\n    # micrometer \u7aef\u70b9\u9ed8\u8ba4\u6ca1\u6709\u524d\u7f00\n    metrics_path: \'/actuator/prometheus\'\n    static_configs:\n      # \u6293\u53d6\u4efb\u52a1\u7684\u76ee\u6807\u5730\u5740\uff0c\u53ef\u4ee5\u4f7f\u7528\u6570\u7ec4\u7684\u5f62\u5f0f\u914d\u7f6e\u591a\u4e2a\u7aef\u53e3\u76d1\u542c\n      - targets: ["192.168.99.117:8080"]\n'})}),"\n",(0,t.jsx)(e.h4,{id:"\u6548\u679c\u6f14\u793a-1",children:"\u6548\u679c\u6f14\u793a"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\u8bbf\u95ee ",(0,t.jsx)(e.a,{href:"http://localhost:8080/actuator/prometheus",children:"http://localhost:8080/actuator/prometheus"})," \u5373\u53ef\u770b\u5230 ai \u5e94\u7528\u66b4\u9732\u7684\u6307\u6807\u4fe1\u606f\uff1b"]}),"\n",(0,t.jsxs)(e.li,{children:["\u8bbf\u95ee prometheus  ",(0,t.jsx)(e.a,{href:"http://localhost:9090/targets?search=",children:"http://localhost:9090/targets?search="})," \u53ef\u4ee5\u770b\u5230 jobs \u4fe1\u606f\uff1b"]}),"\n",(0,t.jsx)(e.li,{children:"\u8bbf\u95ee grafana \uff0c\u5728\u5bfc\u5165\u6570\u636e\u6e90\u548c dashboard \u4e4b\u540e\u53ef\u4ee5\u770b\u5230 metrics \u9762\u677f\u3002"}),"\n"]})]})}function d(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}},48967:(n,e,i)=>{i.d(e,{A:()=>r});const r=i.p+"assets/images/1-d02b4af2c328db059945a3186f222b8d.png"},89999:(n,e,i)=>{i.d(e,{R:()=>o,x:()=>s});var r=i(58101);const t={},a=r.createContext(t);function o(n){const e=r.useContext(a);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),r.createElement(a.Provider,{value:e},n.children)}},53416:n=>{n.exports=JSON.parse('{"permalink":"/blog/spring-ai-alibaba-observations","editUrl":"https://github.com/yuluo-yx/blog/edit/master/blog/AI-large-models/spring-ai-\u53ef\u89c2\u6d4b\u6027.md","source":"@site/blog/AI-large-models/spring-ai-\u53ef\u89c2\u6d4b\u6027.md","title":"Spring AI \u53ef\u89c2\u6d4b\u6027","description":"Spring AI \u901a\u8fc7\u96c6\u6210 micrometer \u6765\u5b8c\u6210 Model \u4e2d\u89c2\u6d4b\u80fd\u529b\u3002MicroMeter \u672c\u8eab\u652f\u6301\u5bf9 otel\uff0czipkin \u7b49\u591a\u79cd\u5f62\u5f0f\u7684\u6570\u636e\u683c\u5f0f\u7684\u5bfc\u51fa\u3002\u6b64\u6587\u4e2d\u901a\u8fc7 zipkin \u548c grafana \u7684\u65b9\u5f0f\u6f14\u793a Spring AI \u7684\u53ef\u89c2\u6d4b\u529f\u80fd\u3002","date":"2025-03-30T13:07:00.000Z","tags":[{"inline":true,"label":"Spring AI observations","permalink":"/blog/tags/spring-ai-observations"},{"inline":true,"label":"ZipKin","permalink":"/blog/tags/zip-kin"}],"readingTime":2.53,"hasTruncateMarker":true,"authors":[{"name":"\u7267\u751f","title":"Java & go developer","url":"https://github.com/yuluo-yx","email":"yuluo08290126@gmail.com","socials":{"x":"https://x.com/yuluo","github":"https://github.com/yuluo-yx"},"imageURL":"https://kuizuo.cn/img/logo.png","key":"yuluo","page":null}],"frontMatter":{"slug":"spring-ai-alibaba-observations","title":"Spring AI \u53ef\u89c2\u6d4b\u6027","date":"2025-03-30T13:07:00.000Z","authors":"yuluo","tags":["Spring AI observations","ZipKin"],"keywords":["Spring AI observations","grafana","prometheus"],"image":"/img/ai/observations/1.png"},"unlisted":false,"nextItem":{"title":"MCP \u4ecb\u7ecd\u548c\u57fa\u672c\u4f7f\u7528","permalink":"/blog/mcp"}}')}}]);