{
    "version": "https://jsonfeed.org/version/1",
    "title": "牧生",
    "home_page_url": "https://yuluo-yx.github.io/blog",
    "description": "feedId:41215011978385457+userId:41840354283324416",
    "items": [
        {
            "id": "https://yuluo-yx.github.io/blog/LLMs-AI-RAG",
            "content_html": "<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"ragretrieval-augmented-generation-介绍\">RAG（Retrieval-Augmented Generation ）介绍<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#ragretrieval-augmented-generation-%E4%BB%8B%E7%BB%8D\" class=\"hash-link\" aria-label=\"RAG（Retrieval-Augmented Generation ）介绍的直接链接\" title=\"RAG（Retrieval-Augmented Generation ）介绍的直接链接\">​</a></h2>\n<p>之前的文章中已经大概介绍了 RAG 是什么，并且介绍到了当前 LLMs 的一些缺点，也是 RAG 技术的背景来源。\n在这篇文章中，将深入挖掘一下 RAG 的技术原理和当前现状。</p>\n<p>首先我们在从头复述一下之前所说的一些关于 RAG 的内容，并对其中的一些描述进一步细化：</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"当前-llms-存在的问题\">当前 LLMs 存在的问题<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#%E5%BD%93%E5%89%8D-llms-%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98\" class=\"hash-link\" aria-label=\"当前 LLMs 存在的问题的直接链接\" title=\"当前 LLMs 存在的问题的直接链接\">​</a></h3>\n<p>随着大模型的发展，其已经被用于到业务场景中。但是目前也存在一些较为突出的问题。</p>\n<ul>\n<li>\n<p>（新鲜度问题）知识缺乏：</p>\n<ol>\n<li>大模型的知识来源于训练数据，这些数据主要来自公开的互联网和开源数据集，无法覆盖特定领域或高度专业化的内部知识。模型难以处理实时信息，因为训练过程耗时严重且成本较高。模型一旦训练完成，就难以获取和处理新信息。</li>\n<li>随着数据越来越多（参数和 Token 越多），大模型的训练成本也越来越高。（目前参数量最大的模型可能是来自于马斯克的 Grok-1 模型，参数量高达 3140 亿。）</li>\n</ol>\n</li>\n<li>\n<p>数据安全：</p>\n<ol>\n<li>因为 GPT模型的数据问题，OpenAI 已经多次收到侵犯隐私数据的投诉。</li>\n<li>在企业内部，数据安全至关重要，没有企业愿意把自身数据上传到第三方平台训练大模型。</li>\n</ol>\n</li>\n<li>\n<p>（幻觉）偏见问题：</p>\n<ol>\n<li>幻觉英文术语成为 Hallucination，既一本正经的话说八道。如果大家经常使用大模型，可能会发现大模型经常返回错误的信息；其来源可能是基于多个基本元素，借助 NLP 能力，生成的看似符合逻辑，但违背<strong>人类认知常理</strong>的输出。</li>\n<li>从某种理论上来说，这种幻觉的表达是某种涌现能力的体现，体现了大模型自身的创造力。举个例子，人做梦的场景，可能是基于白天见到的某类事物引发的，而基于人类白天的认知，我们会自我修正，意识到这是不符合逻辑的。随着 LLMs 的发展，可能人类能自行调整大模型的 input 控制大模型的涌现能力。</li>\n</ol>\n</li>\n</ul>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"rag\">RAG<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#rag\" class=\"hash-link\" aria-label=\"RAG的直接链接\" title=\"RAG的直接链接\">​</a></h3>\n<p>基于上面描述的 LLMs 的缺点，RAG 技术应用而生，不能说是最好的解决方案，但是是目前最有效的解决方案。</p>\n<p>RAG：全程是 Retrieval Augmented Generation，中文译为检索增强生成。从名字中我们可以看到他的实现逻辑是</p>\n<p>$$\n检索 -&gt; 增强 -&gt; 生成\n$$</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"RAG 工作逻辑\" src=\"https://yuluo-yx.github.io/assets/images/1-809896362cff8c587947d16ee737f886.png\" width=\"2126\" height=\"676\" class=\"img_c29J\"></p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"检索\">检索<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#%E6%A3%80%E7%B4%A2\" class=\"hash-link\" aria-label=\"检索的直接链接\" title=\"检索的直接链接\">​</a></h4>\n<p>检索流程示意图：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"RAG 检索\" src=\"https://yuluo-yx.github.io/assets/images/retrieval-8a2b74a3cc6ab3a030fa7046ea866710.jpg\" width=\"1490\" height=\"598\" class=\"img_c29J\"></p>\n<p>从上面看到，RAG 检索分为两部分，一是数据预处理，二是向量数据检索。</p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"向量化\">向量化<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#%E5%90%91%E9%87%8F%E5%8C%96\" class=\"hash-link\" aria-label=\"向量化的直接链接\" title=\"向量化的直接链接\">​</a></h5>\n<p>我们先来了解一下什么是向量化，以及为什么要向量化？</p>\n<p>正如示意图中描述的那样：向量化是为了将数据转化成计算机可以识别的数据形式。</p>\n<p>向量是一个线性代数中的数学名词，在不同的学科有不同的含义。在计算机领域中表示的是一个有序列表。在 AI 领域中，将文本数据转换成向量的过程就像把书里的文字变成一种特殊的密码，让计算机能够读懂和处理。</p>\n<p>向量 Embedding 的核心是指在数学空间中将单词、句子甚至整个文档表示为密集的低维向量的过程。其封装了单词之间的语义关系，语义相似的词在向量空间中越近，并使算法能够理解它们的上下文含义。让 LLMs 能够利用嵌入在文本数据中的丰富语义信息，生成更连贯和上下文更合适的响应。</p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"向量对大模型的影响\">向量对大模型的影响<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#%E5%90%91%E9%87%8F%E5%AF%B9%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BD%B1%E5%93%8D\" class=\"hash-link\" aria-label=\"向量对大模型的影响的直接链接\" title=\"向量对大模型的影响的直接链接\">​</a></h5>\n<p>向量在 LLMs 中的主要应用方式体现为向量数据库，对解决 LLMs 的幻觉问题有很大的帮助。也被成为 LLMs 的外脑。</p>\n<p>例如，对应下面的三句话：</p>\n<ul>\n<li>“The cat chases the mouse” 猫追逐老鼠。</li>\n<li>“The kitten hunts rodents” 小猫捕猎老鼠。</li>\n<li>“I like ham sandwiches” 我喜欢火腿三明治。</li>\n</ul>\n<p>其在向量空间的表示可能为：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"向量空间表示\" src=\"https://yuluo-yx.github.io/assets/images/vector-7d2592dfc83acb8624714d2f5d73f95b.jpg\" width=\"668\" height=\"498\" class=\"img_c29J\"></p>\n<p>LLMs 在处理时那能够理解他们的语义相关性。</p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"张量探索-引用-1\">张量探索 （引用 1）<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#%E5%BC%A0%E9%87%8F%E6%8E%A2%E7%B4%A2-%E5%BC%95%E7%94%A8-1\" class=\"hash-link\" aria-label=\"张量探索 （引用 1）的直接链接\" title=\"张量探索 （引用 1）的直接链接\">​</a></h5>\n<p>基于张量的重排序，来自于 2020 年一篇早期 ColBERT【参考 32】及其改进 ColBERT v2，但是它真正为业界重视起来正是 2024 年初，只是在当时，由于缺乏必要的数据库支持，因此不得不借助于 RAGatouille 这样的 Python 算法封装来提供服务。Vespa 是最早将张量工程化的数据库系统，我们则在年中的时候，为 Infinity 数据库完整地提供了基于张量的重排序能力。目前，基于张量的重排序系统在行业使用并不多，除了 Infra 组件不够多之外，配套的模型缺乏也是重要原因。不过，我们看到，从 2024 年夏天开始，这方面的工作明显进入了快车道，例如针对日文的 JaColBERT【参考 36】，还有 Jina 推出的 Jina-colbert-v2 多语言模型，都提供了为文本数据生成张量的能力。这种模型，对于多模态 RAG 也是个重要促进，可以想象，在 2025年，随着更多的模型就绪，基于张量的重排序，将在大量场景中得到应用。</p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"数据预处理\">数据预处理<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86\" class=\"hash-link\" aria-label=\"数据预处理的直接链接\" title=\"数据预处理的直接链接\">​</a></h5>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"数据预处理\" src=\"https://yuluo-yx.github.io/assets/images/data-loader-6aef1f2bb42c8f06ccf325789243b2dc.png\" width=\"1080\" height=\"434\" class=\"img_c29J\"></p>\n<p>在学术方面，普遍来说：只有保证了数据输入的普适性和准确性才能计算出最准的更准确的数据。</p>\n<p>$$\nQuality In -&gt; Quality Out\n$$</p>\n<p>目前普遍的处理方式是通过各种 loader 将文本加载进来，再 chunking 之后，利用 Embedding 模型处理。既</p>\n<p>$$\nEncoder -&gt; Decoder\n$$</p>\n<p><strong>预处理发展</strong></p>\n<p>目前 Spring AI Alibaba 提供一系列的 parser 和 reader plugin 来在工程级别支持这一功能。</p>\n<p>在模型级别：通过 OCR 模型融合 BERT（BERT 代表双向编码器表示来自Transformer（BERT），用于高效地将高度非结构化的文本数据表示为向量。BERT是一个经过训练的 Transformer 编码器堆栈）来完成对多模态文档的解析。</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"增强\">增强<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#%E5%A2%9E%E5%BC%BA\" class=\"hash-link\" aria-label=\"增强的直接链接\" title=\"增强的直接链接\">​</a></h4>\n<p>RAG 中增强是指将检索到的向量信息用作生成模型（即 LLMs）的上下文输入，以增强模型对特定问题的理解和回答能力。\n这一步的目的是将外部知识（外脑）融入生成过程中，使生成的文本内容更加丰富、准确和符合用户需求。\n通过增强步骤，LLM模型能够充分利用外部知识库中的信息。</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"生成\">生成<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#%E7%94%9F%E6%88%90\" class=\"hash-link\" aria-label=\"生成的直接链接\" title=\"生成的直接链接\">​</a></h4>\n<p>RAG 中的生成和 LLMs 中的生成是同一个意思，既通过 prompt 来让 LLMs 返回输出。其中主要涉及到领域为 Prompt 提示词工程和 LangChain 等的应用框架。</p>\n<p>Prompt 是指如何给大模型最佳输入，使其生成最佳回答。在一些 RAG 应用中，通过内置 Prompt 来优化大模型的输出。\nLangChain 将 <code>自然语言输入、关联知识检索、Prompt组装、可用Tools信息、大模型调用、输出格式化</code> 等 RAG 应用中的常见动作，组装成一个可以运行的 “链” 式过程。可以直接调用，用来进一步构建更强大的Agent。</p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"prmpot-工程\">Prmpot 工程<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#prmpot-%E5%B7%A5%E7%A8%8B\" class=\"hash-link\" aria-label=\"Prmpot 工程的直接链接\" title=\"Prmpot 工程的直接链接\">​</a></h5>\n<p>提示工程（Prompt Engineering）是一门较新的学科，关注提示词开发和优化，帮助用户将大语言模型（Large Language Model, LLM）用于各场景和研究领域。 掌握了提示工程相关技能将有助于用户更好地了解大型语言模型的能力和局限性。</p>\n<p>Prompt 往往和 RAG 的特定领域相关，例如 RAG 是一个 Spring AI Alibaba 问答助手，Prompt 往往更偏向于用户如何使用 Spring AI Alibaba 和使用过程中的一些常见问题等。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"rag-目前面临的问题\">RAG 目前面临的问题<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#rag-%E7%9B%AE%E5%89%8D%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%97%AE%E9%A2%98\" class=\"hash-link\" aria-label=\"RAG 目前面临的问题的直接链接\" title=\"RAG 目前面临的问题的直接链接\">​</a></h2>\n<ol>\n<li>\n<p>针对非结构化多模态文档无法提供有效问答。这意味着以 LLMOps 为代表的工作，只能服务纯文本类场景，而像 PDF，PPT，乃至类似图文结合的格式数据，就无法解锁其实际商业价值，这些数据往往在企业内部占据大多数比例。</p>\n</li>\n<li>\n<p>采用纯向量数据库带来的低召回和命中率，从而无法针对实际场景提供有效问答，这主要是因为向量表征不仅缺乏对精确信息的表达，对语义召回也有损耗。</p>\n</li>\n<li>\n<p>RAG 的本质是搜索，它能工作的前提在于根据用户的提问，可以“搜”到答案所在。但是在很多情况下，这个前提不存在，例如一些意图不明的笼统提问，以及一些需要在多个子问题基础之上综合才能得到答案的所谓“多跳”问答，这些问题的答案，都无法通过搜索提问来获得答案，因此提问和答案之间存在着明显的语义鸿沟。</p>\n</li>\n</ol>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"参考文章\">参考文章<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-RAG#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0\" class=\"hash-link\" aria-label=\"参考文章的直接链接\" title=\"参考文章的直接链接\">​</a></h2>\n<ol>\n<li><a href=\"https://mp.weixin.qq.com/s/9H4ZgqaB_q_FX2DzaaHPmQ\" target=\"_blank\" rel=\"noopener noreferrer\">https://mp.weixin.qq.com/s/9H4ZgqaB_q_FX2DzaaHPmQ</a></li>\n<li><a href=\"https://luxiangdong.com/2023/09/25/ragone/\" target=\"_blank\" rel=\"noopener noreferrer\">https://luxiangdong.com/2023/09/25/ragone/</a></li>\n<li><a href=\"https://aws.amazon.com/cn/what-is/retrieval-augmented-generation/\" target=\"_blank\" rel=\"noopener noreferrer\">https://aws.amazon.com/cn/what-is/retrieval-augmented-generation/</a></li>\n<li><a href=\"https://www.promptingguide.ai/zh\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.promptingguide.ai/zh</a></li>\n</ol>",
            "url": "https://yuluo-yx.github.io/blog/LLMs-AI-RAG",
            "title": "大模型专栏--AI RAG",
            "summary": "RAG（Retrieval-Augmented Generation ）介绍",
            "date_modified": "2025-01-01T15:45:58.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "AI",
                "RAG"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/deep-learn-init",
            "content_html": "<blockquote>\n<p>尝试理解神经网络的工作原理！旧文新发。</p>\n</blockquote>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"分类问题引入\">分类问题引入<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E5%BC%95%E5%85%A5\" class=\"hash-link\" aria-label=\"分类问题引入的直接链接\" title=\"分类问题引入的直接链接\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"少维度分类\">少维度分类<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%B0%91%E7%BB%B4%E5%BA%A6%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"少维度分类的直接链接\" title=\"少维度分类的直接链接\">​</a></h3>\n<p>如下图是一个北京和长治的房价对比图：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304220239621\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304220239621-5e1e405788d201d58d87b79128d883c3.png\" width=\"712\" height=\"445\" class=\"img_c29J\"></p>\n<p>如上使用表格的形式表示，可能不是很直观。换成如下的坐标系就能很清楚的看出来区别：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304221939557\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304221939557-0546a4abfa3459685a0d63ccc3df75d0.png\" width=\"746\" height=\"456\" class=\"img_c29J\"></p>\n<p>图中标注一条黄色的数据线，可以看出，黄线左边的属于北京，右边的属于长治。</p>\n<p>我们可以将问题进一步分析，使其变得更简单：在日常生活中，根据我们的经验知道，决定房子价格的因素其实是</p>\n<p>价格/面积 = 平方价</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304222249022\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304222249022-49f1cac89ef2439566837be197137ef6.png\" width=\"513\" height=\"327\" class=\"img_c29J\"></p>\n<p>高者属于北京，低的则是长治。为此，我们可以找到一个阈值，将其进行划分。</p>\n<blockquote>\n<p><strong>上述就是最简单的分类问题，只有价格和面积两个维度。</strong></p>\n</blockquote>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"多维度分类\">多维度分类<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%A4%9A%E7%BB%B4%E5%BA%A6%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"多维度分类的直接链接\" title=\"多维度分类的直接链接\">​</a></h3>\n<p>在现实生活中，判断房子值不值得购买。不可能只有 <strong>房价 &amp; 面积</strong> 两个因素，可能还有 <strong>楼层、通勤、年限、环境</strong> 等其他因素。问题的本质还是一样的，最终我们都是根据对这些数据进行分析，判断值不值得购买。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304222937185\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304222937185-abc1ea7b28555a9cac28fc3abc6a2cae.png\" width=\"822\" height=\"371\" class=\"img_c29J\"></p>\n<blockquote>\n<p>这个阈值怎么寻找，用什么样的方式去判定。或者说这个函数是什么样子？</p>\n</blockquote>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"推导数学结论\">推导数学结论<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E6%8E%A8%E5%AF%BC%E6%95%B0%E5%AD%A6%E7%BB%93%E8%AE%BA\" class=\"hash-link\" aria-label=\"推导数学结论的直接链接\" title=\"推导数学结论的直接链接\">​</a></h4>\n<p>这里，我们设 房价 = x，面积 = y：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">设 房价 为 x，面积 为 y。 </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">则有</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> x / y = 平米价</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>设将北京和长治区分开的阈值为 <code>0.69</code> ，则 <code>x/y &gt; 0.69</code> 就是北京，反之则是长治。</p>\n<p>接下来我们将公式变形，即可得到函数 f 的函数表达式</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f(x,y) = x - 0.69y = 0</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>从公式我们可以看出，这时候的阈值变成了 <code>0</code>，大于  <code>0</code> 表示北京，小于表示长治。这里只考虑了房价和面积两个因素。更现实的情况是：因为其他因素的参与，阈值可能不会恰好等于 <code>0</code>，可能是 <code>101</code>。这里我们就可以加入一个<code>偏移量</code> 对阈值进行校准。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f(x,y) = x - 0.69y - 101 = 0</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304224032237\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304224032237-f9bb0c331970f2415a5f03a1ace0ecdc.png\" width=\"702\" height=\"288\" class=\"img_c29J\"></p>\n<p>此时，我们观察这个函数表达式：</p>\n<p>如果 y 的取值增加了 100，函数值势必发生变化。但是只要同时对 x 的值做出修正，就可以抵消函数值发生的变化，即</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f(x,y) = x - 0.69y - 101 = 0 </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     [+69]  \\quad   [+100]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>此时，在函数 f 中，x 的 +69 和 y 的 -100 在数学关系上等价。但是在物理意义上，x 代表的是房价，y 代表的是面积。<code>单位/量纲</code> 不同，无法进行公度。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f(x,y) = x - 0.69y - 101 = 0 </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     [+69]  \\quad   [+100]  </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    (万元)   \\quad   (米^2)</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>在当前的函数中，他们是可以进行换算的，因为他们都对函数 f 的取值做出了贡献。换算的方式来自于对函数值贡献的大小。即：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304225027111\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304225027111-cd61692b7f065f4c2ff6c7fd46025ead.png\" width=\"769\" height=\"357\" class=\"img_c29J\"></p>\n<p>从中可以看出，x 和 y 对函数值的贡献正好是 x 和 y 的系数。</p>\n<p>回头看将才数据维度很多的情况：</p>\n<div class=\"language-markdown codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-markdown codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">设 数据维度依次为 x_1, x_2, x_3.....  </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">则 </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f(x_1, x_2, x_3, x_4...) = x_1 + x_2 + x_3 + x_4 + b  </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">根据上述对 x 和 y 的推导，我们可以将其变成：</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1x_1 + w_2x_2 + w_3x_3 + w_4x_4 + ... + b = y</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>其中函数值 y 就是房子是否值得购买的依据。</p>\n<p>根据上面我们的推导，这样的函数是有意义的：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304225603259\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304225603259-0ba9370619be3bbf542c83d4304424cf.png\" width=\"918\" height=\"417\" class=\"img_c29J\"></p>\n<p>w 的系数为对函数值的贡献程序，b 为阈值的偏移量。</p>\n<blockquote>\n<p>规范数学表达为：w -&gt; 权重系数、b -&gt; 偏置系数。</p>\n</blockquote>\n<p>在坐标系中表达为：（为了画图方便，回到二维系数表达）</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304225807953\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304225807953-e801a31958f74a5e71d81ca9a9cb725c.png\" width=\"649\" height=\"454\" class=\"img_c29J\"></p>\n<p>前面讨论的阈值即为下图中的分界线：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304225842374\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304225842374-349d5fc3bebd7f4a089e2eab6ceabb6f.png\" width=\"644\" height=\"441\" class=\"img_c29J\"></p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"加入参数升维\">加入参数升维<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%8A%A0%E5%85%A5%E5%8F%82%E6%95%B0%E5%8D%87%E7%BB%B4\" class=\"hash-link\" aria-label=\"加入参数升维的直接链接\" title=\"加入参数升维的直接链接\">​</a></h4>\n<p>根据数学原理，不同的阈值即代表了不同的分界线。当这条直接确定下来之后，对数据的划分也随之确定。将不同的系数带入变量 x 和 y 就可以得到不同的结果。</p>\n<p>如果我们引入更多的维度系数，对坐标系升维。则：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240304230033743\" src=\"https://yuluo-yx.github.io/assets/images/image-20240304230033743-e95173d10fe573938e797f24378d51ce.png\" width=\"705\" height=\"459\" class=\"img_c29J\"></p>\n<p>在更高维度中，经常使用向量和矩阵的表达形式：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1x_1 + w_2x_2 + w_3x_3 + w_4x_4 + \\cdots + b  \\\\ \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">将其转化为向量和矩阵的表达式为：\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1 &amp; w_2 &amp; w_3 &amp; w_4 &amp; \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">x_1 \\\\ x_2 \\\\ x_3 \\\\ s_4 \\\\ \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">+b \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">代表行向量和列向量逐项相乘，再相加 \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">为了让表达形式更加紧凑，通常对行向量进行转置，再进行点积运算：\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1 \\\\ w_2 \\\\ w_3 \\\\ w_4 \\\\ \\cdots </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">x_1 \\\\ x_2 \\\\ x_3 \\\\ s_4 \\\\ \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">+b \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">通常向量和矩阵，通常使用大写字母来表示，即：\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f(X) = W^\\mathrm T · X + b \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">另外一种表达形式是将偏置系数同样写进到矩阵中： \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1 \\\\ w_2 \\\\ w_3 \\\\ w_4 \\\\ \\cdots \\\\ b</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">x_1 \\\\ x_2 \\\\ x_3 \\\\ s_4 \\\\ \\cdots \\\\ 1</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right] \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">函数表达式为：\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f(X) = W^\\mathrm T · X</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>在前面的讨论中，确定了数据的阈值（分界线之后）。下一步行为在 <code>机器学习</code> 中称为 <strong>决策/预测</strong>。对于一个新输入的数据，通过 x 和 y 在坐标系中的位置来判断处于分界线哪一边。在程序中，并不能直接去看图像。而是要将参数值代入到函数中，计算出函数值，和 0 比较，进行判断。</p>\n<blockquote>\n<p>到这一步，机器学习的问题变得相对简单，而机器学习的难点是在于如何确定一条最好的分界线，即确定阈值。这个过程叫做<strong>训练/学习</strong>。和动规，贪心等算法不同的是，**机器学习只需要在刚开始时对大量复杂的数据进行计算，确定出来关系。在面对新数据时，只需要进行简单的运算就可以达成目标。**那么，机器学习并没有减少算法的复杂度，相比之下而言，只是提高的 决策/训练 的应用效能。</p>\n<p>所以接下来，我们将了解如何去<code>训练和学习</code>。</p>\n</blockquote>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"训练--学习\">训练 &amp; 学习<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E8%AE%AD%E7%BB%83--%E5%AD%A6%E4%B9%A0\" class=\"hash-link\" aria-label=\"训练 &amp; 学习的直接链接\" title=\"训练 &amp; 学习的直接链接\">​</a></h2>\n<blockquote>\n<p>训练/学习 的目的很明确，即在坐标系中确定这条分界线！同样，机器学习的难点也在这里。</p>\n</blockquote>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240305195959121\" src=\"https://yuluo-yx.github.io/assets/images/image-20240305195959121-31050473ba9a2ac39dee30955c8a978d.png\" width=\"474\" height=\"381\" class=\"img_c29J\"></p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240305195942932\" src=\"https://yuluo-yx.github.io/assets/images/image-20240305195942932-bc93e500768674a2f8ca414b08cf48dc.png\" width=\"478\" height=\"394\" class=\"img_c29J\"></p>\n<p>如图，上述两条直线，都能对现有数据进行完美划分。但是哪条直线是最优解？往往现实情况并不是这样，而是下图所示：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240305200117035\" src=\"https://yuluo-yx.github.io/assets/images/image-20240305200117035-3d5e8d0d3f3fbee403315cab38a83fe9.png\" width=\"471\" height=\"329\" class=\"img_c29J\"></p>\n<p>即不存在这样的最优解，可以将数据进行完美划分。只能从现有的直线中，挑选一条符合大多数情况，能将大多数数据区分开的直线。</p>\n<p>那么如何确定这条直线是不是符合现有的预期？对此，**就需要有一个判断分界线好坏的判断标准。**在面对不同的数据集时，挑选出的直线可能不同，如上图所示。随着越来越多的数据，直线也会随之变化。<strong>注意：机器学习的目的是预测，而不是训练。<strong>在当前的数据集范围中，只能做到当前情况分界线最好，并不能保证对新来的数据也是最好。这也是选择<code>判断标准</code>最困难的地方。当我们选择了一个判断标准之后，标准之中就包含了我们对未来数据的一种预测。这个预测无法在数学逻辑上找到答案，所以要想解决这个问题，就必须要引入</strong>额外的公设</strong>。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"引入额外公设\">引入额外公设<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%BC%95%E5%85%A5%E9%A2%9D%E5%A4%96%E5%85%AC%E8%AE%BE\" class=\"hash-link\" aria-label=\"引入额外公设的直接链接\" title=\"引入额外公设的直接链接\">​</a></h3>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240305201027218\" src=\"https://yuluo-yx.github.io/assets/images/image-20240305201027218-dd9b869349c72af6ae9ebdcd459c0047.png\" width=\"464\" height=\"341\" class=\"img_c29J\"></p>\n<p>从图中看，每个点到分界线的距离大小不一，所有这些点中，对分界线最小的哪一个，我们可以把它看作是分界线对数据划分的间隔：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240305201149190\" src=\"https://yuluo-yx.github.io/assets/images/image-20240305201149190-35ae322fdc4c0f7826c2689d1ba2ce19.png\" width=\"490\" height=\"325\" class=\"img_c29J\"></p>\n<p>通过已有的直觉判断，应该是分界线到点的距离越大越好。其中的间隔可以容纳更多的点。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240305201251937\" src=\"https://yuluo-yx.github.io/assets/images/image-20240305201251937-aed71ce3db691191e3a6986355ef020d.png\" width=\"474\" height=\"334\" class=\"img_c29J\"></p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"公设条件-1\">公设条件 1<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%85%AC%E8%AE%BE%E6%9D%A1%E4%BB%B6-1\" class=\"hash-link\" aria-label=\"公设条件 1的直接链接\" title=\"公设条件 1的直接链接\">​</a></h4>\n<p>因此，我们可以提出这样一个公设：<strong>间隔越大越好</strong></p>\n<p>那么，这里的间隔如何计算，我们需要将其交给计算机去判断，所以我们需要找到间隔计算的表达式：</p>\n<ol>\n<li>\n<p>我们需要知道点到直线的距离 ，表达式为（带入 x 和 y 无法直接得到点到直线的距离，需要做一些修饰）：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\frac{1}{\\|W\\|_2} \\|f(X)\\| \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\|W\\|_2 \\text{（权重系数的 } L_2 \\text{ 范数）这里的 } L_2 \\text{ 范数可以理解为 勾股定理在更高维度上的扩展，即} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\|W\\|_2 = \\sqrt{w_1^2 + w_2^2 + w_3^2 + w_4^2 + \\cdots} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\text{对向量里的每个分量进行平方再开方。}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>对上述的每个点进行 1 的运算，即可得到所有点到直线的间隔（用 M(W) 来表示直线间隔函数）：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">M(W)=\\underset {i=1,2,3 \\cdots N}{min}\\frac{1}{\\begin{Vmatrix}W\\end{Vmatrix}}_2\\begin{vmatrix}f(X^{(i)})\\end{vmatrix} \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>将所有数据带入上述公式，在不考虑机器算力的情况下，计算机就可以完成这些计算。</p>\n</li>\n</ol>\n<p>进行上述操作之后，我们就能得到的结果。这一切的前提是我们对 <code>f(x)</code> 这样的函数值进行了上述修饰。既然这里是公设，那么它就不唯一。这里还可以有第二种公设。同样，我们能偶利用的只有函数值，仍然对其进行修饰，得出前提假设。</p>\n<p>这次的修饰是对其进行 <code>sigmoid(f(x))</code> 操作：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">sigmod(f(x)) \\in (0,1)</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>通过 <code>sigmoid 操作</code>，可以将函数值缩放到 <code>0 ~ 1</code> 之间。<code>sigmoid</code>函数图像如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240305203942962\" src=\"https://yuluo-yx.github.io/assets/images/image-20240305203942962-9cbd533eafcb78995737d39ea72708fd.png\" width=\"440\" height=\"315\" class=\"img_c29J\"></p>\n<p>定义域为全体实数，值域为 <code>0 - 1</code> 的开区间。<code>0 - 1</code> 的开区间，很容易让我们想到概率，那么我们是否可以把经过修饰后的函数值看作是一个概率值呢？</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"公设条件-2\">公设条件 2<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%85%AC%E8%AE%BE%E6%9D%A1%E4%BB%B6-2\" class=\"hash-link\" aria-label=\"公设条件 2的直接链接\" title=\"公设条件 2的直接链接\">​</a></h4>\n<p>我们将函数值看作是如下的条件概率：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">P(X = X^{(i)} \\mid W)=sigmod(f(x^{(i)}))</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>这个概率的意义就代表了某一个数据在北京还是长治的可能性。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307140828845\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307140828845-7295ff071ef7f67f590911d8c1a9af6f.png\" width=\"476\" height=\"313\" class=\"img_c29J\"></p>\n<p>在当前的数据情况下，北京的函数值大于 0 ，长治的函数值小于 0 。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">北京：P(X = X^{(i)} \\mid W)=sigmod(f(x^{(i)}))  \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">长治：P(X = X^{(i)} \\mid W)=sigmod(-f(x^{(i)}))  \\\\ 长治的函数值小于 0 ，所以要对函数值取附属再进行 sigmoid 操作。 \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">概率值越大就表明属于 “北京/长治” 的可能性越大，反之则越小。</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>基于当前的理解，我们就可以提出新的公设条件（第二种公设）：</p>\n<p><strong>概率（似然）值最大最好</strong></p>\n<p>概率值最大，就应该是所有点的概念都最大，他们是相乘的关系。即我们需要找的就是当</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\underset{W} {max} \\prod_{i=0}^N P(X = X^{i}\\mid {W})· \\prod_{j = 0}^M P(X = X^{(i)} \\mid {W})</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>表达式取值最大时，系数 W 的值。上述表达式最常见的形式是：使用 <code>log</code> 运算符将连乘变为连加。</p>\n<p>第三种公设：现在我们可以假想出一个如下的函数 <code>T(X)</code> ，它可以对数据进行完美分类。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">T(X)=</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{cases}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">1: X \\in {北京} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">0: X \\in {长治}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{cases}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>任何一个数据的输入，都可以完美的判断出它属于北京还是长治。北京的函数值为 1 ，长治的函数值为 0 。图像表示为：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307144321343\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307144321343-3a6a76a32ec8ea1ba0b7c5a366520226.png\" width=\"493\" height=\"288\" class=\"img_c29J\"></p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"公设条件-3\">公设条件 3<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%85%AC%E8%AE%BE%E6%9D%A1%E4%BB%B6-3\" class=\"hash-link\" aria-label=\"公设条件 3的直接链接\" title=\"公设条件 3的直接链接\">​</a></h4>\n<p>那么，我们知道，在现实情况中，这种函数一定不存在，总是会有各种各样的误差和噪声对 <code>T(X)</code> 函数产生影响。这里我们用 <strong>ϵ</strong> 表示给函数叠加了一个噪声。它不再变得完美了。函数的输出值依然是会接近 0 和 1。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">T(X)+\\epsilon=</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{cases}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">1+\\epsilon: X \\in {北京} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">0+\\epsilon: X \\in {长治}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{cases}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>这个时候 <code>sigmoid</code> 函数就可以派上用场了，我们就可以用它来表示受到噪声干扰后的 <code>T(X)</code> 函数。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">T(X)+\\epsilon=sigmoid(f(X))</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>图象如下所示：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Image\" src=\"https://yuluo-yx.github.io/assets/images/image-20240308170315337-8a0a8e9b391590c2aa90a808dc4505d1.png\" width=\"1100\" height=\"553\" class=\"img_c29J\"></p>\n<p>这个时候每一个数据得到的 <code>sigmoid</code> 函数值与他们再 T 函数中取值的偏差就是叠加之后的噪声 <strong>ϵ</strong> 。最好的分界线，必然是 <strong>ϵ</strong> 最小的时候对应的分界线。即：<strong>方差最小最好</strong>。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\underset{W}{min}\\sum_{i=0}^N(y-\\hat{y})^2</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">y=</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{cases}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">1: X \\in {北京} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">0: X \\in {长治}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{cases}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\hat{y}=sigmoid(f(X))</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>第三种公设的表达式为：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\sigma^2=(y-\\hat{y})^2</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>上述提到的三种公设表示为：</p>\n<ul>\n<li>粉红色：方差最小最好；</li>\n<li>橙色：概率最大最好；</li>\n<li>绿色：间隔最大最好。</li>\n</ul>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240308170851932\" src=\"https://yuluo-yx.github.io/assets/images/image-20240308170851932-2c7a496c239df5e09d5d9498e6766755.png\" width=\"743\" height=\"400\" class=\"img_c29J\"></p>\n<p>我们知道，公设不同，得到的结果也不同，到底那种结果最好？</p>\n<p>没有理论上的标准答案，还是要看真实问题是什么。</p>\n<p>这里的三种公设条件可以表示为：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">公设：\\begin{cases}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">修饰公度结果 \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">为公度结果赋予现实意义 \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">用现实意义将一直外推至未知</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{cases}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>所有的公设得到的结果都是对已知现实的总结归纳，是对未知情况的经验总结。</p>\n<p>虽然这里写出了判断标准的数学方程，但是求出解析解几乎不可能，困难重重。这里如何选择最合适的算法更快、更好的求出函数表达式的数值解。就是机器学习的另一项重要工作：算法。</p>\n<p>虽然算法非常多，但是针对神经网络，提到算法就是在特指 <code>梯度下降法</code>。</p>\n<blockquote>\n<p>公设的常见叫法是策略。 算法，策略加上模型，就是机器学习的三大要素。</p>\n</blockquote>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"机器学习中的模型\">机器学习中的模型<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9E%8B\" class=\"hash-link\" aria-label=\"机器学习中的模型的直接链接\" title=\"机器学习中的模型的直接链接\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"数据模型分类问题\">数据模型分类问题<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98\" class=\"hash-link\" aria-label=\"数据模型分类问题的直接链接\" title=\"数据模型分类问题的直接链接\">​</a></h3>\n<p>接下来我们要看的就是模型。模型简单来说就是对<code>数据的分类</code>，为什么要选择直线？如下的数据分类图：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240308172044116\" src=\"https://yuluo-yx.github.io/assets/images/image-20240308172044116-7dd9f541c4bef28bd700a5c92ebd9380.png\" width=\"1303\" height=\"877\" class=\"img_c29J\"></p>\n<p>面对这种数据分类的时候，无论直线怎么放置，都会存在问题。但是使用下面的抛物线，就能准确划分数据。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307152553927\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307152553927-091900b266ce518033fa09f83a8de052.png\" width=\"504\" height=\"406\" class=\"img_c29J\"></p>\n<p>抛物线方程如下：<code>可以看到相比直线方程，只多了一个 x1 系数的二次项</code></p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1x_1^2+w_2x_1-x_2+b=0</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307152639893\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307152639893-febc29a74875f8e57dd35a369795e1bc.png\" width=\"511\" height=\"422\" class=\"img_c29J\"></p>\n<p>这里，如果我们再增加 一个 x2 维度的二次项，还可以变化成为椭圆形的分界线。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1x_1^2+w_2x_2^2+w_3x_1+w_4x_2+b=0</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>增加 x3 系数的二次项时，会变成双曲线。对数据分类更加准确。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307152700317\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307152700317-c4cb880c92106a3ab990b1854823e35a.png\" width=\"490\" height=\"419\" class=\"img_c29J\"></p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1x_1^2+w_2x_22+w_3x_1x_2+w_4x_1+w_5x_2+b=0</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<blockquote>\n<p>前人已经证明过，只要增加更多的高次项，那么不论多么奇怪的分割线都可以表示出来。</p>\n<p>随着项数的增加，复杂程度会越来越大。也就是说模型的复杂程度越高。</p>\n</blockquote>\n<p>为了图形表示方便，暂时这里只针对 x1 维度增加更高次项。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\cdots+w_1x_1^3+w_2x_1^2+w_3x_1+w_4x_2+b=0</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>图像表示为：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307153214331\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307153214331-9903981554d9986628ef4bd3588daa3a.png\" width=\"533\" height=\"427\" class=\"img_c29J\"></p>\n<p>用向量点积的形式表示为：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\cdots \\\\ 0.00 \\\\ 0.00 \\\\ -0.20 \\\\ 0.50 \\\\ 4.60 \\\\ -1.00 </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\cdots \\\\ x_1^5 \\\\ x_1^4 \\\\ x_1^3 \\\\ x_1^2 \\\\ x_1 \\\\ x_2</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right] \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"分类--回归问题\">分类 &amp; 回归问题<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%88%86%E7%B1%BB--%E5%9B%9E%E5%BD%92%E9%97%AE%E9%A2%98\" class=\"hash-link\" aria-label=\"分类 &amp; 回归问题的直接链接\" title=\"分类 &amp; 回归问题的直接链接\">​</a></h3>\n<p>机器学习里讨论的模型复杂程度其实就是曲线的复杂程度。虽然我们这里讨论的是分类问题，其实和回归问题在模型上并没有本质的区别。比如上述的曲线，可以是对数据的分类，也可以看作是对这些数据的拟合。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307154955484\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307154955484-3c9e681b51a78c4759fc78460fc446e9.png\" width=\"513\" height=\"433\" class=\"img_c29J\"></p>\n<p>下面我们还是讨论分类问题。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"引入神经网络\">引入神经网络<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%BC%95%E5%85%A5%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C\" class=\"hash-link\" aria-label=\"引入神经网络的直接链接\" title=\"引入神经网络的直接链接\">​</a></h3>\n<p>既然直线模型的局限性这么大，我们是不是可以提高模型的复杂程度呢？我们这次讨论的重点——神经网络就是一种提高模型负责程度的方法。</p>\n<p>下图就表示一个神经网络：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307155043430\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307155043430-4cb12d3025775cd96edface0182bce58.png\" width=\"719\" height=\"528\" class=\"img_c29J\"></p>\n<p>红色表示输入层，输入层的输出输入到神经网络，其中每一个神经元都和上一层，下一层互相连接。称为全连接神经网络。这里，我们单独拿出一个最简单的结构：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307155217733\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307155217733-81867475e10e45e8bc5ea790410286b5.png\" width=\"333\" height=\"393\" class=\"img_c29J\"></p>\n<p>这里的每一条代表的是对应的权重系数。这个结构，其实就表示为一个线性方程，表达式如下：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1x_1+w_2x_2+w_3x_3+w_4x_4+w_5x_5+w_6x_6+b=z</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307155302941\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307155302941-db84cead51c1a9487fbfef4675fd049b.png\" width=\"615\" height=\"384\" class=\"img_c29J\"></p>\n<p>经过 <code>sigmoid(f(x))</code> 激活函数计算输出结果到下一层。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"激活函数\">激活函数<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0\" class=\"hash-link\" aria-label=\"激活函数的直接链接\" title=\"激活函数的直接链接\">​</a></h3>\n<p>神经网络对激活函数的选择是有要求的，sigmoid 只是符合要求的函数之一。这个激活的过程不会在神经网络中表示出来，只是在神经元中显示。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240308175155446\" src=\"https://yuluo-yx.github.io/assets/images/image-20240308175155446-bcf61c43bf25492df064d591b59bd888.png\" width=\"758\" height=\"450\" class=\"img_c29J\"></p>\n<p>因为后面需要使用坐标系来展示，所以这里只讨论二维情况：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240308175254921\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASEAAACFCAIAAACbhdkAAAANXUlEQVR4nO3caYwb530G8OedIbnkXiT35C53V2sdq8uyLFuxZEkWFMeS5SOBHd8JChQokgZFjw8pArSGALdBgQL54Bboh6IuUqdo4qhykwq10USxm9iWnVVcy0dWkqVKWu3Ne8ghl/fM2w9DMlwul5RkOZLi5/dFI+7O7Cx3Hv5n/u87AxARERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERHdeMT13oGbQ+VtktdzL+impFzvHbjJiCWL/ISi5niUXC5R9W9VNZNLv846R7WYsctReZdEuXhJCchyokTVuSRDRjVs13sHblyVwiUACSEB/CZUpQVZ/sZK8IhqMGNNCEgrP9UvmtVfhwCkVdOYMVqOGVuRrD5HrCwIYUopa1+3LtIYMapDvd47cEMTgICwLrcUwARMoBtY29Yy6LTZDZmR0oBUrFp2vfeWbkzseTQiSk0OaZX7IYEHt6x7eNfODcPDqiLnItHjpz4+fOKDCU03hGIApjTNJpukzxzWsUasiy07oADb3a5DT37xa1882NfROr8wp8Vjvu6uvdtu/9zYusDM3Ew8UbR6HvzUoqV4RDQiAAVQgDEHnn3yy/fecfuvJia+++rr7wWjeWCkVX3mnt1P3PeFC+HYoZdefndmrgCYQgCQbDFSGetYEwpgAx67686Hd+18//8ufPuV194MRpNABpgryBMXptw2ZceWjfns4sRCSM8XAEAIIfjhRSWcS9WECXiB20ZGCoX8q8fHL4UiKoRqnUMK6MCxd0/Mz89sXXOLr7PDIYQQwipiVsxuirDdFDt582LGGhECEuh0KF1tLj2VDGRyeQkT0mpsmBI2IBZf1OJ6q92h2Ox5KU0pAUgpZXmhcgQ3PpSFEIpyff4cPLP9VHF8rCHr2DOlYRhCUVRFKOWXZXlBKCgUCh5v9x995ZlTidSlUCgYDAaDwUAgkEqlTPM3w2k1h3Kl4lW+emMf65yQeZWYsSZsQKIoQ8nUretuGevzjs/Np/OmEBKAIiGBVQO+wYHBmXDw2Pj7yfbOjp7e7du3d3d3WxEyTTMcDodCoXg8Pj09PTc3l81mC4VCg0SJ30rXRIiqqV9CKALSvJypKhwIvGLMWHNR4O2zH++6df0je/acnY/+fGYuUz7M1gKP7ry7p6//8I9+fOz9X0dzxcpaqqp2dnb6fD6/39/W1jY6Orpjxw6bzQZAShmLxTRNi8fjs7OzwWBQ1/V0Om0YBuqVO5SLXvWVXmXZOh2tm8n6rwsFpVNaQHVCKDCypmnCGg8UjePNgF0xXuw2IgBVQJHoAv78Swee3HN3JBr70f/8/PjEuUwuv2X1yKP77rnzti2/mDj13NH/Ph+MmACEkA2rkMvlGhwc7O3t9Xg8fr+/v7+/paXF6XQahhGLxZLJZCQSmZyctBKo67oVvCV7Ve5bCiGqz0WXF8DqjJWWFQWmCaD/9p3bPn9gdMOmFpczGgp89M47Z197JafHhFCklMzSNcSMNVIag1YAiSHga/fteWzf7u7W1mRKLxpme3uncDje+Gji+f/62QfBSF5AQljtkJoje6U6U+FyuXp7e91ud19f38jIiNvtdjqd7e3tpmkmk8lMJhMKhaanpzVNswpgsVis2UIleADMpbNNqn66ACQU54Fv/Om+x7/S0umJJeKGUfB4PA4hTp345X/+499HP/4IRoG3EFxDzFgT1hukCgBokdi9qv+hbZs3+gdtNttUNP6LiVM/OzcVS+elEKYQppTmymGqSVp1m7HuSjabraury+12DwwM+P3+rq4ur9fb1taWz+fz+XwulwuFQgsLC9b1XjgcLhQKK/4WQgDWTxf3fv1PDv7+14OB8E+PvHzuV8fziVjf2NiBp57ZtmvP+Q9OHvn2s5HpyaW38tAnwoxdFmtesHUHiwDaAQVYBIrlWlfqcFzZNpedyFWVI3OFmY+Korjd7o6OjuHhYb/f73a7fT5fe3u71UfJZrNzc3PhcDgSiVgL+Xy+OsD+u/Z+47m/WcxkXnzuUOD0SRjlWNpcjz/7V7sOPnT0xRdO/PB72WS8fL8OfVLseVyWyvFmBSBZyYPVc8fV3J+5UgNjeU2rTqBpmpqmaZo2PT1d+QZFUZxOp8fjGRoa6u/v7+zsHBsb83q91irZbDYYCkW02Lm54Jb9D7W2d/zgn/8pdOEUJCBUa30Y2Vd/+H3/2IY7dt595idHswmNH7/XCjPWnKg8TEBKKaUAlKVhaHq5teKWq4anq2NW/dXl8ausJaVUFMUaIUin0+l0en5+vnrjqqq63e6BwcGOzg53V9fW7dvX3bo5GoslLlw0szlIs/R7GSagZgLB6EJgzepVdk8XZqdhGmzUXxPMWFMCgJClM8JSvZJQISSkaR2FUpZSd4Wbro5TTcyqw1a3VVhJoDVBxEpazcaLxWI0Gk2lUi3OFm9v77DdOZTPqXZn6deyqnP1Tld1KZfco0qfADPWWOkGTeuIFJDWsS3K7e3yZRogoQhFWmeOl1fWalJUaccvr4o1uaqsgqWzQ2w2W09PT3d3t9frHRoa6u3tteqYw26P64l0NncxosXD4dW+4ZaBQXHWIXMZSAkBKCpMQ/F6O/v78vmckU6D98FdO8xYc0IICalAKoABacjSHWUFQEqplid9SmlWnltVmXnYOGyVRFkXWkt+4tJpVjULdru9r6/PuvQaGRnx+XzWIJvdbtd1XdO0aDR68uTJYDAYj8fj8Xil178+HFt967b7H33syOn/jU5PAoAUMIoA7rn/4Mgtt4z/5JVFLVquYNWFjGeNV4lnA02UHjQgoEipAhvaHXs3rl0/NOBQ1bmIdnzi3LsxPWNKARiAAesxVvUvnypWKkrL2e12h8PR09MzMDDQ09Nj5crpdDocDmuySCQS0XU9HA7Pzs4mEgld15cPnQFQhSIBU5qwtz5z6K/vfuBLJ0+MH/3XF7UPTyKXgW9o3xNP3//Y48lo6LvPfitwdgLCLJ9GVj8imTG7GsxYI9a7o0AokF3AU5+77fe+sHfTKr/NLCimIWz2QCp/5K0TL7z5y6m4XgCKSx5ZtXRTzQajnU6ny+Xq7u4eGRmxxqMHBwcdDkexWBRCJBKJhYWFRCIRCoWmpqZ0Xc/lciv19yvlUS65M1tIoUCaaPc+/ReHdj7wUL5ozk9OZfW0b2jI5x+YvXj+X57/2/nxN2QhV26k1tQxZuxqMGMrEuXLfgXoBP5w354/OHCvQPG1E+Nvv/deIZvdun7D/t17Vq0a+fFbb3/n2BuXYgkDMMuHeM1Ep2qtra2dnZ1ut3t0dHRgYMCKljW4XCgUksnk/Px8PB6PRqMXL17Udb1BlqpH1Zafcy5foTSXyubcuP/gzgceHl6zrsXuSka1D8ffPn7435KBS0IV0jRgVuaFVDBgV4kZa8J6gx5cPfyXT3zZoarPv/Tyq5PTSUABHMC2Dte3nnpkw9ia7/zg8JFfn08YtQdie3u7x+OxqpPP53O5XG63u7W1NZVK5fP5VCplTdTQNM0qUw0SUslt3cFrLLuKq7sFKaVQFGlKQELY0dOntDhlRJO5BKQBRRGV6cJ0jbDn0YQA3MDezRu8na7vH3v99YVARlXtVtNeiPFU9qV3xv+sv2vfHdvOBOOas629p9c3MDA4ONjR0eFyuVpaWnK5XDKZTCaTgUBgdnZW1/VgMLi4uFh3rFlVVVlWt/NRPQ2/slalx9j81xHCenaWEIqUBYTnTAAQilAERG37n64FZqwRAWFCehQMeT36Yur0bDCTzRsABFRrfrqUZyYvTc/Mb16/8Zt/vOlsujAXjydTqZmZmZmZmWg0qmlaJpOpG6e606aWz7KvfH/d4TJZdZ91U0tXrE6TNKXBW+I/JcxYQwJCwumwOR32Qi6XKxqV25/Nckshn5cC6qKe+od/P/rW5FTdabnVt6JYr9StPA3+26BSXd0Ukzrb4SXXp4MfXg1JKYDFbFFfTLe3tXa3OOyAIgCJ0nM7AG9Ha7fHnc7l4oWCUXWBWzNPqnoeRvV9KDcOBuxTwow1YvUVY8DHC0Gnq+3e7Vt9XR4hYRewAyrQAXx+69bB/r7TU5PRZLL6DNBSs1zTVafPAj5fsQkVKAKpaGTT0NDOzZt6FRkLhBezOTvgB75659av7t+XKhReOPbmRDBcQGkM2iKW3ph8A9Yu+i3gX70Ra2aUQ0BI3Lfa/81HHrx9dHRuYf70hQuZbH7NyOiGtWu1fP7vjvzH4Q/PaIWiFNbAUv17MVm7PpuYsUbKN0ELBVCk3OpueXr3jv13bR/s7rILoS1m3j0/+b2fvvbWbHDRhBQwAVOWJg5fUUudfocxY81ZcVEBA7ABa9oco153i80WiGlnUlndhGp1QUrz+0R1P50BI7oCQtR+JimAemN2CYmIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiI6HfW/wPTCsqJ+gx1BgAAAABJRU5ErkJggg==\" width=\"289\" height=\"133\" class=\"img_c29J\"></p>\n<p>其用向量表示为：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">x_1\\\\x_2</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1\\\\w_2 </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">+[b]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">= [z]\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">sigmoid(z)=a</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>表达式的输入输出在坐标系中显示为如下图的一个曲面：对应的分界线就是 x1 和 x2 平面上的红色直线。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307160444347\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307160444347-986456b001ed1860dfa1c7855f1ae9f6.png\" width=\"647\" height=\"319\" class=\"img_c29J\"></p>\n<p>如果不存在激活函数，就只是一个面，如图：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307160520189\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307160520189-a87b7f2e60582a0dc76744497df4ef8e.png\" width=\"614\" height=\"338\" class=\"img_c29J\"></p>\n<p>再加入一个神经元时，表示如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240308175501778\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARMAAACGCAIAAABxF/mrAAAQS0lEQVR4nO3ce3Bc1X0H8O85dx9arXa10uqxklYytrEtbAdj4RjbgI3Cw8YOU4IDJU6TQNM0TZuhM/kjLSU0mUzboZMpw0ymk9KBtCGhhEdFA6EEQ7GLiW0w5mEb2/it12q12rdWu9rHPb/+cXdXq4eN8chYl/4+9mh2Vvu4V3u/95zzO+cuwBhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxsxCXOoNuEDn3m76lLaC/f+lXeoNuBDTYyMAad7TADMheak34EJQ6SdNbl7KtzlCjJ2TmEiJ4MCwT9Fn4mAr7wSPb9inxcTJKTcyBJDg2LBPlfmSIyp+lu9RpeAICCkEACIqjYI4Umz2mTE5QkBIACABKgAEeAFfVZUmZSybHdb1HKAJgKAAcHTYRWC65AgUwwMLSIL8AltWLN58zarO9g6btA5F4jsOHnzq7Xc/jCeVgAIUVbRIQhBxjtgsMOV8DkAWkAS6al0P3nn7N7fc4nM5g0ND8XjcV1/X3dW1esmi4MDAQDyZhzEeEpVxEcJ05ws255jvGBIQEiSByy3y/ru23nh119sHD/z8v199LxTOAfMd1m3rr936he6T4dCDv35+X39gHAA3NWy2ma/NMZYLWICt16y6bc3qA8eP/8NL23eFwglgDBgsqL0nz9RaxLrlnYXx9KHgcDKXn5gh5daGzRLTrSEQABTgAZa2t+cKuZf37OkbCVsENEACVoEksP2dfX2DA1cumO9zu21CSFHMDLc8bLaYLjkABAG1VRavq3osMxbK5LKEAhVrAIoggXA8FU0kq+xWYbHkiBSdNTPcCrELY7nUG/BJkYAAQAVdEmlSClGeyZmY6hGEQkH31NV/5yt/eH1irDc0MhwKDQ8PBwKBsbGxyhRV3uZ2iZ0/0yUHBNKAZIGCsfjSy9oX1NW82S/TuiICldrQhX6fv8XXPxL63Z79qZo6d2NTV1eX1+vVNE0ppet6NBodHh6ORqODg4MDAwPpdFrX9RkzYxSyL0I5e/qSISGEIFKTHmLOFE/Z8OLfcNqSXHPuXJEZkwMAUWD34cPXLVuy9Qs3HB9J/E9/IA1IgIBFwB+svqapyfdMz/OvvXcokiuUnyuE8Hg8zc3Nra2tTqdz/vz5a9euFUJIKYUQ0Wg0Go3G4/GBgYFQKJRIJIxEYVrTVBkk44Zxp1Kq8mHnjBwVm0kpoJRRLyTSAUDaICRUDkaKhER5OcTcJox/pfTXAjYgCeSINEAKUSAiTEmQCfZrRqbs5QvAAjQB37vt5ruuXxOJRnp27tx14EQ2l1t2mf/29dd3XXnlzoOHfvziKydDYb1ibc7ZOBwOv9/v9Xo9Ho/f729sbLTb7VVVVUbrNDo6Gg6HT58+nUgkYrFYMpk04lRJSimlLCfHSIuRHEzrAQohiMpdS5JSKlIg0XzVuhXdN81b0lldUxMJBt/dtePE6y/nRhOQgFKAwhwmS4VaBdw0375l7dIVSxY4qmzDkfibHxx79o3e/kxBSC2viKAkQBBUXDhlSqZMDgQ0wEroELine+2dN6zzupyjyZRegNvt0i2WnR8efvjFVw8Mh3UpdSJFk09y5zeecTgcPp/P6XQ2NDR0dHTU19fb7XaXy1UoFFKp1NjYWCQS6e/vj0QiRktVKBSmvEK5/FCOUMVtSZAQQpIi0klzbPz2dzdsvctWWx8dTed15XG5qwSO7tvb87NHIkffh8pDfewZ4FLSAA1wAd/dsuxbX7qupb4mmUjkczlPrdPqcO4+2P+3//zbN4NjORIEMjrVChqgV/bcTNSLM2dyAKBYhq4Cru3wbVq5dLm/zapZ+iKxHR8effnY6WA6a1QPqNTXEQCEOHdihBCaphkPUUpNf6zFYvF4PB6Pp62tra2tzbjtcrlyuVwul8tms6FQaHBwMBwODw8Ph8Ph6XGqfCsppFKKoN/4p/dt+vq9oVBoe8/zR/bszcXj9UuW3PLlu69ed92xD/b3/N0Dkf6Tc/aIEgIC0AgW4K9vXviX39icGEs/9p+vvrZnMJXRF7bi3tvX3XzdqsOnI3/y0G8OxlK6KDY3BAkoUbpCUUxOzhzd2xITJweTu8luQAIpoGAERAgQzcqfX0pZ7n2d7QG1tbUul6utrc3v99fV1RmNla7r+Xw+k8mEQqFgMDgyMhIIBKLR6Pj4eOVLta1e/50f/v34eObxB+8fOvo+VKkrKB13/M2PPn/Lpt/96t/eeuYXuWRiLtb9jNgIoeuqu8X6L391j2YT9z3861dPJbOljlgD8E9/1v3lTev/9bntP+7ZH8/kjOGO8QGaNDnmqxCg+GGVL6Uunr6S5d8Zo4hZig2AynH/FEaolFKxWCwWi/X19U1spBBVVVV1dXV+v7+pqcnj8XR2drrdbgBElNf1oeHhcCR6PBBasfG2qhr3048/FjpzTECQkCAlpEZqfHvPMx1Ll69ed/3RV34zHI/Nzv7MLgIBCiSB7muuqqt3P9rz0puDaV1ACkEgi0REx8+e2rGy8/Jrr17qf/lQMp3TJ0dlpled68yYnOLYesaSkyBx8S5zm14oI6IpZbdyPY2IMplMJpMJBAKVT9E0rba2trXNX1vrcXs8K6/+/ILlnxuJxcInjunjGRAZfRkiArRU/0DoTN8VnYvX3LhptO+EVZOV7/WJNv6itFdCCJAEWYg8heSqKy9PZFK//2Aoky0QCUAIQNfJAhxP4NDJvtWrlnU0W47FYVRYZrqW1zTVNjMmx1BsU8rte+ljKLf8s/ABlKNSDgMm56eyela+v3x7xpK0Ua8bS6er7Q6vt7HdUt02noXFRgAgQAQpBUCkjOZUV7quq+ZmX53IayCj/F25hee/O7MfHgGANEDqupdSTocNek4oksVTGpEwxjLQiqMaWC1WCFFuckTpQzRdeEyWHFG8PmfiCmqj3zbxlVFCEFA+YItH/IW917RJG5yl2Zlyo3ybiDRNa2xs9Hq99fX17e3tXq/XYrG43W6bzZZKjI6P506FY+lYpN3fZvf58JEV+TxNVDR0a6O3saMtl8u88NQTwTMnL2g/PiUC8H792uWbVn1ugWtXMEU5FEgpggDygFfDZS2NiUSqfyijF6i00mPmLwCDGaJjsuSUxy4ECIIsXfipAAugAXki43bxEusLSs30eFS2J2d7lpTS5/O1tLS43e729vaWlha73W632y0WSyKRiMfj8Xj84MGDg4OD8Xg8FouVy27LItF7li279Y47nj3yXqT/TOVr3nDrF+fNn7/7xf8aG02WCxUX5uKs0CMAEqQJkdNp5/5DWzesvGvjht0fvLA3m1KABhQIDuBrty1bvsTf8/rbZ8bzJCCFUCSIVGX3gABR/GBN0OyYsLYmjNoyNBLG9W1X1NjWdy5e5PdbrdbBkZHdR468E06mdSLgfKZBZ36Tsy+3sVgsFoulubm5paWloaGhubnZmDm12WzGQoRwOJxMJoeHh/v7+xOJRCqVmj5ziuKfXhIUrDXbHvjR2i1ffGffWy888e+x99/DeBrNrd13brv1zrvjoaGfP/j94LFDEzW3ydt5nnt0kepyovRfAxzAT+7dsG3z9ceOHvvpr1763xNjGR0+ia/ddsU3794YyeT/+IFf7g4mdYKxVgKAgKqcDRWAgKCKU+ScZc7kABpgIXiBu1dd9Y2bNyye10p6gZTSrNaR0UzPrr2PvrHnVDyZA8qH24xhOPcqT5vNZsyEtre3NzU1ud1un89nt9uNqZ5kMjk0NBSLxcLhcG9v7+jo6Pj4+IyFOGNwYiwymPoAqYEUnPXbfvDDNVu2ZLK5/hOn9bFca0dHg6+599hHv3zkHwNvv0G5LGjmV760peqJ5AjohEbgJ9++6Y6bVzlQOH6qLzmWaWtubGrzBUai9z/yZM/RUUXI60ZUjHGOwpRFbsUOOCdnthmfkx2oBb614dp7b+lWqrD9rbd2Hzgwns2uWLz41jXrFnZ09Oze/dArO09G4+e55Ku6utrlctXV1c2bN6+5ubmmpqahoaG6ujqbzeZyudHR0UAgkEgkIpHIqVOnksnk2UrVlYfyjL0+TA+qUSa0Oq7YuHntps3zFy62WO3xWOzdt36/58lfpIJ9kBqUPmNyLrnKyrImUCDUANvWtNy+/qrliy6z2GyReGr3+0ce79n/biIrJPKq2D+j4pCVMPd7ZjMxZXKM1QObF/q/f+eX7Bbrw08+99vTfQkAgAZc43T84K7bF3Ve/tBTzz538KOEPvVzqampqaur83q9xkyL0+l0u91OpzOVSuVyuXQ6HQwGg8FgLBYbGho6d0gw05o0TKsoVNbopj8FgJAakQIRpF3zNpDNpuIxpJMgBUgpNSJVXA86x1Qmh1AceepALdBeC00imsCQggI0iYICoVRam9rUTL1njjNZhQCAMXpxAWs6O91u13+8+vprweGM1KyADhDo7fT403v33dfSeGPXyo9C8ajNUe2tb2ltbWtrczqdDofD4XDk8/lEIjE2NhYIBPr6+pLJZDgcTqfT00Ni9LIweT60shI9dfNmqrydLV0ThQelozivmtNHBksPkwKakFKRojnZ4GDa1QQ6kQSsUqQUHUoU75eQBNKptK6jWIA3Qx3g7EyXHAEBInILtDZ4Y6nUB31Do5msmlgzIBRw8NTJ3oGBzkVLvvcXf348qw/GosnR0d7e3kAgEA6HY7FYJpOZccxjHNOVszdTpnEqf4WPWQ09w1Fxtoq2cRAppYzVqMZ3yhkdGUX6HL/KoFwfK/7FAF0VZ2nKK2uAqd2y6fszd/dwJqZLjjHFDodNq7FZKV/I6npxuClIEISAIGSypAPpsdRPn35y1+m+GRddGi0JKhqTGWdmJt74LFXp80nIeezWxDMxqbg094fKwOSDvjLlVHnfOXfEDHs5ifm+h8C4ujCZ1ePpjLva2WK32YuroKUUEgQFqq+rqvW4UtlMopAnQJZ6XJjc+zJKZHPvqwio4v9nw2dmRyaYLDnlGmgMODwwaLNZu1euaK7zgJQVsBIJkBPo7upqa2k53NsbTo4a86FGw1Lua5WDVDlwZ+z8mez71ozYSKAAjI4El/nb1i27okEUYsPh9HjWDlwm8Eddy79y0w1junps+xtHgiN66Yw342oaxi6M6cY5xdqaBpxIF57csavJ7fzqjRu6ly0+eurUeDZ/+bx5C+d1RHP5R3te3D84lK8odnJa2CwyXy+luMKWoAFW4EpX1VfXr924uqu1vtYiZCQ1tu/EiSe279wxMJJSqLx4/2MnVRg7f6ZMTrn3JYkUYAUWO+0LvB6rlIPR6JFUNqmgCaiJ6xCK5eZzXKPG2CdivuSUFPthYtpXCwiUrnAxlrJ/3BpnxlhFlcy85wTGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMWZe/wfmhzVPFKg4vQAAAABJRU5ErkJggg==\" width=\"275\" height=\"134\" class=\"img_c29J\"></p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">x_1^{[0]}\\\\x_2^{[0]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1^{[1]}\\\\w_2^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">+[b^{[1]}]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">= [z^{[1]}]\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">sigmoid(z^{[1]}=a^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>这里用中括号中的上标数字表示是神经元的第几层。</p>\n<blockquote>\n<p>输入层对应的是 0 层。第一层的输出结果会作为第二层的输入。</p>\n</blockquote>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">[a^{1}]^\\mathrm T·[w_1^{[2]}]+[b^{[2]}]=[z^{[2]}] \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">sigmoid(z^{[2]}) = a^{[2]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>增加一层神经元之后，图像并不会有多大的变化，仍然是下面这种曲面：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240307161032336\" src=\"https://yuluo-yx.github.io/assets/images/image-20240307161032336-f9ebeb574a56b3f65124fd37c75674e0.png\" width=\"600\" height=\"333\" class=\"img_c29J\"></p>\n<p>接下来就会发生变化，我们在多加一个神经元之后，</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322185329932\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322185329932-17111048118771-9513531d862724ddc869b9e61b5c7aa5.png\" width=\"353\" height=\"160\" class=\"img_c29J\"></p>\n<p>每个神经元都有 <code>W1, W2 和 b</code> 一组系数。这时候 W 就不再是向量，而是矩阵。不过仍然是进行线性运算。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">x_1^{[0]}\\\\x_2^{[0]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_{1.1}^{[1]} \\quad w_{2.1}^{[1]}  \\\\w_{1.2}^{[1]} \\quad w_{2.2}^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">+[b_1^{[1]} \\quad b_2^{[1]}]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">= [ \\quad z_2^{[1]}]\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">转置之后：\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">x_1^{[0]}\\\\x_2^{[0]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_{1.1}^{[1]} \\quad w_{2.1}^{[1]}  \\\\w_{1.2}^{[1]} \\quad w_{2.2}^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">+</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">[b_1^{[1]} \\\\ b_2^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">=</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">[z_1^{[1]}] \\\\ z_2^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">激活函数也变成使用向量表示的形式：</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">sigmoid(Z^{[1]}) = A^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<blockquote>\n<p>这里表示每一项，每一个分量都要经过 <code>sigmoid</code> 计算。</p>\n</blockquote>\n<p>第二层的输入也会相应变成两个：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">a_1^{[1]}\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">a_2^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1^{[2]} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_2^{[2]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">+</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">b^{[2]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">=</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">z^{[2]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right] \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">sigmoid(Z^{[2]}) = a^{[2]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>此时的图像会变的更加多样：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322190244078\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322190244078-e0af0c8a230cd9b309fd5ac97793a1cc.png\" width=\"824\" height=\"481\" class=\"img_c29J\"></p>\n<p>尤其是分界线，已经不止是一条直线了，而是发生了弯曲。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322190340302\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322190340302-27047e855d391eae0154c401b0327fbb.png\" width=\"833\" height=\"522\" class=\"img_c29J\"></p>\n<p>如果我们继续增加神经元，增加到四个：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322190431511\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322190431511-a96cde186bd6e76357335819cb6b4a97.png\" width=\"435\" height=\"146\" class=\"img_c29J\"></p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">x_1^{[0]}\\\\x_2^{[0]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_{1.1}^{[1]} \\quad w_{2.1}^{[1]} \\quad w_{3.1}^{[1]} \\quad w_{4.1}^{[1]}  \\\\w_{1.2}^{[1]} \\quad w_{2.2}^{[1]} \\quad w_{3.2}^{[1]} \\quad w_{4.2}^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">+</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">[b_1^{[1]} \\\\ b_2^{[1]} \\\\ [b_3^{[1]} \\\\ b_4^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">=</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">[z_1^{[1]}] \\\\ z_2^{[1]} \\\\ [z_3^{[1]}] \\\\ z_4^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">a_1^{[1]}\\\\a_2^{[1]}\\\\a_3^{[1]}\\\\a_4^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]^\\mathrm T</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1^{[2]} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_2^{[2]} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_3^{[2]} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_4^{[2]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">+</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">b^{[2]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">=</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">z^{[2]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right] \\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>此时图形变化为：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322190509691\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322190509691-0b039e5b98f213ddc02a329aa888d643.png\" width=\"813\" height=\"592\" class=\"img_c29J\"></p>\n<p>无论是输出结果的曲面，还是分界线，他们的复杂程度大大增加：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322190536513\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322190536513-6933971fa9c15ce7d12a11ca10cdad7e.png\" width=\"840\" height=\"560\" class=\"img_c29J\"></p>\n<p>至此，我们持续增加神经元，图形的复杂程度会越来越高。</p>\n<p>数据家也证明了，只要增加的神经元足够多，任何一种复杂的曲线都能够被无限的接近表达出来，即万能逼近定理（通用近似定理）。</p>\n<p>神经网络要想实现万能逼近，其中有一个关键是<code>激活函数</code>。必须是非线性的，如果没有激活函数，再多的神经元也不会增加模型的复杂性。模型的图像只会是一个超平面。常用的激活函数如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322193525270\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322193525270-13f5e1e013149bd3ce48c3c0ea6fb83a.png\" width=\"869\" height=\"643\" class=\"img_c29J\"></p>\n<p>也可以是：<code>sin(x) sinc(x) Gaussion(x)</code> 。不同的激活函数对应的图形是非常不同的。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"激活函数深入\">激活函数深入<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0%E6%B7%B1%E5%85%A5\" class=\"hash-link\" aria-label=\"激活函数深入的直接链接\" title=\"激活函数深入的直接链接\">​</a></h2>\n<p>为什么增加更多的神经元会有更强的能力，从另一个角度进行解释。</p>\n<p>将前面神经网络部分看作为一个黑盒，不论输入的数据是什么样子，最终输出到最后一个神经元只是一个计算结果。假设他有 10 维。如图：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322193938404\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322193938404-3bab29078b67439b444ab52fc82a39d3.png\" width=\"567\" height=\"451\" class=\"img_c29J\"></p>\n<p>数据从2维到10维。其中的关键是数据的输入进行了一个矩阵运算，矩阵对一个向量进行操作。将其变为另外一个向量：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322194200931\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322194200931-b3b6c937fb62d2d15a9d11254513a678.png\" width=\"1045\" height=\"448\" class=\"img_c29J\"></p>\n<p>例如如下的向量：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">1\\\\1</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322194307256\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322194307256-9142512479a7721eb7e8e93a8b848d29.png\" width=\"923\" height=\"562\" class=\"img_c29J\"></p>\n<p>进行如下的运算：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">1\\\\1</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">cos\\theta \\quad -sin\\theta\\\\sin\\theta \\quad cos\\theta</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>将向量旋转 <code>θ</code> 角度：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322194625846\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322194625846-f4aa6003cf357b124c2f42fbc12388b2.png\" width=\"640\" height=\"387\" class=\"img_c29J\"></p>\n<p>那么这个矩阵的作用就是使向量发生旋转。</p>\n<p>那么如下的矩阵，完全可以起到对向量进行升维的作用：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">1\\\\1</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_{1.1} \\quad w_{2.1} \\quad w_{3.1} \\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_{1.2} \\quad w_{2.2} \\quad w_{3.2} </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322194922199\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322194922199-351451e02a2e2d62d6e3d24cb6150c52.png\" width=\"489\" height=\"385\" class=\"img_c29J\"></p>\n<p>如果数据只是二维的，它们互相参杂在一起，很难直接用直线对数据进行划分：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322195040705\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322195040705-8031b65cf1879bcb50859a09f4e05cde.png\" width=\"503\" height=\"380\" class=\"img_c29J\"></p>\n<p>如果对它们进行升维：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322195114768\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322195114768-c04692051efa0f766a0f0efe534a8713.png\" width=\"476\" height=\"375\" class=\"img_c29J\"></p>\n<p>用跟简单的模型也可以将他们分开：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322195132104\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322195132104-04d452a68f0aba0bc99250d7ec0d22da.png\" width=\"550\" height=\"393\" class=\"img_c29J\"></p>\n<p>因此，我们可以把神经元中中间的操作看作是数据升维的操作：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322195221569\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322195221569-09bd100acfeb8de947860754a8f165ea.png\" width=\"423\" height=\"275\" class=\"img_c29J\"></p>\n<p>有多少神经元，就会把数据升到多少维。只要维度够高，一定会找到一个超平面，能对数据完成划分。</p>\n<p>这样就变成了我们之前讨论的 <code>f(x)</code> 问题：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322195351911\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322195351911-5aa536d178dfdaa1518f37d5abbcaaff.png\" width=\"920\" height=\"479\" class=\"img_c29J\"></p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"多分类问题\">多分类问题<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98\" class=\"hash-link\" aria-label=\"多分类问题的直接链接\" title=\"多分类问题的直接链接\">​</a></h3>\n<p>一个神经网络并不是只能有一个输出节点，处理二分类问题。也可以有多个节点，进行多分类问题的讨论：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322195656661\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322195656661-210ebe930ed96272546dada9f2600cd2.png\" width=\"740\" height=\"441\" class=\"img_c29J\"></p>\n<p>其实质也是在每一个输出节点上进行二分类判断，将各个节点综合起来，就可以去解决多分类问题。真实的场景中，并不像是上述描述的粗糙，而是通过 <code>softMax(Y)</code>函数进行统一描述。函数表达式如下：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">softMax(\\hat{Y}) = \\frac{e^{\\hat{y_i}}}{\\sum_{j=1}^4e^{\\hat{y_j}}}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>就是对 <code>singmoid(x)</code> 函数的扩展和升级。</p>\n<p>完整的神经网络如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322200530988\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322200530988-c99920a5d01a4fd11e8ce59f89789873.png\" width=\"673\" height=\"508\" class=\"img_c29J\"></p>\n<p>这里的隐藏层暂时理解为对数据进行升维操作。不过更常见的神经网络应该是如下的表示：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322200647520\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322200647520-1f775003d4f504a045ab93e39bd9a150.png\" width=\"872\" height=\"455\" class=\"img_c29J\"></p>\n<p>基于如上的神经网络，继续使用隐藏层就是对数据升维的看法，就会出现问题，从左到右，神经元的个数在递减。我们仍然回归到简单问题：</p>\n<p>神经网络的输入输出可以是：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322200840361\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322200840361-f8eaa858eb3d0120ac5f9ec597d02b9f.png\" width=\"515\" height=\"378\" class=\"img_c29J\"></p>\n<p>基于上述神经网络很难有新的发现，我们只需要将问题换成下述这样，就会有新的发现：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322201001608\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322201001608-7dcd40745203d1360d96d3081d8f7a1b.png\" width=\"480\" height=\"417\" class=\"img_c29J\"></p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"案例分析----判断面部表情--ocr\">案例分析  - 判断面部表情 &amp; OCR<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90----%E5%88%A4%E6%96%AD%E9%9D%A2%E9%83%A8%E8%A1%A8%E6%83%85--ocr\" class=\"hash-link\" aria-label=\"案例分析  - 判断面部表情 &amp; OCR的直接链接\" title=\"案例分析  - 判断面部表情 &amp; OCR的直接链接\">​</a></h3>\n<p>上述的数据维度完全可以看作是判断一个人心情的特征。在现实生活中，可没有这么清晰的输入数据去让模型进行判断。而在现实生活中存在可能是这样的一张原始图片：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322201056290\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322201056290-8ba9f049a5b8e3a2dfd03e143bc0c97a.png\" width=\"265\" height=\"332\" class=\"img_c29J\"></p>\n<p>图片上的每一个像素都是数据的一个维度：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322201249208\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322201249208-715fa0856b41d3218072f56f2376dec2.png\" width=\"718\" height=\"492\" class=\"img_c29J\"></p>\n<p>这时候在加入隐藏层：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240322201311835\" src=\"https://yuluo-yx.github.io/assets/images/image-20240322201311835-500a45e7e4248c45183d46bd1b94654a.png\" width=\"857\" height=\"476\" class=\"img_c29J\"></p>\n<p>就可以理解成人类面部表情的特征。</p>\n<p>为什么这里反而降维了呢？这是因为这里的一个特征，并不需要原始数据里的所有维度。例如眼睛的动作，我们完全可以只关注眼镜的像素点。</p>\n<p>这里隐藏层就可以理解成对上一层原始数据的抽象。</p>\n<p>如果只是到此程度的话，还是不能有效的解释为什么神经网络需要这么多层。这时候如果我们换个问题继续理解，就会明白。</p>\n<p>比如我们需要使用神经网络去判断手写的数字：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323184129253.png\" alt=\"image-20240323184129253\" style=\"zoom:67%;\">\n<p>比如数字 8 ，神经网络很可能会将 8 上下两部分的特征提取出来作为判断的依据。如图：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323184311528.png\" alt=\"image-20240323184311528\" style=\"zoom:67%;\">\n<p>这里将其放在第二个隐藏层的原因是，两个圆可能还有其自己的子特征：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323184422041.png\" alt=\"image-20240323184422041\" style=\"zoom:67%;\">\n<p>他们都由四部分圆弧组成。这样做的好处是在遇到同样的特征时可以复用，比如数字 6 ，下半部分也是一个圆圈的结构，下面的特征就可以和 8 进行复用。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323184635859.png\" alt=\"image-20240323184635859\" style=\"zoom:67%;\">\n<p>上半部分的一竖才是数字 6 独有的特征。</p>\n<p>对应的数字 5 ，下半部分是半个圆弧，同样也可以进行复用，不同的特征只有上面的 一横 这一部分。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323184805162.png\" alt=\"image-20240323184805162\" style=\"zoom:67%;\">\n<p>对神经网络的层数可以理解为：隐藏层越深，对数据的抽象程度越高。</p>\n<blockquote>\n<p>这里只是用了我们人能理解的特征进行描述，神经网络自己学习到的特征，可能人无法理解，但是预测结果同样十分准确。</p>\n</blockquote>\n<p>上述的就是对一个完整的神经网络的描述。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323185042001.png\" alt=\"image-20240323185042001\" style=\"zoom:67%;\">\n<blockquote>\n<p>模型  -&gt; 隐藏层</p>\n<p>策略 -&gt; 输出层</p>\n<p>其实在输入层也需要对数据进行预处理。随着算力需求越来越大，如何对数据进行预处理使其得到最佳结果。也是一个非常重要的问题。</p>\n</blockquote>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"算法---梯度下降算法\">算法 - 梯度下降算法<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E7%AE%97%E6%B3%95---%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E7%AE%97%E6%B3%95\" class=\"hash-link\" aria-label=\"算法 - 梯度下降算法的直接链接\" title=\"算法 - 梯度下降算法的直接链接\">​</a></h2>\n<p>在神经网络中，这个算法没有别的，就是反向传播（梯度下降）算法。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323185330009.png\" alt=\"image-20240323185330009\" style=\"zoom:67%;\">\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"算法推导\">算法推导<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC\" class=\"hash-link\" aria-label=\"算法推导的直接链接\" title=\"算法推导的直接链接\">​</a></h3>\n<p>一个神经网络我们完全看作是一个这样的函数：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f_w(X) = \\hat{Y}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>只不过这个函数相当复杂而已。如果神经网络已经训练成功，在进行判断和决策的时候，他们的输入就是 X 系数 W 是作为参数。这个过程称之为正向传播。但是，如果一个神经网络正在被训练，他们之间的关系就会变得相关。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f_X(W) = \\hat{Y}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>x 作为已知的参数，系数作为变量，是需要求解的。因此，函数的图像也会发生相应的变化。如图为一个正向传播的函数图像：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323185807364.png\" alt=\"image-20240323185807364\" style=\"zoom:80%;\">\n<p>如果将系数 W 看作变量的话，坐标不再是 x1 和  x2 而是 w1 和 w2。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323185917793.png\" alt=\"image-20240323185917793\" style=\"zoom:80%;\">\n<p>上图为一个简化处理，这里我们假设不知道神经网络的具体情况，只是将 所有的系数看成是一个向量。后面我们会修正图像。这里的最高点就是我们在选择策略后希望出现的结果。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323190054804.png\" alt=\"image-20240323190054804\" style=\"zoom:50%;\">\n<p>我们这里的结果不是求出 Y 的值，而是求出令 Y 最大时 W 的取值。</p>\n<p>这个 W 的取值就是最高点在系数平面上的投影：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323190459383.png\" alt=\"image-20240323190459383\" style=\"zoom:50%;\">\n<p>不过，我们在初始化一个神经网络的时候，系数 W 可能出现在任何一个位置，理想情况下，他到最优点的距离就是我们求解的目标：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323190600402.png\" alt=\"image-20240323190600402\" style=\"zoom:50%;\">\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f_x(W^*) = \\hat{Y_*} </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">W - W^* = \\Delta W</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>但是在实际场景，上述 W 的值很难直接计算出来。如果利用如下的方式，我们就可以求出：</p>\n<p>在曲面上的任意一点：都可以求出一个向量：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323190857379.png\" alt=\"image-20240323190857379\" style=\"zoom:50%;\">\n<p>这个向量总是指向上升最快的方向：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323190950437.png\" alt=\"image-20240323190950437\" style=\"zoom:50%;\">\n<p>那么这个向量在参数平面上的<code>投影</code>就叫做 <code>梯度</code>。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323191034894.png\" alt=\"image-20240323191034894\" style=\"zoom:50%;\">\n<p>梯度总是指向上升最快的方向，那么为何称为梯度下降法呢？在选择策略的时候，有的策略是求最大，有的是求最小。为了将其统一看待，即便是求最大的问题，我们也可以在其上加上负号使其变成求最小的问题。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323191347399.png\" alt=\"image-20240323191347399\" style=\"zoom:50%;\">\n<p>不过虽然的这里曲面反了，但是梯度仍然是指向上升最快的方向。所以在具体操作的时候，会对梯度先求反，这样梯度就会指向下降最快的方向。这就是这个算法  <code>梯度下降法</code>的由来，不过其本质仍然相同。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323191619191.png\" alt=\"image-20240323191619191\" style=\"zoom:50%;\">\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"梯度下降法在模型中的应用\">梯度下降法在模型中的应用<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E6%B3%95%E5%9C%A8%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8\" class=\"hash-link\" aria-label=\"梯度下降法在模型中的应用的直接链接\" title=\"梯度下降法在模型中的应用的直接链接\">​</a></h3>\n<p>梯度总是指向上升最快的方向，即总是和等高线垂直。梯度本身是一个向量，所以就代表了他在所有参数维度上都有分量。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323191828250.png\" alt=\"image-20240323191828250\" style=\"zoom:50%;\">\n<p>如果所有的参数都按照梯度的分量进行调整，这样就代表参数 W 做出了当前情况下最好的选择。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1\\\\w_2 \\\\ \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\pm</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\Delta{w_1}\\\\\\Delta{w_2} \\\\ \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>一次次慢慢移动，总会接近其级值点。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323191930106.png\" alt=\"image-20240323191930106\" style=\"zoom:50%;\">\n<p>即便在这样的场景下，仍然存在问题，梯度只是指向了上升最快的方向，而没有指出其上升时每一步的步长。</p>\n<p>步长在梯度下降法中通常用 η 来表示，也就是通常所说的学习率了。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1\\\\w_2 \\\\ \\cdots \\\\ \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\pm</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\eta ·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\Delta{w_1}\\\\\\Delta{w_2} \\\\ \\cdots \\\\ \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>它是一个超参数，不能由神经网络学习得到，需要手动进行配置。</p>\n<blockquote>\n<p>η 过大就会很快接近极值点，但是会造成反复横跳，无法收敛的结果。</p>\n<p>η 过小，整体路径最优，移动相同次数，移动距离会比较短。</p>\n<p>现在已经有了很多梯度下降的进阶方案。</p>\n</blockquote>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"算法实践\">算法实践<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E7%AE%97%E6%B3%95%E5%AE%9E%E8%B7%B5\" class=\"hash-link\" aria-label=\"算法实践的直接链接\" title=\"算法实践的直接链接\">​</a></h3>\n<p>现在我们已经理解了其思路，如何求出梯度？就是如何求出分量的具体值。如果非常笼统的看待：求梯度的答案为对函数求偏导。每一个变量的维度都要求偏导。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">w_1\\\\w_2 \\\\ \\cdots \\\\ \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\pm</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\eta ·</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\frac{\\partial{f}}{\\partial{w_1}}\\\\\\frac{\\partial{f}}{\\partial{w_2}}\\\\ \\cdots \\\\ \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>上述中的梯度也可以用 ∇f 表示，读作 nablaf。</p>\n<p>接下来的问题是具体如何求出偏导。如果我们把神经网络整体看作是一个黑盒。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323193708237.png\" alt=\"image-20240323193708237\" style=\"zoom:50%;\">\n<blockquote>\n<p>输入层是 X 不同的系数 W 对应不同的 Y 值。w 全部在黑盒中。</p>\n</blockquote>\n<p>所谓的梯度下降便是：将计算出来的梯度反向传播到神经网络中，让所有的 W 进行修改。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323193835793.png\" alt=\"image-20240323193835793\" style=\"zoom:50%;\">\n<p>对于神经网络麻烦的一点是：不同的 W 之间是存在依赖关系的，不是单独存在。这个依赖关系就是神经网络的结构图。因此要想计算出每个系数对应梯度的分量还需要将黑盒拆开才行。那么，这个黑盒里面到底是什么？</p>\n<p>其本质就是如下图中的三行表达式：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323194153127.png\" alt=\"image-20240323194153127\" style=\"zoom:50%;\">\n<p>这里的表达式都是在进行向量计算，所以为了后面的表达方便，将其使用下面的形式表示：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">ReLU(X·W^{[1]}) = A^{[1]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f_k^{[1]}(W^{[k]}_1) = a^{[1]}_k</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">ReLU(A^{[1]}·W^{[2]}) = A^{[2]}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f_j^{[2]}(A^{1},W^{[2]}_j) = a^{[2]}_j</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">softmax(A^{2},W^{[3]})</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">f_i^{[3]}(A^{2},W^{[3]}_i) = a^{[3]}_i</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>其中 i,j,k 分别对应这一层不同的神经元。</p>\n<p>我们先来分析最下面这一个表达式：它表示的是某一个节点上要完成的计算。</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323194928901.png\" alt=\"image-20240323194928901\" style=\"zoom:50%;\">\n<p>它的梯度等于：对所有变量的维度求偏导。</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\nabla{f_i^{3}} = </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\left[</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\begin{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\frac{\\partial{f^{[3]}_i}}{\\partial{w^{[3]}_{i,1}}}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\frac{\\partial{f^{[3]}_i}}{\\partial{w^{[3]}_{i,2}}}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\ \\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\frac{\\partial{f^{[3]}_i}}{\\partial{a^{[3]}_{1}}}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\frac{\\partial{f^{[3]}_i}}{\\partial{a^{[3]}_{2}}}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\\\</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\cdots</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\end{matrix}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">\\right]</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>这里同时也要对 A 求偏导，因为 A 也是一个当前节点的输入数据，关系如下：</p>\n<img src=\"https://yuluo-yx.github.io/img/machine_learning/image-20240323195607817.png\" alt=\"image-20240323195607817\" style=\"zoom:50%;\">\n<p>我们在考虑之前一个神经元的参数求导时，需要结合前面一层神经元的影响，即 J 层的 a 系数的偏导表达式为：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">W_j^{[2]} \\pm \\eta^2·\\frac{\\partial{f_j^{[2]}}}{\\partial{W_j^{[2]}}}\\sum_{i=1}^4\\frac{\\partial{f_i^{[3]}}}{\\partial{f_j^{[2]}}}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>K 层的偏导系数的表达式为：</p>\n<div class=\"language-latex codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-latex codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">W_k^{[1]} \\pm \\eta^3\\sum_{j=1}^7\\sum_{i=1}^4\\frac{\\partial{f_k^{[1]}}}{\\partial{W_k^{[1]}}}\\frac{\\partial{f_j^{[2]}}}{\\partial{f_k^{[1]}}}\\frac{\\partial{f_i^{[3]}}}{\\partial{f_j^{[2]}}}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>如果反向传播的次数越多，那么学习率的次数就越高。我们知道学习率往往是小于 1 的，那么经过次方运算之后再和梯度相乘，就不会对参数做出多少调整，这也是我们经常说的梯度消失问题。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"总结\">总结<a href=\"https://yuluo-yx.github.io/blog/deep-learn-init#%E6%80%BB%E7%BB%93\" class=\"hash-link\" aria-label=\"总结的直接链接\" title=\"总结的直接链接\">​</a></h2>\n<p>到这里为止，就描述完了神经网络里的模型，算法和策略。</p>",
            "url": "https://yuluo-yx.github.io/blog/deep-learn-init",
            "title": "深度学习初探",
            "summary": "尝试理解神经网络的工作原理！旧文新发。",
            "date_modified": "2025-01-01T15:45:35.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "AI",
                "machine learning"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-memory-source",
            "content_html": "<p>LLM 模型本身是一个无状态的模型，没有临时记忆的能力。当发生如下场景时，就会产生错误回答：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RestController</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/ai\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AIController</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token plain\"> chatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AIController</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Builder</span><span class=\"token plain\"> builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">chatClient </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">build</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/chat/{msg}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">chat</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@PathVariable</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> msg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">chatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">msg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">call</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">chatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getResult</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOutput</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>启动项目，访问接口时会出现：</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 1</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">input：你好，我的名字叫牧生</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">output：你好，牧生！很高兴认识你。我叫通义千问，是阿里云开发的超大规模语言模型。我可以帮助你解答问题、提供信息或进行各种话题的讨论。有什么我可以帮到你的吗？</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 2</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">input：我叫什么名字</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">output：您没有告诉我您的名字，所以我无法直接回答。如果您愿意分享，可以告诉我您的名字是什么。</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>第二次调用 llm 发送 prompt，大模型无法记住第一轮的上下文，所以无法给出正确的答案。</p>\n<p>要实现一个可以让大模型具有聊天记忆能力，根据之前的聊天信息进行回答，应该如何如何实现呢？</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"手动实现一个-chat-memory\">手动实现一个 Chat Memory<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-memory-source#%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA-chat-memory\" class=\"hash-link\" aria-label=\"手动实现一个 Chat Memory的直接链接\" title=\"手动实现一个 Chat Memory的直接链接\">​</a></h2>\n<p>在实现之前，先了解下 Spring AI 的 Message 类型，确保塞到正确的 Message 类型中，避免出现错误。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Message\" src=\"https://yuluo-yx.github.io/assets/images/ai-20-60eac8513f0713b69178710892ba1314.png\" width=\"3046\" height=\"1804\" class=\"img_c29J\"></p>\n<p>其中：</p>\n<ul>\n<li>UserMessage：用户消息，指用户输入的 prompt；</li>\n<li>SystemMessage：系统限制性消息，通常用于指定 LLM 角色，一般只会设置一次；</li>\n<li>AssistantMessage：LLM 输出；</li>\n<li>FunctionMessage：函数调用时的消息。</li>\n</ul>\n<p>为此，可以写出如下的代码：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RestController</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/ai\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AIController</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> historyMessage </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ArrayList</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token plain\"> chatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AIController</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Builder</span><span class=\"token plain\"> builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">chatClient </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">build</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/chat/{msg}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">chat</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@PathVariable</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> msg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 添加用户消息</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  historyMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">add</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">UserMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">msg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 调用大模型时，传入 list</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AssistantMessage</span><span class=\"token plain\"> output </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">chatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">historyMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">call</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">chatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getResult</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOutput</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 添加模型消息</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  historyMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">add</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">output</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> output</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 1</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">input：你好，我的名字叫牧生</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">output：你好，牧生！很高兴认识你。我叫通义千问，是阿里云研发的超大规模语言模型。我可以帮助你解答问题、提供信息或者进行聊天。有什么我可以帮到你的吗？</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 2</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">input：我叫什么名字</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">output：你刚才提到你的名字叫牧生。如果你有其他问题或需要进一步的帮助，请告诉我！</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>至此，已经实现了一个简单的 chat memory 功能。然后，我们来分析一波这种写法存在的问题：</p>\n<ol>\n<li>\n<p>historyMessage 的大小是无限的吗？</p>\n<p>在 java 代码中无限，但是 llm 的输入 Token 有限，例如 GPT，通义等模型的 Token 限制：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Token 限制\" src=\"https://yuluo-yx.github.io/assets/images/ai-21-7aac55ffc62f832ca23ccd7eaf71083f.png\" width=\"1136\" height=\"502\" class=\"img_c29J\"></p>\n</li>\n<li>\n<p>文本内容：在传递给 llm 的内容中，可能存在无关的文本，影响 llm 的输出，使其产生幻觉或者占用大量 token。</p>\n</li>\n<li>\n<p>没有和对话关联，直接从 list 中获取，正常应该是每次会话一个历史消息。</p>\n</li>\n<li>\n<p>数据不持久，在服务器关机重启之后数据丢失。</p>\n</li>\n<li>\n<p>没有相关策略合理组织 Message。</p>\n</li>\n</ol>\n<p>之后，来看下 Spring AI 的 chat Memory 实现</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"spring-ai-chat-memory\">Spring AI Chat Memory<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-memory-source#spring-ai-chat-memory\" class=\"hash-link\" aria-label=\"Spring AI Chat Memory的直接链接\" title=\"Spring AI Chat Memory的直接链接\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"chatmemory-接口\">ChatMemory 接口<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-memory-source#chatmemory-%E6%8E%A5%E5%8F%A3\" class=\"hash-link\" aria-label=\"ChatMemory 接口的直接链接\" title=\"ChatMemory 接口的直接链接\">​</a></h3>\n<p>Spring AI 中提供的对 Message 存取的接口。</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">interface</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatMemory</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">default</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">add</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token plain\"> message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">add</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// conversationId：会话ID， message：消息（包括用户消息和回复消息）</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 将 Message 添加到会话中</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">add</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> messages</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// conversationId：会话ID， </span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 取最新的几条数据，以此可以控制一次会话窗口的大小，比如对于 qwen-plsu 的 30720 token 限制</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">int</span><span class=\"token plain\"> lastN</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// conversationId：会话ID</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 清除对话历史消息</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">clear</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"inmemorychatmemory\">InMemoryChatMemory<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-memory-source#inmemorychatmemory\" class=\"hash-link\" aria-label=\"InMemoryChatMemory的直接链接\" title=\"InMemoryChatMemory的直接链接\">​</a></h3>\n<p>ChatMemory 的实现，表示为聊天对话历史记录提供内存存储；</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">InMemoryChatMemory</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">implements</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatMemory</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 主要数据结构</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> conversationHistory </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ConcurrentHashMap</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">InMemoryChatMemory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">add</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> messages</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">conversationHistory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">putIfAbsent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ArrayList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">conversationHistory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">addAll</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">messages</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">int</span><span class=\"token plain\"> lastN</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> all </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">conversationHistory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> all </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token plain\"> all</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">skip</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">long</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Math</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">max</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> all</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">size</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\"> lastN</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">clear</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">conversationHistory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">remove</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">conversationId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"使用方式\">使用方式<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-memory-source#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F\" class=\"hash-link\" aria-label=\"使用方式的直接链接\" title=\"使用方式的直接链接\">​</a></h3>\n<p>Spring AI 框架提供了三种Advisor来使用ChatMeomry。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"MessageChatMemoryAdvisor\" src=\"https://yuluo-yx.github.io/assets/images/ai-22-b77a4b0b16480e6f6b676573e202cb92.png\" width=\"3670\" height=\"1606\" class=\"img_c29J\"></p>\n<ul>\n<li>MessageChatMemoryAdvisor：查询对象会话ID的历史消息添加到提示词文本中，核心代码如下；</li>\n<li>PromptChatMemoryAdvisor：检索到的内存中的历史消息将添加到提示的系统文本中；</li>\n<li>VectorStoreChatMemoryAdvisor：检索向量数据库中的历史消息将添加到提示的系统文本中。</li>\n</ul>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RestController</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/ai\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AIController</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token plain\"> chatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatModel</span><span class=\"token plain\"> chatModel</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AIController</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Builder</span><span class=\"token plain\"> builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatModel</span><span class=\"token plain\"> chatModel</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">chatModel </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> chatModel</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">chatClient </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">chatModel</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">defaultAdvisors</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MessageChatMemoryAdvisor</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">InMemoryChatMemory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">build</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@GetMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/chatWithChatMemory\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">chatWithChatMemory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> chatId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> chatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">advisors</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      a </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> a</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">CHAT_MEMORY_CONVERSATION_ID_KEY</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> chatId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">CHAT_MEMORY_RETRIEVE_SIZE_KEY</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">call</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">chatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getResult</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOutput</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>访问：</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 1</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">input: http://localhost:8080/ai/chatWithChatMemory?chatId</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">10001</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&amp;</span><span class=\"token assign-left variable\" style=\"color:hsl(221, 87%, 60%)\">prompt</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\">你好，我是牧生</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">output：你好，牧生！很高兴认识你。有什么我可以帮到你的吗？</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 2</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">input：http://localhost:8080/ai/chatWithChatMemory?chatId</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">10001</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&amp;</span><span class=\"token assign-left variable\" style=\"color:hsl(221, 87%, 60%)\">prompt</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\">我是谁</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">output：您是这次对话的发起者，您之前提到您的名字叫牧生。如果您有其他身份或角色想要分享，或者有任何问题和需要帮助的地方，都欢迎告诉我！</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 当切换 chatId 时</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">input：http://localhost:8080/ai/chatWithChatMemory?chatId</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">10002</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&amp;</span><span class=\"token assign-left variable\" style=\"color:hsl(221, 87%, 60%)\">prompt</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\">我叫什么名字</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">output：您好！您刚才没有提到您的名字，所以我无法直接回答您的问题。如果您愿意分享，可以告诉我您的名字，或者如果您是在某种特定情境下问这个问题，也可以提供更多背景信息，这样我可能能更好地帮助您。如果这是一个私人问题，您也可以选择不回答。我在这里是为了支持您，有任何问题都可以问我。</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>其中参数<code>chatId</code> 表示会话 ID，实现上下文与会话绑定。<code>CHAT_MEMORY_RETRIEVE_SIZE_KEY</code> 表示历史会话最多100条发给AI。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"问题\">问题<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-memory-source#%E9%97%AE%E9%A2%98\" class=\"hash-link\" aria-label=\"问题的直接链接\" title=\"问题的直接链接\">​</a></h2>\n<p>通过两种方式都可以实现 chat memory，相比 spring ai 更加完善。</p>\n<p>但是也存在以下问题：</p>\n<ol>\n<li>\n<p>数据不持久，在服务器关机重启之后数据丢失；</p>\n</li>\n<li>\n<p>没有相关策略合理组织 Message。</p>\n</li>\n</ol>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"spring-ai-alibaba\">Spring AI Alibaba<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-memory-source#spring-ai-alibaba\" class=\"hash-link\" aria-label=\"Spring AI Alibaba的直接链接\" title=\"Spring AI Alibaba的直接链接\">​</a></h2>\n<blockquote>\n<p>Tips: Spring AI Alibaba 的 Chat Memory 功能正在开发中......</p>\n</blockquote>",
            "url": "https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-memory-source",
            "title": "大模型专栏--Spring AI Chat Memory 源码分析",
            "summary": "LLM 模型本身是一个无状态的模型，没有临时记忆的能力。当发生如下场景时，就会产生错误回答：",
            "date_modified": "2024-12-09T22:55:22.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "AI",
                "Spring AI Alibaba",
                "chat memory"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source",
            "content_html": "<p>Chat 功能是 LLMs 应用的最基础功能，任何功能都要向 LLMs 应用给输入，之后将获得 LLMs 的返回。其底层是 NLP 的实现。这篇文章中不会分析 LLMs 的底层实现，会分析一波 Spring AI Albaba 的 Chat 功能实现和 Spring AI 提供的 Chat 接口实现。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"spring-ai-chat-接口定义\">Spring AI Chat 接口定义<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#spring-ai-chat-%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89\" class=\"hash-link\" aria-label=\"Spring AI Chat 接口定义的直接链接\" title=\"Spring AI Chat 接口定义的直接链接\">​</a></h2>\n<p>从之前的 Spring AI Alibaba 使用示例中，我们可以看到，Spring AI 提供了两种 Chat Model 的实现，一种是比较低级的 ChatModel API，一种是高级的 ChatClient API。</p>\n<p>其两者的区别是：ChatModel 是针对于各个模型的客户端，而 ChatClient 是屏蔽底层模型差异性的客户端接口，基于 ChatClient，Spring AI 提供了强大的 Advisors 机制来扩展功能。Advisors API 的实现类似于 Spring 的 AOP，应用了 AOP 的编程思想。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"chatmodel-api\">ChatModel API<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#chatmodel-api\" class=\"hash-link\" aria-label=\"ChatModel API的直接链接\" title=\"ChatModel API的直接链接\">​</a></h3>\n<p>下面以 Spring AI Alibaba 的 DashScope ChatModel 为例来了解一下 ChatModel 的源码设计。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"ChatModel\" src=\"https://yuluo-yx.github.io/assets/images/ai-10-f4ce234c98cae3b94abe0ed11000fb5e.png\" width=\"2370\" height=\"2222\" class=\"img_c29J\"></p>\n<p>从 IDEA 生成的关系图来看：DashScopeChatModel 继承了 AbstractToolCallSupport 实现了 ChatModel 接口。其中 AbstractToolCallSupport 实现了 工具函数调用的 抽象逻辑，ChatModel 提供了 call() 和 stream() 方法，用来和 LLMs 进行交互。从四个维度来理解一下 ChatModel 做的事情：</p>\n<ol>\n<li>Options，模型配置参数的处理；</li>\n<li>call 和 stream 的调用；</li>\n<li>Function 处理；</li>\n<li>可观测处理。</li>\n</ol>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"options-处理\">Options 处理<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#options-%E5%A4%84%E7%90%86\" class=\"hash-link\" aria-label=\"Options 处理的直接链接\" title=\"Options 处理的直接链接\">​</a></h4>\n<p>在 Spring AI 中，将大模型的一些参数抽象成了 Options 的概念，其类结构如下图：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"DashScopeChatOptions\" src=\"https://yuluo-yx.github.io/assets/images/ai-11-627ddc4ad04ca870d7c5c8eb25361718.png\" width=\"918\" height=\"668\" class=\"img_c29J\"></p>\n<p>在 Spring AI Alibaba 中，对 ChatOptions 的参数支持在 application.yml 中指定，也支持在代码中通过 DashScopeChatOptions 提供的 Builder 方法进行构建：</p>\n<p>在 Spring AI Alibaba DascopeChatModel#createRequest 方法中：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DashScopeChatOptions</span><span class=\"token plain\"> options </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DashScopeChatOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">build</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DashScopeChatOptions</span><span class=\"token plain\"> updatedRuntimeOptions </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ModelOptionsUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">copyToTarget</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">          </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DashScopeChatOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    enabledToolsToUse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">addAll</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">runtimeFunctionCallbackConfigurations</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">updatedRuntimeOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    options </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ModelOptionsUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">merge</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">updatedRuntimeOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> options</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DashScopeChatOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">CollectionUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isEmpty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">defaultOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getFunctions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    enabledToolsToUse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">addAll</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">defaultOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getFunctions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">options </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ModelOptionsUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">merge</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">options</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">defaultOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DashScopeChatOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">CollectionUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isEmpty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">enabledToolsToUse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    options</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setTools</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getFunctionTools</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">enabledToolsToUse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>对 模型调用参数进行了一系列的 merge 操作。以通过代码设置的 options 为准，其次是以 application.yml 中配置的 options 参数。也就是说，通过代码设置的参数优先级高于配置文件。</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"call-和-stream-方法\">Call 和 Stream 方法<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#call-%E5%92%8C-stream-%E6%96%B9%E6%B3%95\" class=\"hash-link\" aria-label=\"Call 和 Stream 方法的直接链接\" title=\"Call 和 Stream 方法的直接链接\">​</a></h4>\n<blockquote>\n<p>在之前的版本中，Spring AI Alibaba 通过 SDK 来适配通义大模型，现在都使用 openapi 规范的接口去调用大模型。</p>\n</blockquote>\n<p>在 ChatModel 中，定义了 Call 和 Stream 方法，用来调用大模型，前者是朴素的调用方式，后者是流式调用。</p>\n<p>在 Model 接口中定义了 Call 方法：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">interface</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Model</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">TReq</span><span class=\"token generics\"> </span><span class=\"token generics keyword\" style=\"color:hsl(301, 63%, 40%)\">extends</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ModelRequest</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">TRes</span><span class=\"token generics\"> </span><span class=\"token generics keyword\" style=\"color:hsl(301, 63%, 40%)\">extends</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ModelResponse</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">TRes</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">call</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">TReq</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>在 StreamingModel 中定义了 stream 方法：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">interface</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StreamingModel</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">TReq</span><span class=\"token generics\"> </span><span class=\"token generics keyword\" style=\"color:hsl(301, 63%, 40%)\">extends</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ModelRequest</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">TResChunk</span><span class=\"token generics\"> </span><span class=\"token generics keyword\" style=\"color:hsl(301, 63%, 40%)\">extends</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ModelResponse</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Flux</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">TResChunk</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">TReq</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>通过代码可以看到在默认的 ChatModel 中组合了 Model 和 StreamingModel：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">interface</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatModel</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">extends</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Model</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Prompt</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatResponse</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StreamingChatModel</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Override</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatResponse</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">call</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Prompt</span><span class=\"token plain\"> prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatOptions</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getDefaultOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">default</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Flux</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatResponse</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Prompt</span><span class=\"token plain\"> prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">UnsupportedOperationException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"streaming is not supported\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>有了接口，且适配了不同模型之后，通过 createRequest 构造一个 DashScopeApi#ChatCompletionRequest 的 request 对象，用于发起调用：（）其中包含对 options 参数的处理和对 function 的处理）</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"># 构建请求参数</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DashScopeApi</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionRequest</span><span class=\"token plain\"> request </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createRequest</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">false</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"># 调用 </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">LLMs</span><span class=\"token plain\"> </span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">API</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ResponseEntity</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletion</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> completionEntity </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">retryTemplate</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">execute</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">ctx </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">dashscopeApi</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">chatCompletionEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"># 准备接受 </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">LLMs</span><span class=\"token plain\"> 响应</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">var</span><span class=\"token plain\"> chatCompletion </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> completionEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBody</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>在对 stream 方法的调用中，和 call 相同，细心的同学们，肯定发现了 createRequest 方法有两个参数，第一个是 prompt，第二个就是决定此次请求是否是流式调用：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionRequest</span><span class=\"token plain\"> request </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createRequest</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">true</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>继而，再去调用 dashScopeApi 的 chatCompletionStream 方法完成请求。最后接受响应。</p>\n<p>至此我们已经完成了对 call 和 stream 请求方式的解析，从源码实现上非常简单。现在来分析一下 Spring AI 中定义的用来接受模型响应的类 ChatResponse：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"ChatResponse\" src=\"https://yuluo-yx.github.io/assets/images/ai-12-cb56d388fb6264d37bbfd6f946705430.png\" width=\"1640\" height=\"1968\" class=\"img_c29J\"></p>\n<p>其中元数据接口专注于提供 AI 模型生成结果的更多背景信息和见解。它可能包括计算时间、模型版本和 Usage 等其他相关详细信息，以增强对各种应用中的 AI 模型输出的理解和管理。</p>\n<p>Generation 类是一个记录 AI 返回信息的实体类。有两个类成员：一个为 ChatGenerationMetadata，一个是 AssistantMessage。</p>\n<p>其中 AssistantMessage 是让 LLMs 知晓此类型的消息类型是作为用户响应生成的。实现了 Message 和 Content 类型：类图如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"AbstractMessage\" src=\"https://yuluo-yx.github.io/assets/images/ai-13-fce8608b648c77991fac9005bc044f88.png\" width=\"2112\" height=\"1332\" class=\"img_c29J\"></p>\n<p>我们可以看到有四种类型的实现，这里我们不讨论实现，后续文章会介绍。</p>\n<p>至此便是整个 Spring AI 的 ChatReponse 的源码实现，可以看到 Spring AI 定义了一系列的接口来约束实现类的行为。使得整个 Spring AI 体系逻辑更加严密。</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"function-处理\">Function 处理<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#function-%E5%A4%84%E7%90%86\" class=\"hash-link\" aria-label=\"Function 处理的直接链接\" title=\"Function 处理的直接链接\">​</a></h4>\n<p>在 LLMs 中为了解决实时性的问题，提供了函数调用的方式，可以调用外部的一些工具函数来补充自身知识，给用户正确的响应。在 Spring AI 中也提供了对函数调用的集成。</p>\n<p>下面以 DashScope 的 ChatModel 中的 Function 实现来分析一波具体的实现。在 IDEA 中关系图如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Spring AI Alibaba Function\" src=\"https://yuluo-yx.github.io/assets/images/ai-14-38bb4b59ffaac1a1df62a4ec16cf56cb.png\" width=\"2550\" height=\"1044\" class=\"img_c29J\"></p>\n<p>我们可以看到 Spring AI 主要通过 AbstractToolCallSupport 这个抽象类来完成整个函数调用的工具链抽象。通过构造组合相关的类，其中类说明如下：</p>\n<ol>\n<li>\n<p>AbstractToolCallSupport：（此类已经经过好几轮迭代，不知道后续会不会在变动，之前的名字是 AbstractFunctionCallSupport）其中维护一组 Map 集合的 FunctionCallback 对象，提供用于处理函数回调和运行函数的功能；</p>\n</li>\n<li>\n<p>FunctionCallback：接口实现，内部定义了一个 Function 必须要的一些属性和方法，如 Name，Desc 等；</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">interface</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionCallback</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getInputTypeSchema</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">call</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> functionInput</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>FunctionCallbackContext：实现 Spring 的 ApplicationContextAware 接口，从 Spring context 中获取 Function Bean；</p>\n</li>\n<li>\n<p>AbstractFunctionCallback：承上启下，对大模型需要转换为大模型需要的函数调用协议，对于3rd，需要包装调用第三方服务或者函数。在使用上对该类是无感知的；</p>\n</li>\n<li>\n<p>FunctionCallbackWrapper：将输出转换为模型可以使用的格式，默认实现是将输出发送给模型之前将其转换为字符串。可以提供一个自定义的函数<code>responseConverter</code>实现来覆盖此操作。</p>\n</li>\n</ol>\n<p>此小节中，将从以下几个方面来分析：</p>\n<ol>\n<li>函数是如何定义以及如何被 LLMs 感知到的？</li>\n<li>Spring AI 在调用 LLMs 时对 Function 做了那些处理？</li>\n<li>一个完整的 Function 调用流程。</li>\n</ol>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"1-function-定义和-llms-感知\">1. Function 定义和 LLMs 感知<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#1-function-%E5%AE%9A%E4%B9%89%E5%92%8C-llms-%E6%84%9F%E7%9F%A5\" class=\"hash-link\" aria-label=\"1. Function 定义和 LLMs 感知的直接链接\" title=\"1. Function 定义和 LLMs 感知的直接链接\">​</a></h5>\n<p>通过上面的类说明，可以知道 Spring AI 的 Function Bean 通过 Spring 提供的 IOC 机制来发现和注册 Function，在 FunctionCallbackContext 中：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionCallback</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getFunctionCallback</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@NonNull</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> beanName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Nullable</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> defaultDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Type</span><span class=\"token plain\"> beanType </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionContextUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">findType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">applicationContext</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBeanFactory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\">beanName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">beanType </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">IllegalArgumentException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Functional bean with name: \"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> beanName </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\" does not exist in the context.\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Function</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isAssignableFrom</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionTypeUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getRawType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">beanType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&amp;&amp;</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">BiFunction</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isAssignableFrom</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionTypeUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getRawType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">beanType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">IllegalArgumentException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Function call Bean must be of type Function or BiFunction. Found: \"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> beanType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getTypeName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Type</span><span class=\"token plain\"> functionInputType </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">TypeResolverHelper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getFunctionArgumentType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">beanType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Class</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> functionInputClass </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionTypeUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getRawType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">functionInputType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> functionDescription </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> defaultDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">hasText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">defaultDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Description</span><span class=\"token plain\"> descriptionAnnotation </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Description</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">applicationContext</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">findAnnotationOnBean</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">beanName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Description</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">descriptionAnnotation </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    functionDescription </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> descriptionAnnotation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">hasText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">functionDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonClassDescription</span><span class=\"token plain\"> jsonClassDescriptionAnnotation </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonClassDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\">functionInputClass</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAnnotation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonClassDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">jsonClassDescriptionAnnotation </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        functionDescription </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> jsonClassDescriptionAnnotation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">hasText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">functionDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">IllegalStateException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Could not determine function description.Please provide a description either as a default parameter, via @Description annotation on the bean or @JsonClassDescription annotation on the input class.\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Object</span><span class=\"token plain\"> bean </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">applicationContext</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBean</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">beanName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">bean </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">instanceof</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Function</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Function</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> function </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Function</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\">bean</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionCallbackWrapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">function</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">withName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">beanName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">withSchemaType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">schemaType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">withDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">functionDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">withInputType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">functionInputClass</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">build</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">bean </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">instanceof</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">BiFunction</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">BiFunction</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> biFunction </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">BiFunction</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\">bean</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionCallbackWrapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">biFunction</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">withName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">beanName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">withSchemaType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">schemaType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">withDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">functionDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">withInputType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">functionInputClass</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">build</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">IllegalArgumentException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Bean must be of type Function\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>可以看到：</p>\n<ol>\n<li>先通过 FunctionContextUtils.findType() 获取 bean 类型；</li>\n<li>检查 Bean 类型是否为 Function 或者 BiFunction 类型；</li>\n<li>获取 Function 参数类型并转换为对应的 Bean 类型；</li>\n<li>获取函数描述：如果 <code>defaultDescription</code> 为空，尝试从 bean 的注解（如 <code>@Description</code> 或 <code>@JsonClassDescription</code>）获取描述。找不到描述，则抛出 <code>IllegalStateException</code>。</li>\n<li>获取 Bean 创建 FunctionCallbackWrapper 对象。</li>\n</ol>\n<p>至此，便有了一个包装的 FunctionCallbackWrapper 实例对象，在 DashScopeChatModel#createRequest() 整合 Function 信息，</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionMessage</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> chatCompletionMessages </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getInstructions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">map</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">message </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">USER</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">||</span><span class=\"token plain\"> message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">SYSTEM</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Object</span><span class=\"token plain\"> content </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">message </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">instanceof</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">UserMessage</span><span class=\"token plain\"> userMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">CollectionUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isEmpty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">userMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMedia</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                content </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">convertMediaContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">userMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">content</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionMessage</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Role</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">valueOf</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">ASSISTANT</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">var</span><span class=\"token plain\"> assistantMessage </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AssistantMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ToolCall</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> toolCalls </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">CollectionUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isEmpty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">assistantMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getToolCalls</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            toolCalls </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> assistantMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getToolCalls</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">map</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">toolCall </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">var</span><span class=\"token plain\"> function </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionFunction</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">toolCall</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> toolCall</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">arguments</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ToolCall</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">toolCall</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">id</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> toolCall</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">type</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> function</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">assistantMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionMessage</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Role</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">ASSISTANT</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> toolCalls</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">TOOL</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ToolResponseMessage</span><span class=\"token plain\"> toolMessage </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ToolResponseMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        toolMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getResponses</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">forEach</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">response </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Assert</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isTrue</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">id</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"ToolResponseMessage must have an id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Assert</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isTrue</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"ToolResponseMessage must have a name\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> toolMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getResponses</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">map</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">tr </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">tr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">responseData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionMessage</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Role</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">TOOL</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> tr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    tr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">id</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">IllegalArgumentException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Unsupported message type: \"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMessageType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">flatMap</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">::</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>之后传给 LLMs，在 LLMs 判断需要调用函数的时候给 Spring AI 发送信号，完成调用。</p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"2-spring-ai-functions\">2. Spring AI Functions<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#2-spring-ai-functions\" class=\"hash-link\" aria-label=\"2. Spring AI Functions的直接链接\" title=\"2. Spring AI Functions的直接链接\">​</a></h5>\n<p>上面我们已经基本分析完成了 Function 的大部分能力。接下来分析以下在 Spring AI 中是如何调用 Function ，以及 LLMs 给了 Spring AI 什么信号来调用 Function。我们来分析一波 DashScopeChatModel#call() 方法可以看到如下的代码，Spring AI 会根据 <code>finishReason</code> 来判断是否需要执行函数。具体代码如下：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"># </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DashScopeChatModel</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">java</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isToolCall</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">chatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">               </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Set</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionFinishReason</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">TOOL_CALLS</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionFinishReason</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">STOP</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">var</span><span class=\"token plain\"> toolCallConversation </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">handleToolCalls</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> chatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// Recursively call the call method with the tool call message</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// conversation that contains the call responses.</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">call</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">toolCallConversation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> chatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"># </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AbstractToolCallSupport</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">java</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">protected</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">boolean</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isToolCall</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatResponse</span><span class=\"token plain\"> chatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Set</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> toolCallFinishReasons</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Assert</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isTrue</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">CollectionUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isEmpty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">toolCallFinishReasons</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Tool call finish reasons cannot be empty!\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">chatResponse </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">false</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Generation</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> generations </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> chatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getResults</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">CollectionUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isEmpty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">generations</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">false</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> generations</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">anyMatch</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">g</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isToolCall</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">g</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> toolCallFinishReasons</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">protected</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">boolean</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isToolCall</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Generation</span><span class=\"token plain\"> generation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Set</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> toolCallFinishReasons</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> finishReason </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> generation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMetadata</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getFinishReason</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token plain\"> generation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMetadata</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getFinishReason</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> generation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOutput</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">hasToolCalls</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&amp;&amp;</span><span class=\"token plain\"> toolCallFinishReasons</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">map</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">s</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> s</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toLowerCase</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">contains</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">finishReason</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toLowerCase</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>在判断完成，如下需要调用函数，则会执行 AbstractToolCallSupport 中的 handleToolCalls 方法：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AssistantMessage</span><span class=\"token plain\"> assistantMessage </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Generation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\">toolCallGeneration</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOutput</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Object</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> toolContextMap </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatOptions</span><span class=\"token plain\"> var7 </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">var7 </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">instanceof</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionCallingOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionCallingOptions</span><span class=\"token plain\"> functionCallOptions </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FunctionCallingOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\">var7</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">CollectionUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isEmpty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">functionCallOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getToolContext</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            toolContextMap </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> functionCallOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getToolContext</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ToolResponseMessage</span><span class=\"token plain\"> toolMessageResponse </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">executeFunctions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">assistantMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ToolContext</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">toolContextMap</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">buildToolCallConversation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getInstructions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> assistantMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> toolMessageResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>最后执行完成将结果返回。</p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"3-function-call-debug\">3. Function Call Debug<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#3-function-call-debug\" class=\"hash-link\" aria-label=\"3. Function Call Debug的直接链接\" title=\"3. Function Call Debug的直接链接\">​</a></h5>\n<p>经过上面的代码分析我们搞清楚了代码编写，不过纸上看来终觉浅。现在我们来 debug 一波看看怎么个事。</p>\n<p>直接使用 Spring Al Alibaba 中的 function-calling-example：</p>\n<p>MockWeatherService Function 如下：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MockWeatherService</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">implements</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Function</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">MockWeatherService</span><span class=\"token generics class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Request</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Override</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">apply</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Request</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">city</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">contains</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"杭州\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">format</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"%s%s晴转多云, 气温32摄氏度。\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">date</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">city</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">city</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">contains</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"上海\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">format</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"%s%s多云转阴, 气温31摄氏度。\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">date</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">city</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">format</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"暂时无法查询%s的天气状况。\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">city</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@JsonInclude</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonInclude</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Include</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">NON_NULL</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@JsonClassDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"根据日期和城市查询天气\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">record</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@JsonProperty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">required </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">true</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> value </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"city\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@JsonPropertyDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"城市, 比如杭州\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> city</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@JsonProperty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">required </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">true</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> value </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"date\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@JsonPropertyDescription</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"日期, 比如2024-08-22\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> date</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>controller 代码如下，构造一个带有 Function 描述的 prompt：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@GetMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/weather-service\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">weatherService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> subject</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> chatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">function</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"getWeather\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"根据城市查询天气\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MockWeatherService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">subject</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">call</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">content</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<blockquote>\n<p>Tips:  Spring AI Function 提供多种 Function 使用的方式，通过在 prompt 的 function 参数指定或是通直接使用 @Bean 指定都可以达到使用目的，不必拘泥于形式。</p>\n</blockquote>\n<p>我们先从 call 的 FunctionCallbackContext#call() 方法开始打断点：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20241208195709304\" src=\"https://yuluo-yx.github.io/assets/images/ai-15-1bee66cc8833984ec49d727f0597b46b.png\" width=\"1802\" height=\"901\" class=\"img_c29J\"></p>\n<p>可以看到 function 信息已经在 chatOptions 对象中，带有 Function 描述等信息，接着往下可以看到第一次的 finishResaon 为 <code>TOOL_CALLS</code>，接下来 Spring AI 便会去执行函数</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20241208195934104\" src=\"https://yuluo-yx.github.io/assets/images/ai-16-be907476fc6f96224ff5ba4115ba0ab7.png\" width=\"1696\" height=\"826\" class=\"img_c29J\"></p>\n<p>在 AbstractToolCallSupport#executeFunctions() 打断点如下：便可看到 Function 执行的结果：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20241208200708564\" src=\"https://yuluo-yx.github.io/assets/images/ai-17-cf1f8c56989d0aef1415dc98757a8014.png\" width=\"1752\" height=\"882\" class=\"img_c29J\"></p>\n<p>当继续往下执行时，便会看到 finishReason 的数据为 <code>STOP</code>：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20241208201015609\" src=\"https://yuluo-yx.github.io/assets/images/ai-18-ec2104029ef640fcbc129b98e83ee827.png\" width=\"1829\" height=\"750\" class=\"img_c29J\"></p>\n<p>至此，便完成了 Function 的调用。</p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"4-总结\">4. 总结<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#4-%E6%80%BB%E7%BB%93\" class=\"hash-link\" aria-label=\"4. 总结的直接链接\" title=\"4. 总结的直接链接\">​</a></h5>\n<p>可以看到 Function 是一个非常强大的功能，可以弥补 LLMs 实时数据的缺陷性，给用户更好的回答。Spring AI 为我们提供了一套完整的 Function 解决方案。</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"可观测\">可观测<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#%E5%8F%AF%E8%A7%82%E6%B5%8B\" class=\"hash-link\" aria-label=\"可观测的直接链接\" title=\"可观测的直接链接\">​</a></h4>\n<p>可观测一直是行业内的重点话题，通过应用的各项指标，可以反映应用的健康状态，应用流量等。</p>\n<p>在 LLMs 的可观测应用中，可以看到 Token 的使用，每次的 Message 消息，耗时等。来帮助 LLMs 的开发者更好的调试 LLMs 应用的参数设置，来让应用提供最准确的回答。</p>\n<p>Spring AI 的可观测通过记录每次的 prompt 和一些元数据参数以及模型返回来达到可观测的目的：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatModelObservationContext</span><span class=\"token plain\"> observationContext </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatModelObservationContext</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">provider</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AiProvider</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">DASHSCOPE</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">requestOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token plain\"> prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">defaultOptions</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">build</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatResponse</span><span class=\"token plain\"> chatResponse </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatModelObservationDocumentation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">CHAT_MODEL_OPERATION</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">observation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">observationConvention</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">DEFAULT_OBSERVATION_CONVENTION</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> observationContext</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">observationRegistry</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">observe</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DashScopeApi</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionRequest</span><span class=\"token plain\"> request </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createRequest</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">false</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ResponseEntity</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletion</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> completionEntity </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">retryTemplate</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">execute</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">ctx </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">dashscopeApi</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">chatCompletionEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">var</span><span class=\"token plain\"> chatCompletion </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> completionEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBody</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">chatCompletion </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            logger</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">warn</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"No chat completion returned for prompt: {}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> prompt</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatCompletionOutput</span><span class=\"token generics class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Choice</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> choices </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> chatCompletion</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">output</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">choices</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Generation</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> generations </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> choices</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">stream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">map</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">choice </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// @formatter:off</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Object</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> metadata </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> chatCompletion</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">requestId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"role\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> choice</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">role</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token plain\"> choice</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">role</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"finishReason\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> choice</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">finishReason</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token plain\"> choice</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">finishReason</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// @formatter:on</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">buildGeneration</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">choice</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> metadata</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatResponse</span><span class=\"token plain\"> response </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">generations</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">from</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">completionEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBody</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        observationContext</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setResponse</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"chatclient-api\">ChatClient API<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source#chatclient-api\" class=\"hash-link\" aria-label=\"ChatClient API的直接链接\" title=\"ChatClient API的直接链接\">​</a></h3>\n<p>ChatClient 不针对特定的 LLMs 提供商，是一个比 ChatModel 更高级的 API。为 LLMs  提供直接入口，其通过 ChatModel 构建而来：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token plain\"> chatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatModel</span><span class=\"token plain\"> chatModel</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">AIController</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Builder</span><span class=\"token plain\"> builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatModel</span><span class=\"token plain\"> chatModel</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">chatModel </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> chatModel</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">chatClient </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ChatClient</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">chatModel</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">defaultAdvisors</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MessageChatMemoryAdvisor</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">InMemoryChatMemory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">build</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Spring AI 基于 ChatClient API，提供了一系列的 Advisor API，用来增强 ChatClient 的能力，其内部实现和 Spring AOP 同理。</p>\n<p>主要功能有：</p>\n<ul>\n<li>聊天记忆</li>\n<li>检索增强生成</li>\n<li>日志记录等</li>\n</ul>\n<p>官网文档地址：<a href=\"https://docs.spring.io/spring-ai/reference/api/chatclient.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.spring.io/spring-ai/reference/api/chatclient.html</a></p>",
            "url": "https://yuluo-yx.github.io/blog/LLMs-AI-Spring-AI-Alibaba-chat-source",
            "title": "大模型专栏--Spring AI Alibaba Chat 源码分析",
            "summary": "Chat 功能是 LLMs 应用的最基础功能，任何功能都要向 LLMs 应用给输入，之后将获得 LLMs 的返回。其底层是 NLP 的实现。这篇文章中不会分析 LLMs 的底层实现，会分析一波 Spring AI Albaba 的 Chat 功能实现和 Spring AI 提供的 Chat 接口实现。",
            "date_modified": "2024-12-08T21:24:56.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "AI",
                "Spring AI Alibabe",
                "chat"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-framework",
            "content_html": "<p>前面三篇文章中我们已经讨论了大模型是什么，大模型的应用场景以及开发生态。此篇文章我们主要讨论  AI 大模型的开发框架，以及他们各自做了哪些增强。</p>\n<blockquote>\n<p>本篇文章中，不介绍 Dify，AutoGen 等，主要以 LangChain 和 Spring AI 为主。</p>\n</blockquote>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"langchain\">LangChain<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-framework#langchain\" class=\"hash-link\" aria-label=\"LangChain的直接链接\" title=\"LangChain的直接链接\">​</a></h2>\n<blockquote>\n<p>官网定义：<strong>LangChain</strong> is a framework for developing applications powered by large language models (LLMs).</p>\n<p>翻译为：LangChain 是一个用于开发大模型（LLMs）应用的框架。</p>\n</blockquote>\n<p>如果看文档定义，大家可能一时感觉很迷糊，不知道什么是基于 LLMs 的应用程序。如果你看了我上一篇文章，肯定不会有这样的疑惑。</p>\n<p>当前最为流行的 LLMs 的应用程序一个是 RAG，一个是 Agent（智能体）。LangChain 为其构建提供支持。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"langchain-解决的问题\">LangChain 解决的问题<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-framework#langchain-%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98\" class=\"hash-link\" aria-label=\"LangChain 解决的问题的直接链接\" title=\"LangChain 解决的问题的直接链接\">​</a></h3>\n<p>There are several primary needs that LangChain aims to address:</p>\n<ol>\n<li><strong>Standardized component interfaces:</strong> The growing number of <a href=\"https://python.langchain.com/docs/integrations/chat/\" target=\"_blank\" rel=\"noopener noreferrer\">models</a> and <a href=\"https://python.langchain.com/docs/integrations/vectorstores/\" target=\"_blank\" rel=\"noopener noreferrer\">related components</a> for AI applications has resulted in a wide variety of different APIs that developers need to learn and use. This diversity can make it challenging for developers to switch between providers or combine components when building applications. LangChain exposes a standard interface for key components, making it easy to switch between providers.</li>\n<li><strong>Orchestration:</strong> As applications become more complex, combining multiple components and models, there's <a href=\"https://lilianweng.github.io/posts/2023-06-23-agent/\" target=\"_blank\" rel=\"noopener noreferrer\">a growing need to efficiently connect these elements into control flows</a> that can <a href=\"https://www.sequoiacap.com/article/generative-ais-act-o1/\" target=\"_blank\" rel=\"noopener noreferrer\">accomplish diverse tasks</a>. <a href=\"https://en.wikipedia.org/wiki/Orchestration_(computing)\" target=\"_blank\" rel=\"noopener noreferrer\">Orchestration</a> is crucial for building such applications.</li>\n<li><strong>Observability and evaluation:</strong> As applications become more complex, it becomes increasingly difficult to understand what is happening within them. Furthermore, the pace of development can become rate-limited by the <a href=\"https://en.wikipedia.org/wiki/Paradox_of_choice\" target=\"_blank\" rel=\"noopener noreferrer\">paradox of choice</a>. For example, developers often wonder how to engineer their prompt or which LLM best balances accuracy, latency, and cost. <a href=\"https://en.wikipedia.org/wiki/Observability\" target=\"_blank\" rel=\"noopener noreferrer\">Observability</a> and evaluations can help developers monitor their applications and rapidly answer these types of questions with confidence.</li>\n</ol>\n<p>官网描述如上，根据描述我们可以得出：LangChain 主要做了</p>\n<ol>\n<li>提供标准的组件接口：我们可以理解为屏蔽底层模型的差异，开发人员只关系其上的实现接口和功能开发即可，而不关心底层使用的是哪个模型，以及如何连接到大模型。</li>\n<li>编排：随着 Agent 不断发展，构建大型，复杂的 Agent 已经成为行业的挑战之一。LangChain 中的 Chain 便是其思想的实现，大模型应用由 Chain 组成并最终实现复杂的交互功能。</li>\n<li>可观测性和评估：在任何一个软件系统中，可观测一直是一个热门话题。通过观测，我们可以得知系统的健康程度，系统的性能瓶颈等等。在大模型应用的可观测中，我们可以看到什么样的 Prompt 是最适合的，可以让大模型给出最有用的回答。正确的评估模型可以帮助我们给出最正确的答案。</li>\n</ol>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"langchain-架构\">LangChain 架构<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-framework#langchain-%E6%9E%B6%E6%9E%84\" class=\"hash-link\" aria-label=\"LangChain 架构的直接链接\" title=\"LangChain 架构的直接链接\">​</a></h3>\n<p>了解每个系统组成之前，一张清晰的架构图是必不可少的：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"LangChain 主要组件和架构图\" src=\"https://yuluo-yx.github.io/assets/images/ai-7-ad442f61196d7fb03efc741fba63e75f.png\" width=\"1080\" height=\"627\" class=\"img_c29J\"></p>\n<p>从图中我们看出 LangChain 所做的事情和一些抽象行为。过多细节我们不再深入了。这里只是对 LangChain 有个大致了解和认知。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"langchain-生态\">LangChain 生态<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-framework#langchain-%E7%94%9F%E6%80%81\" class=\"hash-link\" aria-label=\"LangChain 生态的直接链接\" title=\"LangChain 生态的直接链接\">​</a></h3>\n<p>上面我们结束了 LangChain 要解决的问题和架构。下面了解一下围绕 LangChain 都做了哪些更高级的开发工具和框架。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"7c3ff150404c521defe05eabe61534c6\" src=\"https://yuluo-yx.github.io/assets/images/ai-8-dab1a1ab32885dd1b9830f202ac49bba.png\" width=\"1246\" height=\"1273\" class=\"img_c29J\"></p>\n<p>从图中，我们可以看到基于 LangChain 衍生出了一套非常庞大的大模型生态：</p>\n<ul>\n<li>LangChain ：Python 和 JavaScript 库，包含接口和集成，用于各种组件的相互组合，以及现成的 Chain 和 Agent 的实现。</li>\n<li>LangChain Tmpl：易于部署的各种任务的参考集合。</li>\n<li>LangServe：将 LangChain 应用部署为 Web 应用的组件库。</li>\n<li>LangSmith：开发平台。用于调试、测试、评估和监控基于 LLM 框架构建的应用，并与 LangChain 无缝集成。</li>\n</ul>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"spring-ai\">Spring AI<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-framework#spring-ai\" class=\"hash-link\" aria-label=\"Spring AI的直接链接\" title=\"Spring AI的直接链接\">​</a></h2>\n<p>上面我们已经了解了 LangChain。LangChain 是由 Python 语言编写的 LLMs 开发框架，社区提供了 js 的实现。另外还有 LangChain4j，LangChain4G 等实现。原来和上述类似。</p>\n<p>下面我们介绍一下 Spring AI，这款由 Spring 社区提供的 LLMs 应用开发框架。</p>\n<blockquote>\n<p>官网：<a href=\"https://docs.spring.io/spring-ai/reference/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.spring.io/spring-ai/reference/index.html</a></p>\n<p>官网介绍：The <code>Spring AI</code> project aims to streamline the development of applications that incorporate artificial intelligence functionality without unnecessary complexity.</p>\n<p>翻译：Spring AI 意在简化包含人工智能应用程序的开发，避免其不必要的复杂性。</p>\n</blockquote>\n<p>前面我们已经有了关于 LangChain 的了解。其实 Spring AI 和 LangChain 做了同样的事情，只不过 Spring AI 站在 Spring 的视角开发了 Spring 版本的 LangChain。大致思路相同，但是也在某些地方有差异。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"spring-ai-alibaba\">Spring AI Alibaba<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-framework#spring-ai-alibaba\" class=\"hash-link\" aria-label=\"Spring AI Alibaba的直接链接\" title=\"Spring AI Alibaba的直接链接\">​</a></h2>\n<p>Spring AI Alibaba 是基于 Spring AI Core 模块开发的适配 阿里通义大模型的 LLMs 应用开发框架，集成了阿里的开源中间件。方便国内开发者使用 Java 开发智能应用。生态图如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" src=\"https://img.alicdn.com/imgextra/i1/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png\" alt=\"img\" class=\"img_c29J\"></p>\n<p>接下来的文章中，便以 Spring AI 和 Spring AI Alibaba 的视角深入大模型开发！</p>",
            "url": "https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-framework",
            "title": "大模型专栏--大模型开发框架",
            "summary": "前面三篇文章中我们已经讨论了大模型是什么，大模型的应用场景以及开发生态。此篇文章我们主要讨论  AI 大模型的开发框架，以及他们各自做了哪些增强。",
            "date_modified": "2024-11-27T21:38:25.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "AI",
                "LLMs",
                "dev framework"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-ecosystem",
            "content_html": "<blockquote>\n<p>前面我们已经讨论过了什么是大模型以及使用场景有那些，这篇文章我们来讨论下大模型的开发生态？有哪些开发工具可以快速基于大模型构建出我们需要的应用。</p>\n</blockquote>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"发展趋势\">发展趋势<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-ecosystem#%E5%8F%91%E5%B1%95%E8%B6%8B%E5%8A%BF\" class=\"hash-link\" aria-label=\"发展趋势的直接链接\" title=\"发展趋势的直接链接\">​</a></h2>\n<p>任何事物的发展，都离不开生态的作用。人类生存的地球生态，有水，有氧气。才能生存。</p>\n<p>同样的道理，任何一门技术或者是语言都不能完全脱离于其生态。生态的作用是帮助技术更好的被人们应用，降低使用难度，方便开发者们使用。例如 Java 的 Spring 框架，Go 的  gin，ruby 的 rails 一样。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"大模型生态\">大模型生态<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-ecosystem#%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%94%9F%E6%80%81\" class=\"hash-link\" aria-label=\"大模型生态的直接链接\" title=\"大模型生态的直接链接\">​</a></h2>\n<p>我们不妨试着总结一下大模型生态的定义：围绕着 LLM 形成的一系列工具、平台、社区和技术标准的集合体，我们就可以称为大模型生态</p>\n<p>随着大模型的迅速爆火，各家都有自己的大模型出现。围绕着这些大模型，出现了许多的应用框架，应用技术，前面提到的 智能体 RAG 知识库 等。本篇我们就仔细梳理一些，都有那些大模型生态（不讨论底层的神经网络模型，关注上层的生态）。</p>\n<p>生态的出现往往是为了解决一系列的痛点问题。例如先是有了滴滴，还是先有了网络打车的需求？</p>\n<p>我们可以从大模型当前的使用痛点入手进行展开。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"数据安全\">数据安全<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-ecosystem#%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8\" class=\"hash-link\" aria-label=\"数据安全的直接链接\" title=\"数据安全的直接链接\">​</a></h3>\n<p>在第一篇文章中已经提到了，数据安全是当前大模型需要解决的一个主要问题。基于公司数据的知识库或者客服助手等应用场景都需要应对这个问题。</p>\n<p>当前有效的解决途径之一是将大模型和隐私计算相结合，例如蚂蚁的隐语框架，是一个隐私保护数据分析和机器学习的统一框架。</p>\n<p><a href=\"https://www.secretflow.org.cn/zh-CN/docs/llm/latest/raiasi6gb1how9vn\" target=\"_blank\" rel=\"noopener noreferrer\">隐语云大模型计算平台</a>：基于蚂蚁密态计算技术，为客户提供安全可信的大模型微调、推理、检索增强生成等大模型工具链的密算服务，发挥行业数据在大模型训练中价值，助力行业模型质量提升和AI应用的快速落地。其内部通过多方安全计算、联邦学习等方式确保用户的数据安全。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"构建面向用户的大模型平台\">构建面向用户的大模型平台<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-ecosystem#%E6%9E%84%E5%BB%BA%E9%9D%A2%E5%90%91%E7%94%A8%E6%88%B7%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%B9%B3%E5%8F%B0\" class=\"hash-link\" aria-label=\"构建面向用户的大模型平台的直接链接\" title=\"构建面向用户的大模型平台的直接链接\">​</a></h3>\n<p>LLM 的最终使用者必然使用户，那么如何构建一个用户友好的 LLM 平台便是问题之一，在 github 中出现了一系列的关于大模型使用的开源项目，其中著名的有：</p>\n<ol>\n<li>面向学术研究的 LLM 平台：<a href=\"https://github.com/binary-husky/gpt_academic\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/binary-husky/gpt_academic</a></li>\n<li>面向终端用户：<a href=\"https://github.com/open-webui/open-webui%E3%80%81\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/open-webui/open-webui、</a></li>\n<li>其他形式的 LLM 使用平台：<a href=\"https://github.com/jina-ai/reader\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/jina-ai/reader</a></li>\n<li>.....</li>\n</ol>\n<p>这里就不一一列举。</p>\n<p>这类工具的特点是通过友好的用户界面，使大模型可以开箱即用，降低用户使用难度和提升其在某方面的专业性。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"agent-构建\">Agent 构建<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-ecosystem#agent-%E6%9E%84%E5%BB%BA\" class=\"hash-link\" aria-label=\"Agent 构建的直接链接\" title=\"Agent 构建的直接链接\">​</a></h3>\n<p>Agent 和 RAG 是当前大模型使用的两个主要方向。围绕其产生的框架更是不计其数。例如我们熟知的 LangChain，LangChain4j，dify Haystack 等。</p>\n<ol>\n<li>Langchain：使用 Python 语言编写，提供一系列的 LLM 增强组件，如文本生成、对话管理、数据检索和链式处理等。</li>\n<li>LangChain4j：LangChain 的 java 实现，为 Java 开发 LLM 应用提供便利。</li>\n<li>Dify：相比 LangChain，Dify 是一个更高级的脚手架工具，其提供了完善的 Agent 编排，Prompt 管理等功能。</li>\n<li>AutoGen：如果一个 Agent 是一个智能体，AutoGen 就是一个多智能体（multi-agent）框架，其通过智能体之间的自然语言交互来完成一个复杂的任务。</li>\n<li>Spring AI：正如官网介绍的一样，一个面向 Spring 的 AI 开发框架。<strong>Spring AI 是一个面向 AI 工程的应用框架，其目标是将 Spring 生态系统的可移植性和模块化设计等设计原则应用到 AI 领域，并推动将 POJO 作为应用的构建块应用于 AI 领域。</strong></li>\n<li>Spring AI Alibaba：Alibaba 推出的基于 Spring AI 的国内 AI 应用开发解决方案。<strong>Spring AI Alibaba 基于 Spring AI 构建，是阿里云通义系列模型及服务在 Java AI 应用开发领域的最佳实践，提供高层次的 AI API 抽象与云原生基础设施集成方案，帮助开发者快速构建 AI 应用。</strong></li>\n</ol>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"llm-应用开发周边生态\">LLM 应用开发周边生态<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-ecosystem#llm-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E5%91%A8%E8%BE%B9%E7%94%9F%E6%80%81\" class=\"hash-link\" aria-label=\"LLM 应用开发周边生态的直接链接\" title=\"LLM 应用开发周边生态的直接链接\">​</a></h3>\n<p>放一张 Spring AI Alibaba 官网的 AI 生态图：</p>\n<p><img decoding=\"async\" loading=\"lazy\" src=\"https://img.alicdn.com/imgextra/i1/O1CN01uhDvMY22HZ4q1OZMM_!!6000000007095-2-tps-5440-2928.png\" alt=\"Spring AI Alibaba 生态图\" class=\"img_c29J\"></p>\n<p>其中：</p>\n<ul>\n<li>Nacos：作为模型的 apikey 管理和 prompt 管理中心</li>\n<li>Higress 作为 AI 网关，承接边缘到 AI 模型的流量</li>\n<li>Spring AI Alibaba：作为底层框架，提供对高层次的抽象 API</li>\n</ul>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"总结\">总结<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-ecosystem#%E6%80%BB%E7%BB%93\" class=\"hash-link\" aria-label=\"总结的直接链接\" title=\"总结的直接链接\">​</a></h2>\n<p>以上就是本篇文章的全部内容，当然文章中涉及的并不全面，还有例如 AI 网关，RAG 引擎等。但是这些在文中都略有提到，就不在过多叙述了。</p>",
            "url": "https://yuluo-yx.github.io/blog/LLMs-AI-llms-dev-ecosystem",
            "title": "大模型专栏-大模型开发生态",
            "summary": "前面我们已经讨论过了什么是大模型以及使用场景有那些，这篇文章我们来讨论下大模型的开发生态？有哪些开发工具可以快速基于大模型构建出我们需要的应用。",
            "date_modified": "2024-11-25T22:16:43.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "AI",
                "LLMs",
                "dev framework"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/LLMs-AI-llms-apply-where",
            "content_html": "<blockquote>\n<p>紧接着第一篇，什么是大模型，这篇文章讨论一下大模型的应用场景和应用方式有哪些？</p>\n</blockquote>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"基础使用\">基础使用<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-apply-where#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8\" class=\"hash-link\" aria-label=\"基础使用的直接链接\" title=\"基础使用的直接链接\">​</a></h2>\n<p>随着 GPT 的出现，AI 大模型已经越来越多得出现在日常生活和学术研究，工作中。</p>\n<p>按照使用方向有以下几种：</p>\n<ol>\n<li>自然语言处理：翻译、文字理解、聊天机器人、情感分析、文本生成和语义分析等。</li>\n<li>多模态：图像识别、图像生成、图像增强、人脸识别，文本和语音之间的转换。</li>\n<li>代码模型：生成单元测试，添加注释，解释代码。例如 IDEA 的各种插件，比较出名的有 Github Copilot，通义千问插件等。</li>\n<li>文档处理：将大量文档数据输入给大模型，让大模型充当客服助手，生成文案等，其本质也算是自然语言处理。</li>\n</ol>\n<p>上述内容是大模型在实际应用的最终表现形式。那么这些最终产品是怎么构建出来的？在那里使用到了大模型？</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"进阶使用\">进阶使用<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-apply-where#%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8\" class=\"hash-link\" aria-label=\"进阶使用的直接链接\" title=\"进阶使用的直接链接\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"rag\">RAG<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-apply-where#rag\" class=\"hash-link\" aria-label=\"RAG的直接链接\" title=\"RAG的直接链接\">​</a></h3>\n<p>RAG 全称为：Retrieval-Augmented Generation，检索增强生成。</p>\n<p>随着大模型的发展，其已经被用于到业务场景中。但是目前也存在一些较为突出的问题。</p>\n<ol>\n<li><strong>领域知识缺乏</strong>：大模型的知识来源于训练数据，这些数据主要来自公开的互联网和开源数据集，无法覆盖特定领域或高度专业化的内部知识。模型难以处理实时信息，因为训练过程耗时严重且成本较高。模型一旦训练完成，就难以获取和处理新信息。</li>\n<li><strong>数据安全</strong>：在企业内部，数据安全至关重要，没有企业愿意把自身数据上传到第三方平台训练大模型。</li>\n<li><strong>偏见问题</strong>：和第一篇文章类似，模型的回答基于大模型，其底层是一系列复杂的数值计算。有时候也会正儿八经的胡说八道。</li>\n</ol>\n<p>RAG 技术通过引入外部知识库，利用检索模块从大量文档中提取相关信息，并将这些信息传递给生成模块，从而生成更准确且有用的回答。<strong>也是当今大模型最火的应用方案。</strong></p>\n<p>RAG 原理图如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"img\" src=\"https://yuluo-yx.github.io/assets/images/ai-5-ee361024124e6f490dac3b517875a1dc.png\" width=\"1120\" height=\"1032\" class=\"img_c29J\"></p>\n<p>通过检索技术获取相关的知识，然后融入 Prompt 中，让大模型能够参考相应的知识从而给出合理回答。因此，可以将 RAG 的核心理解为 “检索+生成”。前者主要是利用向量数据库的高效存储和检索能力，召回目标知识；后者则是利用大模型和Prompt工程，将召回的知识合理利用，生成目标答案。</p>\n<p>流程大致为：</p>\n<ul>\n<li>数据准备阶段：数据提取——&gt;文本分割——&gt;向量化（embedding）——&gt;数据入库</li>\n<li>应用阶段：用户提问——&gt;数据检索（召回）——&gt;注入 Prompt——&gt;LLM 生成答案</li>\n</ul>\n<p>应用场景为：</p>\n<ol>\n<li>私域知识库；</li>\n<li>客服助手等。</li>\n</ol>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"agent\">Agent<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-apply-where#agent\" class=\"hash-link\" aria-label=\"Agent的直接链接\" title=\"Agent的直接链接\">​</a></h3>\n<p>如果你看过钢铁侠，你肯定对钢铁侠的助手——贾维斯 不陌生。其便是最经典的 Agent 例子。</p>\n<p>Agent 的定义如下：<strong>是一种构建于大型语言模型（LLM）之上的智能体，它具备环境感知能力、自主理解、决策制定及执行行动的能力。</strong></p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"img\" src=\"https://yuluo-yx.github.io/assets/images/ai-4-ba27522f100af7e7e20ead07bdb2f425.png\" width=\"1080\" height=\"629\" class=\"img_c29J\"></p>\n<p>智能体能够模拟思维过程，灵活调用各种预定义的 Tools 工具，逐步达成想要实现的目标。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"img\" src=\"https://yuluo-yx.github.io/assets/images/ai-3-d73f16085d65c123f4c05a2129aa77c9.png\" width=\"790\" height=\"345\" class=\"img_c29J\"></p>\n<p>其大致可以分为如下步骤：</p>\n<ol>\n<li>感知（Perception）：输入（Prompt）和外部环境（Env）</li>\n<li>信息处理（Agent 大脑 Brains）<!-- -->\n<ol>\n<li>信息存储：Store &amp; memory</li>\n<li>大模型对信息进行处理（基于感知）</li>\n<li>指定计划（Planning）：做出具体性的响应计划</li>\n<li>执行（Action）：调用 Tools 或者 Function Calling 调用外部 API</li>\n<li>输出（Output）：输出 Agent 执行的结果</li>\n</ol>\n</li>\n</ol>\n<p>一个使用场景：</p>\n<ol>\n<li>感知：我今天有点发烧，昨晚没有盖好被子并且天气很冷；</li>\n<li>信息存储：基于 memory 发现有没有类型记录或者基础疾病等信息；</li>\n<li>大模型：基于感知推断，感冒了；</li>\n<li>指定计划：需要请假打车去看病，写好假条，叫好车等；</li>\n<li>执行：调用请假和打车API（Tools） 和 app 交互完成一系列动作；</li>\n<li>输出：已经帮您写好了假条打好了车。</li>\n</ol>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"agi\">AGI<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-apply-where#agi\" class=\"hash-link\" aria-label=\"AGI的直接链接\" title=\"AGI的直接链接\">​</a></h2>\n<p>AGI（通用人工智能）是 AI 发展的终极目标，是让智能系统具备像人类一样理解和处理各种复杂情况与任务的能力。在实现过程中，**AI 大模型、Prompt Engineering、Agent 智能体、知识库、向量数据库、RAG **和其他关键技术扮演着至关重要的角色。这些技术元素在多样化的形态中相互协作，推动 AI 技术持续向前发展。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"参考\">参考<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-llms-apply-where#%E5%8F%82%E8%80%83\" class=\"hash-link\" aria-label=\"参考的直接链接\" title=\"参考的直接链接\">​</a></h2>\n<ul>\n<li><a href=\"https://gitcode.csdn.net/65ed7b8d1a836825ed79ae58.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://gitcode.csdn.net/65ed7b8d1a836825ed79ae58.html</a></li>\n<li><a href=\"https://53ai.com/news/LargeLanguageModel/2024081492481.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://53ai.com/news/LargeLanguageModel/2024081492481.html</a></li>\n</ul>",
            "url": "https://yuluo-yx.github.io/blog/LLMs-AI-llms-apply-where",
            "title": "大模型专栏--大模型应用场景",
            "summary": "紧接着第一篇，什么是大模型，这篇文章讨论一下大模型的应用场景和应用方式有哪些？",
            "date_modified": "2024-11-24T21:44:20.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "AI",
                "LLMs"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms",
            "content_html": "<blockquote>\n<p>前集概要：最近准备写一些关于 AI 的文章，主要记录自己学习 AI 及其 AI 相关的记录。如果有不对的地方欢迎批评指出！</p>\n</blockquote>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"什么是大模型\">什么是大模型<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%A7%E6%A8%A1%E5%9E%8B\" class=\"hash-link\" aria-label=\"什么是大模型的直接链接\" title=\"什么是大模型的直接链接\">​</a></h2>\n<p>来自 chatGPT 的回答：</p>\n<blockquote>\n<p>“大模型”通常指的是在机器学习和深度学习领域，尤其是自然语言处理（NLP）和计算机视觉（CV）中，具有大量参数和复杂结构的模型。这些模型通常需要大量的数据和计算资源进行训练。</p>\n</blockquote>\n<p>大模型（arge language model，LLM）：**指具有大规模参数和复杂计算结构的机器学习模型。**使用基于神经网络的模型，通常运用自然语言处理（Natural Language Processing，NLP）技术来处理和计算其输出。NLP 是人工智能（AI）的一个分支领域，专注于使计算机能够理解、解释和生成文本，从而让 LLM 能够执行文本分析、情绪分析、语言翻译和语音识别等任务。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"大规模参数\">大规模参数<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%8F%82%E6%95%B0\" class=\"hash-link\" aria-label=\"大规模参数的直接链接\" title=\"大规模参数的直接链接\">​</a></h3>\n<p>大模型通常包含数亿到数千亿个参数。参数的数量直接影响模型的表达能力，使其能够捕捉到更复杂的模式和特征。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"复杂计算结构\">复杂计算结构<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%A4%8D%E6%9D%82%E8%AE%A1%E7%AE%97%E7%BB%93%E6%9E%84\" class=\"hash-link\" aria-label=\"复杂计算结构的直接链接\" title=\"复杂计算结构的直接链接\">​</a></h3>\n<p>大模型基于深度学习架构，通常使用以下结构：</p>\n<ul>\n<li><strong>变换器（Transformers）</strong>：如 BERT、GPT、T5 等，这些模型在处理序列数据（如文本）时表现出色。变换器通过自注意力机制来理解输入数据中不同部分之间的关系。</li>\n<li><strong>卷积神经网络（CNNs）</strong>：虽然主要用于计算机视觉任务，但也可以在某些文本处理任务中使用。</li>\n</ul>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"自注意力机制\">自注意力机制<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6\" class=\"hash-link\" aria-label=\"自注意力机制的直接链接\" title=\"自注意力机制的直接链接\">​</a></h4>\n<p>变换器的核心在于自注意力机制，它允许模型在处理输入序列时对不同位置的单词进行加权，进而理解上下文关系。编码器和解码器的结合使得变换器能够有效地捕获语义信息。</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"无监督学习\">无监督学习<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%97%A0%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0\" class=\"hash-link\" aria-label=\"无监督学习的直接链接\" title=\"无监督学习的直接链接\">​</a></h4>\n<p>大模型通常在大规模文本数据上进行无监督预训练，然后通过微调（fine-tuning）来适应特定任务。这种策略使得模型能够从大量数据中学习语言的基本特征和规律。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"大模型的功能\">大模型的功能<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%8A%9F%E8%83%BD\" class=\"hash-link\" aria-label=\"大模型的功能的直接链接\" title=\"大模型的功能的直接链接\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"文案写作\">文案写作<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%96%87%E6%A1%88%E5%86%99%E4%BD%9C\" class=\"hash-link\" aria-label=\"文案写作的直接链接\" title=\"文案写作的直接链接\">​</a></h3>\n<p>大模型如 GPT-3、ChatGPT、Claude 和其他类似工具，确实可以用于创作原始文案。这些模型能够生成各种风格的文本，并且可以通过工具如 AI21 Wordspice 来建议修改以改善语法和表达方式。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"知识库回答\">知识库回答<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E7%9F%A5%E8%AF%86%E5%BA%93%E5%9B%9E%E7%AD%94\" class=\"hash-link\" aria-label=\"知识库回答的直接链接\" title=\"知识库回答的直接链接\">​</a></h3>\n<p>知识密集型自然语言处理（KI-NLP）确实是指利用 LLM 从数字存档中提取信息以回答具体问题。AI21 Studio playground 能够回答常识性问题，展示了这种技术的应用。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"文本分类\">文本分类<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"文本分类的直接链接\" title=\"文本分类的直接链接\">​</a></h3>\n<p>LLM 可以通过聚类技术对文本进行分类，以识别相似的含义或情绪。这种能力广泛应用于客户情感分析、文本关系识别和文档搜索等场景。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"代码生成\">代码生成<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90\" class=\"hash-link\" aria-label=\"代码生成的直接链接\" title=\"代码生成的直接链接\">​</a></h3>\n<p>LLM 在根据自然语言提示生成代码方面表现出色。Amazon Q Developer 允许用户使用 Python、JavaScript、Ruby 等多种编程语言进行编程。它还可以用于创建 SQL 查询、编写 Shell 命令和设计网站等。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"文本生成\">文本生成<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%96%87%E6%9C%AC%E7%94%9F%E6%88%90\" class=\"hash-link\" aria-label=\"文本生成的直接链接\" title=\"文本生成的直接链接\">​</a></h3>\n<p>文本生成确实可以用于补全不完整的句子、编写产品文档，甚至创作儿童故事等。这种能力使得大模型在内容创作方面非常灵活和实用。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"大模型的分类\">大模型的分类<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"大模型的分类的直接链接\" title=\"大模型的分类的直接链接\">​</a></h2>\n<p>这里说了大模型，那什么是”小模型“？</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"小模型\">小模型<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%B0%8F%E6%A8%A1%E5%9E%8B\" class=\"hash-link\" aria-label=\"小模型的直接链接\" title=\"小模型的直接链接\">​</a></h3>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"小模型的定义\">小模型的定义<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%B0%8F%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%AE%9A%E4%B9%89\" class=\"hash-link\" aria-label=\"小模型的定义的直接链接\" title=\"小模型的定义的直接链接\">​</a></h4>\n<p>小模型通常指的是参数较少、层数较浅的机器学习模型。由于其设计简单，小模型具有轻量级、高效率和易于部署的优点，特别适合于数据量较小或计算资源有限的场景，例如：</p>\n<ul>\n<li><strong>移动端应用</strong>：在手机或平板上运行，避免过度消耗电池和计算能力。</li>\n<li><strong>嵌入式设备</strong>：如智能家居设备、传感器等，这些设备通常计算能力较弱。</li>\n<li><strong>物联网（IoT）</strong>：在分布式设备中进行实时处理和决策。</li>\n</ul>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"小模型与大模型的区别\">小模型与大模型的区别<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%B0%8F%E6%A8%A1%E5%9E%8B%E4%B8%8E%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%8C%BA%E5%88%AB\" class=\"hash-link\" aria-label=\"小模型与大模型的区别的直接链接\" title=\"小模型与大模型的区别的直接链接\">​</a></h4>\n<ul>\n<li><strong>参数和层数</strong>：小模型的参数较少，层数较少，而大模型则具有更多的参数和更深的层次结构。</li>\n<li><strong>表达能力</strong>：大模型通常具有更强的表达能力和更高的准确度，能够处理更复杂的任务。</li>\n<li><strong>计算资源</strong>：小模型对计算资源的需求较低，而大模型需要更多的计算资源和时间进行训练和推理。</li>\n</ul>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"涌现能力\">涌现能力<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%B6%8C%E7%8E%B0%E8%83%BD%E5%8A%9B\" class=\"hash-link\" aria-label=\"涌现能力的直接链接\" title=\"涌现能力的直接链接\">​</a></h4>\n<p>当模型的训练数据和参数不断增加，达到一定的规模后，模型可能展现出新的能力和特性，这被称为“涌现能力”。具备涌现能力的模型被视为独立意义上的大模型，这是小模型与大模型之间的一个关键区别。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"模型分类\">模型分类<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%A8%A1%E5%9E%8B%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"模型分类的直接链接\" title=\"模型分类的直接链接\">​</a></h3>\n<p>大模型可以根据不同的<strong>特征和应用场景</strong>进行多种分类：</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"按模型架构分类\"><strong>按模型架构分类</strong><a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%8C%89%E6%A8%A1%E5%9E%8B%E6%9E%B6%E6%9E%84%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"按模型架构分类的直接链接\" title=\"按模型架构分类的直接链接\">​</a></h4>\n<ul>\n<li><strong>变换器（Transformers）</strong>：如 BERT、GPT、T5 等，广泛应用于自然语言处理（NLP）任务。</li>\n<li><strong>卷积神经网络（CNNs）</strong>：主要用于图像处理和计算机视觉任务，如 ResNet、EfficientNet 等。</li>\n<li><strong>递归神经网络（RNNs）</strong>：适合处理序列数据，如 LSTM 和 GRU，虽然近年来逐渐被变换器取代。</li>\n</ul>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"按任务类型分类\"><strong>按任务类型分类</strong><a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%8C%89%E4%BB%BB%E5%8A%A1%E7%B1%BB%E5%9E%8B%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"按任务类型分类的直接链接\" title=\"按任务类型分类的直接链接\">​</a></h4>\n<ul>\n<li><strong>语言模型</strong>：用于文本生成、补全和理解，例如 GPT 系列和 BERT。</li>\n<li><strong>图像处理模型</strong>：用于图像分类、目标检测和图像生成，如 EfficientNet 和 GAN（生成对抗网络）。</li>\n<li><strong>多模态模型</strong>：能够处理多种类型的数据（如文本和图像），例如 CLIP 和 DALL-E。</li>\n</ul>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"按训练方式分类\"><strong>按训练方式分类</strong><a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%8C%89%E8%AE%AD%E7%BB%83%E6%96%B9%E5%BC%8F%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"按训练方式分类的直接链接\" title=\"按训练方式分类的直接链接\">​</a></h4>\n<ul>\n<li><strong>监督学习模型</strong>：通过带标签的数据进行训练，例如图像分类的 CNN 模型。</li>\n<li><strong>无监督学习模型</strong>：利用未标记的数据进行训练，例如自编码器（Autoencoders）。</li>\n<li><strong>自监督学习模型</strong>：利用数据本身生成标签进行训练，例如 BERT 使用的掩蔽语言模型技术。</li>\n</ul>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"按规模分类\"><strong>按规模分类</strong><a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%8C%89%E8%A7%84%E6%A8%A1%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"按规模分类的直接链接\" title=\"按规模分类的直接链接\">​</a></h4>\n<ul>\n<li><strong>小模型</strong>：参数量适中，适合在资源有限的环境中使用。</li>\n<li><strong>大模型</strong>：参数量在亿级以上，能够处理复杂任务，但需要大量计算资源。</li>\n</ul>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"按领域分类\">按领域分类<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%8C%89%E9%A2%86%E5%9F%9F%E5%88%86%E7%B1%BB\" class=\"hash-link\" aria-label=\"按领域分类的直接链接\" title=\"按领域分类的直接链接\">​</a></h4>\n<ul>\n<li><strong>通用模型</strong>：可以用于多种任务，例如 OpenAI 的 GPT-3。</li>\n<li><strong>专用模型</strong>：针对特定任务或行业优化的模型，例如医疗影像分析模型。</li>\n</ul>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"按输入不同\">按输入不同<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%8C%89%E8%BE%93%E5%85%A5%E4%B8%8D%E5%90%8C\" class=\"hash-link\" aria-label=\"按输入不同的直接链接\" title=\"按输入不同的直接链接\">​</a></h4>\n<p>甚至我们还可以根据输入的不同，将其划分为：</p>\n<ul>\n<li>\n<p><strong>语言大模型（NLP）</strong>：通常用于处理文本数据和理解自然语言。这类大模型的主要特点是它们在大规模语料库上进行了训练，以学习自然语言的各种语法、语义和语境规则。例如：GPT系列（OpenAI）、Bard（Google）、文心一言（百度）。</p>\n</li>\n<li>\n<p><strong>视觉大模型（CV）</strong>：计算机视觉（Computer Vision，CV）领域中使用的大模型，通常用于图像处理和分析。这类模型通过在大规模图像数据上进行训练，可以实现各种视觉任务，如图像分类、目标检测、图像分割、姿态估计、人脸识别等。</p>\n</li>\n<li>\n<p><strong>多模态大模型</strong>：是指能够处理多种不同类型数据的大模型，例如文本、图像、音频等多模态数据。其结合了NLP和CV的能力，以实现对多模态信息的综合理解和分析，从而能够更全面地理解和处理复杂的数据。</p>\n</li>\n</ul>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"大模型当前面临的问题\">大模型当前面临的问题<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BD%93%E5%89%8D%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%97%AE%E9%A2%98\" class=\"hash-link\" aria-label=\"大模型当前面临的问题的直接链接\" title=\"大模型当前面临的问题的直接链接\">​</a></h2>\n<p>如果你善于百度，肯定能发现一些当前大模型存在的问题，例如</p>\n<ol>\n<li>上下文依赖，不能给出独立于上下文的回答；</li>\n<li>对新事物的适应性，对新发生的事务没有感知；</li>\n<li>语言理解局限：不能理解训练数据之外的言语；</li>\n<li>伦理和社会问题：基于错误的数据集，训练出的违反道德和社区的言论输出</li>\n<li>数据安全性：公司内部的知识库使用公司私域数据，没有企业愿意承担数据泄露的风险，将自身的私域数据上传第三方平台进行训练</li>\n<li>.....</li>\n</ol>\n<p>等等，这里我总结为三类：</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"数据安全\">数据安全<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8\" class=\"hash-link\" aria-label=\"数据安全的直接链接\" title=\"数据安全的直接链接\">​</a></h3>\n<p>最好理解的一个问题：在构建一些公司内部的知识库或者客服助手时，一定不会将公司数据上传到第三方平台进行训练。这也就导致模型回答时的局限性。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"实时学习\">实时学习<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%AE%9E%E6%97%B6%E5%AD%A6%E4%B9%A0\" class=\"hash-link\" aria-label=\"实时学习的直接链接\" title=\"实时学习的直接链接\">​</a></h3>\n<blockquote>\n<p>这里首先提一个概念：人类的工作记忆（working memory）是<strong>一种记忆容量有限的认知系统，被用以暂时保存资讯</strong>。 工作记忆对于推理以及指导决策和行为有重要影响。</p>\n</blockquote>\n<p>大模型的另一个问题是：临时记忆的缺失，可以理解为大模型在处理信息时的短期存储能力。使大模型在处理连续信息时，保持上下文一致性，增强其理解和反应能力。</p>\n<p>当前，对记忆的外部处理手段为将交互对话上下文保存在外部系统，在交互时作为输入，一起传递给大模型。确保模型的上下文语境和暂存区记忆，从而做出更有利的决策和回答。<strong>其一定程度上影响偏见的形成。</strong></p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"偏见\">偏见<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E5%81%8F%E8%A7%81\" class=\"hash-link\" aria-label=\"偏见的直接链接\" title=\"偏见的直接链接\">​</a></h3>\n<p>其本质是基于条件反射基础上的快思考。可以认为是实时学习的一种， 也就是快速将某一组神经元的权重打满 ，在学习过程中，通过强化某些神经元之间的连接来提高特定信息的处理能力 ，以避免随机依从性不好的问题。</p>\n<blockquote>\n<p>海兔的神经元运作如下：</p>\n<p>1） 刺激 -&gt; 缩鳃\n2） 多次刺激 -&gt; 习惯化  没有反应\n3） 经过了一段时间以后 再刺激 -&gt; 缩鳃</p>\n<p>偏见 就是3次刺激以后 后面无论怎么刺激 都不再缩鳃了。 对应 告诉你多次以后，你就相信了，不需要大量数据的训练。\n只是经过一段时间，就会遗忘 ，然后你又不信了</p>\n<p>来自和某位大佬的对话摘抄</p>\n</blockquote>\n<p>如果模型在学习过程中依赖于自己生成的内容，可能会导致其输出的偏见性（幻觉）。这类似于人类的信仰形成——个人的信念系统在缺乏外部验证时，会基于已有的经验进行自我强化。多次刺激后，反应的习惯化说明了偏见的根深蒂固。类似地，模型在接收到特定输出后，可能会对后续输入产生固定的反应模式，这种模式可能需要新的刺激或信息才能打破。</p>\n<blockquote>\n<p><strong>具体表现为：好了伤疤忘了疼。</strong></p>\n</blockquote>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"本质\">本质<a href=\"https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms#%E6%9C%AC%E8%B4%A8\" class=\"hash-link\" aria-label=\"本质的直接链接\" title=\"本质的直接链接\">​</a></h3>\n<p>通过改善<strong>临时记忆和偏见机制</strong>，模型有可能实现更接近人类的思考和学习能力。这意味着模型不仅能快速处理信息，还能灵活适应新的情况，减少错误判断和输出。</p>",
            "url": "https://yuluo-yx.github.io/blog/LLMs-AI-what-is-llms",
            "title": "大模型专栏--什么是大模型？",
            "summary": "前集概要：最近准备写一些关于 AI 的文章，主要记录自己学习 AI 及其 AI 相关的记录。如果有不对的地方欢迎批评指出！",
            "date_modified": "2024-11-24T19:56:15.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "AI",
                "LLMs"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/write-somethings",
            "content_html": "<p>  今天是 24 年 11 月 24 号，星期日，刚从杭州来到郑州不久。想来想去应该写点什么，算是经历了一段大起大落。</p>\n<p>  来到郑州之后见识到了许多东西，不同于老家和杭州。郑州给人的感觉更有烟火气，没有杭州的局促感。给人的感觉是一种慢节奏的生活气息。我住的地方在一个旧小区，虽然不如当初在杭州住的小区高档些，但是也别具一格，在路上还能看到小时候在老家见到的手扶拖拉机，小区门口有很多小商贩，买菜的，买水果的，特别是到了晚上，有很多路边摊。给人一种在杭州五常夜市的感觉。味道和五常夜市差不多，但是价格比五常低一档。</p>\n<p>  每天过着日出而作，日落而息的生活。房子到公司，公交车直达。经常在想，我也算是幸运儿，在 24 年大背景不好的情况下，在一个还不错的城市找到了一个满意的工作，只是目前还没发工资。</p>\n<p>  每天下班之后，戴着耳机，坐着公交车，看着上车下车的，路旁来来往往的人，也别有一番滋味在心头。回到房子里，看着开源社区群里的聊天信息，自己在开源群里的发言，不同人在群里思维的碰撞。一天过的简单充实又平淡。</p>\n<p>  特有缘分的一件事是 竟然有一个和我在同一站公交上车又同一站下车的女生，也算挺有缘分。</p>\n<p>  周末双休，可能是在杭州不敢奢望的事情，在杭州上班，给人的感觉是 双休是犯法的，上班时间以单休居多，偶见大小周。周末两天，一天躺平乱逛，一天投身于开源和兴趣爱好。初来乍到，每个地方都有自己都有的特点，不去逛逛，算是白来一趟了！</p>\n<p>  有时候躺在床上，想着这样过着渺小又重复的日子也挺好的。不如朋友圈见到的精致，但是简简单单也不乏味。</p>\n<p>  于此而来的另一个问题，我到底应该过怎样的人生？之前刷视频刷到过大冰老师的直播视频，从中也领悟到了一些。论语中说，二十而冠，三十而立。四十而不惑。此时正直弱冠之年，所有的一切都刚刚开始。</p>\n<p>  我觉得人生不能被过早定义，也不应该被过早定义，金无足赤人无完人。</p>\n<hr>\n<p>  最后，附一张于今天下午拍的照片，希望年过半百，也能有这样的状态。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"郑州东周路地铁口弹钢琴的老人\" src=\"https://yuluo-yx.github.io/assets/images/other2-dc53be7390bd89c6248314d3eb948c03.jpg\" width=\"1702\" height=\"1276\" class=\"img_c29J\"></p>",
            "url": "https://yuluo-yx.github.io/blog/write-somethings",
            "title": "随笔 2024/11/24",
            "summary": "&emsp;&emsp;今天是 24 年 11 月 24 号，星期日，刚从杭州来到郑州不久。想来想去应该写点什么，算是经历了一段大起大落。",
            "date_modified": "2024-11-24T18:28:38.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "随笔"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/wechatminiapp-msg-push",
            "content_html": "<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"需求背景\">需求背景<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF\" class=\"hash-link\" aria-label=\"需求背景的直接链接\" title=\"需求背景的直接链接\">​</a></h2>\n<p>管理员在后台给小程序用户推送一些消息，例如用户收费通知，工单维护通知等。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"功能流程图\">功能流程图<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E5%8A%9F%E8%83%BD%E6%B5%81%E7%A8%8B%E5%9B%BE\" class=\"hash-link\" aria-label=\"功能流程图的直接链接\" title=\"功能流程图的直接链接\">​</a></h3>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"微信用户消息推送流程图\" src=\"https://yuluo-yx.github.io/assets/images/img6-73d9b6e549c958a2d307347a87eb8784.png\" width=\"1106\" height=\"586\" class=\"img_c29J\"></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"功能实现\">功能实现<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0\" class=\"hash-link\" aria-label=\"功能实现的直接链接\" title=\"功能实现的直接链接\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"小程序项目添加如下代码开启用户订阅\">小程序项目添加如下代码，开启用户订阅<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A1%B9%E7%9B%AE%E6%B7%BB%E5%8A%A0%E5%A6%82%E4%B8%8B%E4%BB%A3%E7%A0%81%E5%BC%80%E5%90%AF%E7%94%A8%E6%88%B7%E8%AE%A2%E9%98%85\" class=\"hash-link\" aria-label=\"小程序项目添加如下代码，开启用户订阅的直接链接\" title=\"小程序项目添加如下代码，开启用户订阅的直接链接\">​</a></h3>\n<blockquote>\n<p>用户订阅消息文档：<a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html</a></p>\n</blockquote>\n<p>在小程序中加入如下代码，开启用户订阅：</p>\n<div class=\"language-tsx codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-tsx codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  uni</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token method function property-access\" style=\"color:hsl(221, 87%, 60%)\">requestSubscribeMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 模板消息 id</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    tmplIds</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'tmpId'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token console class-name\" style=\"color:hsl(35, 99%, 36%)\">console</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token method function property-access\" style=\"color:hsl(221, 87%, 60%)\">log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">fail</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">err</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token console class-name\" style=\"color:hsl(35, 99%, 36%)\">console</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token method function property-access\" style=\"color:hsl(221, 87%, 60%)\">log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">err</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<blockquote>\n<ol>\n<li>微信开发工具显示用户订阅消息弹窗和真机调试中，显示得内容不一样，注意甄别。</li>\n<li>用户在订阅消息之后，点击下面得对号就是永久订阅，可以在小程序设置中关闭。（实际还是走了订阅，但是用户无感）</li>\n<li>用户订阅消息一定要通过<strong>用户点击事件或者支付回调</strong>触发，在 await 中不生效。</li>\n<li><a href=\"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/wx.getSetting.html\" target=\"_blank\" rel=\"noopener noreferrer\">wx.getSetting()</a> 接口可获取用户对相关模板消息的订阅状态。</li>\n<li>在触发用户订阅消息事件之后，微信服务器会发送验证请求到开发者服务器进行信息验证。</li>\n</ol>\n</blockquote>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"后台功能\">后台功能<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E5%90%8E%E5%8F%B0%E5%8A%9F%E8%83%BD\" class=\"hash-link\" aria-label=\"后台功能的直接链接\" title=\"后台功能的直接链接\">​</a></h3>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"功能描述\">功能描述<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0\" class=\"hash-link\" aria-label=\"功能描述的直接链接\" title=\"功能描述的直接链接\">​</a></h4>\n<p>后台功能主要有以下三个：</p>\n<ol>\n<li>接受微信服务器得用户订阅消息验证；</li>\n<li>验证通过后，接受微信服务器得用户订阅消息事件；</li>\n<li>发送消息给指定 openId 用户</li>\n</ol>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"代码实现\">代码实现<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0\" class=\"hash-link\" aria-label=\"代码实现的直接链接\" title=\"代码实现的直接链接\">​</a></h4>\n<ol>\n<li>\n<p>微信服务器权限验证</p>\n<blockquote>\n<p>微信权限验证策略：</p>\n<p>将自定义 token 和 timestamp、nonce 按照字典序排列，之后 SHA1 加密和 signature 进行对比，相同返回 echostr。</p>\n</blockquote>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// controller</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">/**</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * 微信服务器鉴权接口</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> *</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * @param signature 签名</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * @param timestamp 时间戳</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * @param nonce     随机数</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * @param echostr   随机字符串</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * @return 鉴权通过返回 echostr</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> */</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@GetMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">value </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/user\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">userAuth</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> signature</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> timestamp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> nonce</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> echostr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> messageService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">auth</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">signature</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> timestamp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> nonce</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> echostr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// service</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">auth</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> signature</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> timestamp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> nonce</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> echostr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">info</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"接收到的参数：{} {} {} {}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> signature</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> timestamp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> nonce</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> echostr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"> arr </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\">wxConfigProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMsgToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> timestamp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> nonce</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Arrays</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">sort</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">arr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringBuilder</span><span class=\"token plain\"> sb </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringBuilder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">for</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> str </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> arr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        sb</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">append</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">str</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> computedSignature </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">SHAUtil</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">sha1</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">sb</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toString</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">info</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"微信服务器接收到的 签名：{}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> signature</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">info</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"SHA1 计算出的签名：{}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> computedSignature</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">computedSignature</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">equals</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">signature</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> echostr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>微信用户订阅事件接受接口</p>\n<blockquote>\n<p>用户事件接口必须和权限验证接口同名，微信服务器会发送 GET 用于验证，POST 用于发送用户订阅事件消息。</p>\n</blockquote>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// controller</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">/**</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">* 微信服务器处理用户事件接口</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">*/</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@PostMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">value </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/user\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpServletRequest</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    messageService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">auth</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// service</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">/**</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * // 接口返回 JSON 和 XML 返回体可以在微信小程序自定义返回格式。</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * \"ToUserName\":\"gh_ea84a199bf81\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * \"FromUserName\":\"oG0NJ5Oi_3Dd1HlZJ14xfnA0sJ6s\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * \"CreateTime\":1686131943,</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * \"MsgType\":\"event\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * \"Event\":\"subscribe_msg_popup_event\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * \"List\":{</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * \"PopupScene\":\"0\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * \"SubscribeStatusString\":\"accept\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * \"TemplateId\":\"4ondVRxk4L20ihrJ3iI15BDK72XatGPxE0MeCVwHasQ\"</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * // 选择明文加密兼容模式时，还会返回加密内容，方便调试。</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> */</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpServletRequest</span><span class=\"token plain\"> request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">try</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">BufferedReader</span><span class=\"token plain\"> reader </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">BufferedReader</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">InputStreamReader</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">request</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getInputStream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringBuilder</span><span class=\"token plain\"> requestContent </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringBuilder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> line</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">while</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">line </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> reader</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">readLine</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            requestContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">append</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">line</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        reader</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">close</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">hasText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">requestContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toString</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ServiceException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"微信服务器响应失败！\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">info</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"微信服务器响应：{}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> requestContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonNode</span><span class=\"token plain\"> jsonNode </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">fromJson</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">requestContent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toString</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">TypeReference</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 解析为 JSONNode</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> toUserName </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> jsonNode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"ToUserName\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">asText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> fromUserName </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> jsonNode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"FromUserName\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">asText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">long</span><span class=\"token plain\"> createTime </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> jsonNode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"CreateTime\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">asLong</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> msgType </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> jsonNode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"MsgType\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">asText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> event </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> jsonNode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Event\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">asText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonNode</span><span class=\"token plain\"> listNode </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> jsonNode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"List\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> subscribeStatus </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> listNode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"SubscribeStatusString\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">asText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> templateId </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> listNode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"TemplateId\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">asText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 需要保存的用户订阅消息实体信息</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsg</span><span class=\"token plain\"> dbWeChatMsg </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">weChatMsgMapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">selectOneByQuery</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">QueryWrapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">eq</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsg</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">::</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getFromUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> fromUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 如果已经存在，则更新覆盖字段即可</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Objects</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">nonNull</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">dbWeChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            dbWeChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setSubscribeStatus</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">subscribeStatus</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            dbWeChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setTmplId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">templateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            dbWeChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setToUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">toUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">weChatMsgMapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">update</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">dbWeChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 没有则插入数据</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsg</span><span class=\"token plain\"> weChatMsg </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">SnowFlakeIdGenerator</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">generateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setToUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">toUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setFromUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">fromUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setCreateTime</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">valueOf</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">createTime</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setMsgType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">msgType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setEvent</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">event</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setTmplId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">templateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setSubscribeStatus</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">subscribeStatus</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">weChatMsgMapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">insert</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">catch</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">IOException</span><span class=\"token plain\"> e</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ServiceException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"接受微信服务器订阅消息异常：err: \"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> e</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>实体</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Table</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">value </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"tbl_wechat_sub\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsg</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Long</span><span class=\"token plain\"> id</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> toUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> fromUserName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> createTime</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> msgType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> event</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> subscribeStatus</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> tmplId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n</ol>\n<p>至此，微信小程序服务器的交互功能就完成了。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"微信小程序消息开通和发送消息\">微信小程序消息开通和发送消息<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B6%88%E6%81%AF%E5%BC%80%E9%80%9A%E5%92%8C%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF\" class=\"hash-link\" aria-label=\"微信小程序消息开通和发送消息的直接链接\" title=\"微信小程序消息开通和发送消息的直接链接\">​</a></h3>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"消息发送后台功能实现\">消息发送后台功能实现<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E5%90%8E%E5%8F%B0%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0\" class=\"hash-link\" aria-label=\"消息发送后台功能实现的直接链接\" title=\"消息发送后台功能实现的直接链接\">​</a></h4>\n<ol>\n<li>\n<p>消息发送器</p>\n<blockquote>\n<p>后台发送消息时，需要获取 accessToken，一般2个小时刷新一次，需要动态获取。</p>\n</blockquote>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Component</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatSubscribeMessageSender</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Logger</span><span class=\"token plain\"> logger </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">org</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">slf4j</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">LoggerFactory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getLogger</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatSubscribeMessageSender</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">sendSubscribeMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> accessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> openid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> templateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> page</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> data</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">try</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> url </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GarageConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MsgBaseUrl</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"?access_token=\"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> accessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">URL</span><span class=\"token plain\"> apiUrl </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">URL</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpURLConnection</span><span class=\"token plain\"> connection </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpURLConnection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> apiUrl</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">openConnection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            connection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setRequestMethod</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"POST\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            connection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setRequestProperty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Content-Type\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"application/json;charset=UTF-8\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            connection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setDoOutput</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">true</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 构建请求体</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> body </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">buildRequestBody</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">openid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> templateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> page</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> data</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">byte</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"> requestBodyBytes </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> body</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBytes</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StandardCharsets</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">UTF_8</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 发送请求</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            connection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOutputStream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">write</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">requestBodyBytes</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 读取响应</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">int</span><span class=\"token plain\"> responseCode </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> connection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getResponseCode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">BufferedReader</span><span class=\"token plain\"> reader </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">BufferedReader</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">InputStreamReader</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">connection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getInputStream</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringBuilder</span><span class=\"token plain\"> response </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringBuilder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> line</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">while</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">line </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> reader</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">readLine</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">append</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">line</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            reader</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">close</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">responseCode </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpURLConnection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">HTTP_OK</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 请求成功处理逻辑</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                logger</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">info</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"发送订阅消息成功. resp: {}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 请求失败处理逻辑</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                logger</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">info</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"发送订阅消息失败, 响应：{}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            connection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">disconnect</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">catch</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">IOException</span><span class=\"token plain\"> e</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ServiceException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"微信消息推送失败！err: \"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> e</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">/**</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     * 构建请求体的JSON字符串</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     */</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">buildRequestBody</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> openid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> templateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> page</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> data</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">format</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"{\\\"touser\\\":\\\"%s\\\",\\\"template_id\\\":\\\"%s\\\",\\\"page\\\":\\\"%s\\\",\\\"data\\\":%s}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                openid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> templateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> page</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> data</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>发送微信消息</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsgHelper</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Logger</span><span class=\"token plain\"> logger </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">LoggerFactory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getLogger</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsgHelper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 推送消息的时候需要 accessToken，这里是获取</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// token 的方法，在实际环境中，一般是定时刷新，</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 两个小时内有效，获取accesstoken时需要appid和secret信息，一般是后台参数或常量进行配置</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 获取 accessToken 的请求接口</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GetAccessToken</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GarageConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">TokenBaseUrl</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"&amp;appid={appid}&amp;secret={secret}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">refreshAccessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> appid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> secret</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">RestTemplate</span><span class=\"token plain\"> restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">hasText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">appid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">||</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">hasText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">secret</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            logger</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">error</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"刷新微信 AccessToken 时，缺少 appid 或 secret 参数！\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ServiceException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"刷新微信 AccessToken 时，缺少 appid 或 secret 参数！\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Object</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> param </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HashMap</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"appid\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\">appid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"secret\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\">secret</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ResponseEntity</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> resp </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getForEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GetAccessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                param</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token plain\"> jsonObj </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> resp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBody</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> accessToken </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">jsonObj </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            accessToken </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> jsonObj</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getStr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"access_token\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> accessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Object</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createDataItem</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Object</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> item </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HashMap</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        item</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"value\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> item</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">/**</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     * 发送微信小程序消息</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     * @param configProperties 微信配置属性</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     * @param restTemplate restTemplate 模板</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     * @param openId 用户 openId</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     * @param templateId 模板 Id</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     * @param page 点击跳转的页面路径</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     * @param jsonData 发送的 json 数据</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     * @param messageSender 消息发送器</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">     */</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">send</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WXConfigProperties</span><span class=\"token plain\"> configProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">RestTemplate</span><span class=\"token plain\"> restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> openId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> templateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> page</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> jsonData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatSubscribeMessageSender</span><span class=\"token plain\"> messageSender</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 刷新 token</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> accessToken </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsgHelper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">refreshAccessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                configProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAppId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                configProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAppSecret</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                restTemplate</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        messageSender</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">sendSubscribeMessage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">accessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> openId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> templateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> page</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> jsonData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>在业务逻辑中调用</p>\n<blockquote>\n<p>一般需要获取通知用户的 openId，去数据库中查询到 templateId，之后组装消息然后发送给用户。</p>\n</blockquote>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 配置的 JSON 数据信息需要看后面的 微信模板参数。</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token plain\"> messageData </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">messageData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">set</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"thing8\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createDataItem</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"服务内容\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> projectInfoById</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">messageData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">set</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"thing5\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createDataItem</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"备注\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> userNotify</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> jsonData </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> messageData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toJSONString</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 组装发送消息需要的参数</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsgHelper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">send</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    configProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOpenId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    weChatMsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getTmplId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"pages/index\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    jsonData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    messageSender</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n</ol>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"小程序后台配置\">小程序后台配置<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%90%8E%E5%8F%B0%E9%85%8D%E7%BD%AE\" class=\"hash-link\" aria-label=\"小程序后台配置的直接链接\" title=\"小程序后台配置的直接链接\">​</a></h4>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"消息推送配置\">消息推送配置<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81%E9%85%8D%E7%BD%AE\" class=\"hash-link\" aria-label=\"消息推送配置的直接链接\" title=\"消息推送配置的直接链接\">​</a></h5>\n<p>在小程序后台 -&gt; 管理 -&gt; 开发管理 -&gt; 消息推送中配置后台服务器地址地址信息。</p>\n<blockquote>\n<p>注意：在配置时需要发送验证到后台服务器验证，所以需要部署到公网可访问得环境中测试。</p>\n</blockquote>\n<p>完成相关配置如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"微信消息推送配置\" src=\"https://yuluo-yx.github.io/assets/images/img3-f3ed982b34d412a323323c4153e9cde6.png\" width=\"1361\" height=\"514\" class=\"img_c29J\"></p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"模板消息配置\">模板消息配置<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF%E9%85%8D%E7%BD%AE\" class=\"hash-link\" aria-label=\"模板消息配置的直接链接\" title=\"模板消息配置的直接链接\">​</a></h5>\n<p>小程序后台 -&gt; 基础功能 -&gt; 订阅消息  -&gt; 在我的模板中选择模板配置。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"微信消息模板配置\" src=\"https://yuluo-yx.github.io/assets/images/img4-94412200e0973b30f71b1d8324a61a43.png\" width=\"1410\" height=\"572\" class=\"img_c29J\"></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"测试\">测试<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E6%B5%8B%E8%AF%95\" class=\"hash-link\" aria-label=\"测试的直接链接\" title=\"测试的直接链接\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"手动编写-controller-接口\">手动编写 controller 接口<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E6%89%8B%E5%8A%A8%E7%BC%96%E5%86%99-controller-%E6%8E%A5%E5%8F%A3\" class=\"hash-link\" aria-label=\"手动编写 controller 接口的直接链接\" title=\"手动编写 controller 接口的直接链接\">​</a></h3>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">/**</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * 测试使用</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> * 模拟消息推送，写死所有的参数信息，实际中应该从数据库中查询到已经订阅消息的用户发送消息通知。</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"> */</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@GetMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/push\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">push</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> openid </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"ooaER7ctq6G_5CNrs0LE2vR2wCzk\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> templateId </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"3gMbhH_bFuZlXiaJffCqXlNoqKvJwz_zUSmr-z1jEyo\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> page </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/pages/index\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token plain\"> messageData </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    messageData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">set</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"thing1\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createDataItem</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"公司名称\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"测试公司\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    messageData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">set</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"thing4\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createDataItem</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"地址\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"天庭\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    messageData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">set</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"name2\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createDataItem</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"用户姓名\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"测试-牧生\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    messageData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">set</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"phone_number3\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createDataItem</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"联系方式\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"18198086793\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    messageData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">set</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"thing19\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createDataItem</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"报修原因\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"测试消息推送\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> jsonData </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> messageData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toJSONString</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsgHelper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">send</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">configProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> openid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> templateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> page</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> jsonData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> messageSender</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"实际使用\">实际使用<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8\" class=\"hash-link\" aria-label=\"实际使用的直接链接\" title=\"实际使用的直接链接\">​</a></h3>\n<p>实际使用需要在业务代码逻辑中调用。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"效果预览\">效果预览<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-msg-push#%E6%95%88%E6%9E%9C%E9%A2%84%E8%A7%88\" class=\"hash-link\" aria-label=\"效果预览的直接链接\" title=\"效果预览的直接链接\">​</a></h2>\n<p>微信小程序接收如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"微信小程序接收\" src=\"https://yuluo-yx.github.io/assets/images/img5-8e2d06ef425a4ed6ef4ec7687c0b76c2.png\" width=\"1200\" height=\"2652\" class=\"img_c29J\"></p>",
            "url": "https://yuluo-yx.github.io/blog/wechatminiapp-msg-push",
            "title": "微信小程序消息推送",
            "summary": "需求背景",
            "date_modified": "2024-10-10T22:41:01.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "Unipp",
                "微信小程序",
                "Vue3"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/wechatminiapp-login-get-use-info",
            "content_html": "<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"背景需求\">背景需求<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-login-get-use-info#%E8%83%8C%E6%99%AF%E9%9C%80%E6%B1%82\" class=\"hash-link\" aria-label=\"背景需求的直接链接\" title=\"背景需求的直接链接\">​</a></h2>\n<p>小程序用户进入小程序，判断用户未登录则跳转至登录状态进行登录操作，登录时后如果后台没有相关信息，则跳转至获取信息信息页面获取之后再进行登录。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"img\" src=\"https://yuluo-yx.github.io/assets/images/a6dba8d0a0b07e688f3eb741121d1704-929b743adcc4b9c7635030405f09d7d1.jpeg\" width=\"710\" height=\"720\" class=\"img_c29J\"></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"小程序前台\">小程序前台<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-login-get-use-info#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%89%8D%E5%8F%B0\" class=\"hash-link\" aria-label=\"小程序前台的直接链接\" title=\"小程序前台的直接链接\">​</a></h2>\n<p>检测用户是否登录，我将用户信息存到了 storage 中，以此来判断，在 onMounted 中调用：</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> </span><span class=\"token function-variable function\" style=\"color:hsl(221, 87%, 60%)\">checkUserLogin</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">uni</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getStorageSync</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"user\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">===</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    uni</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">redirectTo</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"> url</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'login'</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">console</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">uni</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getStorageSync</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"user\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>如果用户没有登录，则跳转至登录页面。登录页：</p>\n<div class=\"language-html codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-html codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-button</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">open-type</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">get</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">@click</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">userLogin()</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">type</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">primary</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">size</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">normal</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">shape</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">circle</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">text</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">登录</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">               </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:hairline</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">true</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-button</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">// script</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">const userLogin = () =&gt; {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> // 使用 uniapp 的微信小程序登录接口</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    uni.login({</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        \"provider\": \"weixin\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        // 微信登录仅请求授权认证</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        \"onlyAuthorize\": true,</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        success: function (event) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            const { code } = event</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            console.log(\"weixin code: \", code);</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   // 根据项目需求，自定义的业务逻辑</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            if (uni.getStorageSync(\"dbFlag\") &amp;&amp; uni.getStorageSync(\"userData\")) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                const userData = uni.getStorageSync(\"userData\")</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                wxUserLogin({</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    code: code,</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    phone: userData.phone,</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    nickName: userData.nickName,</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    avatar: userData.avatar</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                }).then((res: any) =&gt; {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    if (res.statusCode === 200) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        if (res.data.code === ResponseCode.Success) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            // 设置登录态</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            currentUser.value = res.data.data</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            let user: UserAuth = {}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            user.token = currentUser.value.token</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            user.type = Number(currentUser.value.type)</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            user.userId = currentUser.value.id</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.removeStorageSync(\"user\")</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.setStorageSync(\"user\", JSON.stringify(user))</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.removeStorageSync(\"userData\")</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.removeStorageSync(\"dbFlag\")</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.redirectTo({</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                url: \"index\"</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        } else {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.showModal({</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                title: '登录失败',</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                content: \"登录失败，请检查网络重试\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                success(res) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    if (res.confirm) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    } else if (res.cancel) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    } else {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        uni.showModal({</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            title: '登录失败',</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            content: res.message,</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            success(res) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                if (res.confirm) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    // 再次尝试登录</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    userLogin()</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                } else if (res.cancel) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            } else {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                wxUserLogin({</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    code: code</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                }).then((res: any) =&gt; {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    if (res.statusCode === 200) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        if (res.data.code === ResponseCode.Success) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            if (res.data.data.dbFlag == 1) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                // 表明当前登录的用户在后台数据库中没有对应的用户昵称</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                // 等信息，需要获取保存到数据库中。</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                uni.setStorageSync(\"dbFlag\", res.data.data.dbFlag)</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                setUserInfo()</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                console.log(\"后台数据库中没有用户信息，跳转至获取用户信息页！\");</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                return</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            // 设置登录态</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            currentUser.value = res.data.data</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            let user: UserAuth = {}</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            user.token = currentUser.value.token</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            user.type = Number(currentUser.value.type)</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            user.userId = currentUser.value.id</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.removeStorageSync(\"user\")</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.setStorageSync(\"user\", JSON.stringify(user))</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.redirectTo({</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                url: \"index\"</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        } else {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            uni.showModal({</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                title: '登录失败',</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                content: \"登录失败，请检查网络重试\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                success(res) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    if (res.confirm) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                        // 再次尝试登录</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                        userLogin()</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    } else if (res.cancel) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    } else {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        uni.showModal({</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            title: '登录失败',</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            content: res.message,</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            success(res) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                if (res.confirm) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    // 再次尝试登录</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                    userLogin()</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                } else if (res.cancel) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                                }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                            }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                        })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        },</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        fail: function (err) {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            console.log(\"微信登录失败：\", err);</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>如果后台数据库中没有用户的身份信息，则返回的标志位为 1 ，小程序跳转到获取用户身份信息的页面，进行获取：</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 用户在登录之后，需要获取用户的昵称和头像信息用于展示</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> </span><span class=\"token function-variable function\" style=\"color:hsl(221, 87%, 60%)\">setUserInfo</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    uni</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">redirectTo</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"> url</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'getUserInfo'</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>获取用户信息的 vue 页面：</p>\n<div class=\"language-vue codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-vue codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">template</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-navbar</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">leftIconColor</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">#f5f5f5</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:placeholder</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">true</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:safeAreaInsetTop</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">true</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">title</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">获取用户头像昵称</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:autoBack</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">true</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-navbar</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-toast</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">ref</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">uToastRef</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-toast</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">containar</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">index</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">avatarUrl</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">button</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">open-type</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">chooseAvatar</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">@chooseavatar</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">onChooseavatar</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">image</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:src</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">avatarUrl</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">refreshIcon</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">image</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">button</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">userName</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">text</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\">昵称：</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">text</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">input</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:clearable</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">false</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">type</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">nickname</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">weui-input</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:value</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">userName</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">@blur</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">bindblur</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">                    </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">placeholder</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">请选择或输入昵称</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">@input</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">bindinput</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">userPhone</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">text</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\">手机号：</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">text</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-button</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">phone</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">type</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">success</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">open-type</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">getPhoneNumber</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">                    </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">@getphonenumber</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">getPhoneNumber</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\">获取手机号</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-button</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag special-attr attr-name\" style=\"color:hsl(35, 99%, 36%)\">style</span><span class=\"token tag special-attr attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag special-attr attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag special-attr attr-value value css language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token tag special-attr attr-value value css language-css unit\" style=\"color:hsl(119, 34%, 47%)\">%</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token tag special-attr attr-value value css language-css property\" style=\"color:hsl(5, 74%, 59%)\">height</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css number\" style=\"color:hsl(35, 99%, 36%)\">1</span><span class=\"token tag special-attr attr-value value css language-css unit\" style=\"color:hsl(119, 34%, 47%)\">px</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css property\" style=\"color:hsl(5, 74%, 59%)\">background</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css hexcode color\" style=\"color:hsl(119, 34%, 47%)\">#EEE</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token tag special-attr attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">tips_1</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag special-attr attr-name\" style=\"color:hsl(35, 99%, 36%)\">style</span><span class=\"token tag special-attr attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag special-attr attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag special-attr attr-value value css language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css number\" style=\"color:hsl(35, 99%, 36%)\">700</span><span class=\"token tag special-attr attr-value value css language-css unit\" style=\"color:hsl(119, 34%, 47%)\">rpx</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css property\" style=\"color:hsl(5, 74%, 59%)\">height</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css number\" style=\"color:hsl(35, 99%, 36%)\">20</span><span class=\"token tag special-attr attr-value value css language-css unit\" style=\"color:hsl(119, 34%, 47%)\">px</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css property\" style=\"color:hsl(5, 74%, 59%)\">font-size</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css number\" style=\"color:hsl(35, 99%, 36%)\">13</span><span class=\"token tag special-attr attr-value value css language-css unit\" style=\"color:hsl(119, 34%, 47%)\">px</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css property\" style=\"color:hsl(5, 74%, 59%)\">margin</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> auto</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css property\" style=\"color:hsl(5, 74%, 59%)\">margin-top</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token tag special-attr attr-value value css language-css\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token tag special-attr attr-value value css language-css number\" style=\"color:hsl(35, 99%, 36%)\">40</span><span class=\"token tag special-attr attr-value value css language-css unit\" style=\"color:hsl(119, 34%, 47%)\">rpx</span><span class=\"token tag special-attr attr-value value css language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token tag special-attr attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            · 申请获取以下权限</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">tips</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            · 获得你的信息（昵称、头像、手机号等）</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">br</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-button</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">@click</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">onSubmit</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">type</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">primary</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\">保存</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">up-button</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">view</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">template</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">lang</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">ts</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">setup</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript imports punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript imports\"> </span><span class=\"token script language-javascript imports maybe-class-name\">ResponseCode</span><span class=\"token script language-javascript imports\"> </span><span class=\"token script language-javascript imports punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">\"@/types\"</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript imports punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript imports\"> getUserPhone </span><span class=\"token script language-javascript imports punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">\"../alova/service\"</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript constant\" style=\"color:hsl(35, 99%, 36%)\">BASE_URL</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'@/config'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> avatarUrl </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> ref</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token script language-javascript\">any</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> userName </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> ref</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token script language-javascript\">string</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">''</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> avatarPath </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> ref</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token script language-javascript\">string</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">''</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> userPhone </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> ref</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token script language-javascript\">string</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">''</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> uToastRef </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">ref</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript keyword null nil\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> list </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">ref</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">type</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'success'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">position</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'top'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">icon</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript boolean\" style=\"color:hsl(35, 99%, 36%)\">false</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">duration</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript number\" style=\"color:hsl(35, 99%, 36%)\">3000</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">message</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">\"小程序检测到没有您的用户信息，请依次点击下方头像和昵称以获取！\"</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">onReady</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">showToast</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">list</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token script language-javascript number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 方法</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">showToast</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter literal-property property\" style=\"color:hsl(5, 74%, 59%)\">params</span><span class=\"token script language-javascript parameter operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript parameter\"> any</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    uToastRef</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">show</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript spread operator\" style=\"color:hsl(221, 87%, 60%)\">...</span><span class=\"token script language-javascript\">params</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">complete</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            params</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">url</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">&amp;&amp;</span><span class=\"token script language-javascript\"> uni</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">navigateTo</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">url</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> params</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">url</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">getPhoneNumber</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter literal-property property\" style=\"color:hsl(5, 74%, 59%)\">e</span><span class=\"token script language-javascript parameter operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript parameter\"> any</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript console class-name\" style=\"color:hsl(35, 99%, 36%)\">console</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">log</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">\"微信获取电话号码的 code: \"</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"> e</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">detail</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">code</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    uni</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">login</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">provider</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'weixin'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter literal-property property\" style=\"color:hsl(5, 74%, 59%)\">_</span><span class=\"token script language-javascript parameter operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript parameter\"> any</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 调用后端接口获取用户手机号码</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">getUserPhone</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">code</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> e</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">detail</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">code</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">then</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter literal-property property\" style=\"color:hsl(5, 74%, 59%)\">res</span><span class=\"token script language-javascript parameter operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript parameter\"> any</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">res</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">data</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">code</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">===</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript maybe-class-name\">ResponseCode</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access maybe-class-name\">Success</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                    </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> data </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript known-class-name class-name\" style=\"color:hsl(35, 99%, 36%)\">JSON</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">parse</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">res</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">data</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">data</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// console.log(data);</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                    userPhone</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> data</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">phone_info</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">phoneNumber</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">fail</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter literal-property property\" style=\"color:hsl(5, 74%, 59%)\">err</span><span class=\"token script language-javascript parameter operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript parameter\"> any</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            uni</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">showModal</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">title</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'错误'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">content</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'获取用户手机号失败， err: '</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token script language-javascript\"> err</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter\">res</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                    </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">res</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">confirm</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">res</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">cancel</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 手动赋值，dev 跳过获取手机号</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// userPhone.value='18198086793'</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">bindblur</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter literal-property property\" style=\"color:hsl(5, 74%, 59%)\">e</span><span class=\"token script language-javascript parameter operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript parameter\"> any</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    userName</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> e</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">detail</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">bindinput</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter literal-property property\" style=\"color:hsl(5, 74%, 59%)\">e</span><span class=\"token script language-javascript parameter operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript parameter\"> any</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    userName</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> e</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">detail</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">onChooseavatar</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter literal-property property\" style=\"color:hsl(5, 74%, 59%)\">e</span><span class=\"token script language-javascript parameter operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript parameter\"> any</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    avatarUrl</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> e</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">detail</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">avatarUrl</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript doc-comment comment\" style=\"color:hsl(230, 4%, 64%)\">/**</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript doc-comment comment\" style=\"color:hsl(230, 4%, 64%)\"> * 上传头像，返回头像的路径信息</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript doc-comment comment\" style=\"color:hsl(230, 4%, 64%)\"> */</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">onSubmit</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">userName</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">''</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">||</span><span class=\"token script language-javascript\"> userPhone</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">''</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">||</span><span class=\"token script language-javascript\"> avatarUrl</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">''</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        uni</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">showModal</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">title</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'个人信息未设置'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">content</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'请点击相应选项以设置'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 在微信小程序开发工具和真机调试中，不会出现问题。如果在体验版中，需要在小程序后台设置上传文件域名，不然报错！</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 在提交中，将用户的昵称和头像信息提交到数据库存储</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 先上传图片获得 图片路径</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    uni</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">uploadFile</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">url</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript constant\" style=\"color:hsl(35, 99%, 36%)\">BASE_URL</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'upload/avatar'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">filePath</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> avatarUrl</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">name</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'file'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">function</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter\">res</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">let</span><span class=\"token script language-javascript\"> resp </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript known-class-name class-name\" style=\"color:hsl(35, 99%, 36%)\">JSON</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">parse</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">res</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">data</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            avatarPath</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> resp</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">data</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 保存用户信息</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">save</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">fail</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">function</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter\">err</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            uni</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">showModal</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">title</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'上传头像文件失败'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">                </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">content</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> err</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">errMsg</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">            </span><span class=\"token script language-javascript console class-name\" style=\"color:hsl(35, 99%, 36%)\">console</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">log</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">err</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">save</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> data </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">nickName</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> userName</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">avatar</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> avatarPath</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">phone</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> userPhone</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">value</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 暂时存储到 storage 中，在 login 中使用</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    uni</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">removeStorageSync</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">\"userData\"</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    uni</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">setStorageSync</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">\"userData\"</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"> data</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 跳转至登录页</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    uni</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">redirectTo</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">url</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">\"login\"</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">style</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">lang</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">scss</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">scoped</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.containar</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token style language-css unit\">vw</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">height</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token style language-css unit\">vh</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">background</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css hexcode color\">#fff</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">box-sizing</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> border-box</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">padding</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">30</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.index</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">display</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> flex</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">align-items</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> center</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">flex-direction</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> column</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.avatarUrl</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">padding</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">80</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">40</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">background</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css hexcode color\">#fff</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css selector\" style=\"color:hsl(119, 34%, 47%)\">button</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">background</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css hexcode color\">#fff</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">line-height</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">80</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">height</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> auto</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">border</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> none </span><span class=\"token style language-css important\" style=\"color:hsl(230, 8%, 24%);font-weight:bold\">!important</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> auto</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            // </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">padding</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">20</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">30</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">margin</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">display</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> flex</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">border</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> none</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">justify-content</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> center</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">align-items</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> center</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css selector\" style=\"color:hsl(119, 34%, 47%)\">&amp;</span><span class=\"token style language-css selector pseudo-element\" style=\"color:hsl(119, 34%, 47%)\">::after</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">                </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">border</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> none</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.refreshIcon</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">                </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">160</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">                </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">height</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">160</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">                </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">border-radius</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">50</span><span class=\"token style language-css unit\">%</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">                </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">background-color</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css hexcode color\">#ccc</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.jt</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">                </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">14</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">                </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">height</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">28</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.userName</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">background</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css hexcode color\">#fff</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">padding</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">20</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">30</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">80</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">display</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> flex</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">align-items</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> center</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">justify-content</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> center</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        // set font color</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">color</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css color\">black</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.weui-input</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">110</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">            </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">padding-left</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">60</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.userPhone</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">display</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> flex</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">233</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">align-items</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> center</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">margin-bottom</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">10</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        // 解决如果用户手机设置了黑暗模式，字不显示的问题</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">        </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">color</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css color\">black</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.tips</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">700</span><span class=\"token style language-css unit\">rpx</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">height</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">20</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">font-size</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">13</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">margin</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">5</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">15</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">19</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">color</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css hexcode color\">#cbcbcb</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.tips_1</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">color</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css color\">black</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css selector pseudo-element\" style=\"color:hsl(119, 34%, 47%)\">::v-deep</span><span class=\"token style language-css selector\" style=\"color:hsl(119, 34%, 47%)\"> </span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.u-button</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">border-radius</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">10</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css\"> </span><span class=\"token style language-css important\" style=\"color:hsl(230, 8%, 24%);font-weight:bold\">!important</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">    </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">160</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css\"> </span><span class=\"token style language-css important\" style=\"color:hsl(230, 8%, 24%);font-weight:bold\">!important</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">style</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>用户点击确认之后，跳转至 login 页面，完成登录操作。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"spring-boot-后台逻辑\">Spring Boot 后台逻辑<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-login-get-use-info#spring-boot-%E5%90%8E%E5%8F%B0%E9%80%BB%E8%BE%91\" class=\"hash-link\" aria-label=\"Spring Boot 后台逻辑的直接链接\" title=\"Spring Boot 后台逻辑的直接链接\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"微信小程序用户登录接口\">微信小程序用户登录接口<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-login-get-use-info#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3\" class=\"hash-link\" aria-label=\"微信小程序用户登录接口的直接链接\" title=\"微信小程序用户登录接口的直接链接\">​</a></h3>\n<p>在前面的流程图中，微信小程序的登录操作是先请求微信服务器，获取 code，在将 code 传递至应用后台服务器，请求接口获取 sessionId 和 openId 等信息。</p>\n<p>controller 代码：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@PostMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/user/weixin/login\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Result</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">login</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestBody</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">User</span><span class=\"token plain\"> user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">info</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"微信小程序用户登录....\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> userInfo </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> garageUserService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">weChatLogin</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Result</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">userInfo</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Service 代码：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">weChatLogin</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">User</span><span class=\"token plain\"> user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 微信小程序通用登录逻辑</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> url </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GarageConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatConstants</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">baseUrl </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"?appid=\"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        configProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAppId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"&amp;secret=\"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        configProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAppSecret</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"&amp;js_code=\"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getCode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"&amp;grant_type=authorization_code\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> resp </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getForObject</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WxCode2SessionResp</span><span class=\"token plain\"> wxCode2SessionResp </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">fromJson</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">resp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WxCode2SessionResp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> res </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HashMap</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Objects</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isNull</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">wxCode2SessionResp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">||</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Objects</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isNull</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">wxCode2SessionResp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getSession_key</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">error</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"微信小程序登录失败，查看日志！！！\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ServiceException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"微信登录失败，请重试！\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 业务逻辑</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 根据 openId 查询</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">int</span><span class=\"token plain\"> dbFlag</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 如果 openId 为空，则证明用户从未登陆过，则需要设置用户相关信息，手机号，头像，昵称等。</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">User</span><span class=\"token plain\"> openIdUser </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">userMapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">selectOneByQuery</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">QueryWrapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">eq</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">User</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">::</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOpenId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> wxCode2SessionResp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOpenid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">openIdUser </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 证明用户未登陆过</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getPhone</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 用户未登录过，同时也没有携带用户信息，则直接返回。</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            dbFlag </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">1</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"dbFlag\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> dbFlag </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">User</span><span class=\"token plain\"> phoneUser </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">userMapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">selectOneByQuery</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">QueryWrapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">eq</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">User</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">::</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getPhone</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getPhone</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">phoneUser </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 为用户，插入数据</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">var</span><span class=\"token plain\"> wxUser </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">User</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                wxUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">SnowFlakeIdGenerator</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">generateId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                wxUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">2</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                wxUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                wxUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setNickName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getNickName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                wxUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setOpenId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">wxCode2SessionResp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOpenid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">userMapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">insert</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">wxUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 登录</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StpUtil</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">login</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">wxUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"token\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StpUtil</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getTokenValue</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> wxUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"type\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> wxUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 维护人员，更新数据</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                phoneUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                phoneUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setNickName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getNickName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                phoneUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setOpenId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">wxCode2SessionResp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOpenid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">this</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">userMapper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">update</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">phoneUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 登录</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StpUtil</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">login</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">phoneUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOpenId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"token\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StpUtil</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getTokenValue</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> phoneUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"type\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> phoneUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">else</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 用户信息已经存在，直接登录</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StpUtil</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">login</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">openIdUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"token\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StpUtil</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getTokenValue</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> openIdUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"type\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> openIdUser</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>entity ：用来接受微信 API 返回的数据信息。</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WxCode2SessionResp</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// openId 用户唯一标识</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> openid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 会话密钥</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> session_key</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 用户在开放平台的唯一标识符，若当前小程序已绑定到微信开放平台帐号下会返回，详见 UnionID 机制说明。</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> unionid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\">         </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// number 错误码</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> errcode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\">         </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 错误信息</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> errmsg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\">    </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"获取用户手机号接口\">获取用户手机号接口<a href=\"https://yuluo-yx.github.io/blog/wechatminiapp-login-get-use-info#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%89%8B%E6%9C%BA%E5%8F%B7%E6%8E%A5%E5%8F%A3\" class=\"hash-link\" aria-label=\"获取用户手机号接口的直接链接\" title=\"获取用户手机号接口的直接链接\">​</a></h3>\n<p>微信小程序在获取用户手机号时，需要在后台调用 API 接口完成</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// controller</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@PostMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GarageConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatConstants</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">apiPrefix </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/getPhoneNumber\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Result</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getPhoneNumber</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestBody</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">User</span><span class=\"token plain\"> user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Result</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">garageUserService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getPhoneNumber</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// service</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Override</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getPhoneNumber</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">User</span><span class=\"token plain\"> user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> accessToken </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsgHelper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">refreshAccessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            configProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAppId</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            configProperties</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAppSecret</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// String PhoneBaseUrl = \"https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token=\";</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> url </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GarageConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">PhoneBaseUrl</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> accessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> paramMap </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HashMap</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    paramMap</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"code\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> user</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getCode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> body </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toJson</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">paramMap</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpHeaders</span><span class=\"token plain\"> headers </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpHeaders</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    headers</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setContentType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MediaType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">APPLICATION_JSON</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// spring boot 3.x 以上必须设置，不然会出现 412 错误状态码</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    headers</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setContentLength</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">body</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBytes</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StandardCharsets</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">UTF_8</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">length</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpEntity</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> httpEntity </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpEntity</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">body</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> headers</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ResponseEntity</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> response </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">postForEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> httpEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> response</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBody</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// helper</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsgHelper</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Logger</span><span class=\"token plain\"> logger </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">LoggerFactory</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getLogger</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatMsgHelper</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 推送消息的时候需要 accessToken，这里是获取</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// token的方法，在实际环境中，一般是定时刷新，</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 两个小时内有效，获取accesstoken时需要appid和secret信息，一般是后台参数或常量进行配置</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 获取 accessToken 的请求接口</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// String TokenBaseUrl = \"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential\";</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">final</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GetAccessToken</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GarageConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">WeChatConstants</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">TokenBaseUrl</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"&amp;appid={appid}&amp;secret={secret}\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">refreshAccessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> appid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> secret</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">RestTemplate</span><span class=\"token plain\"> restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">hasText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">appid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">||</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">StringUtils</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">hasText</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">secret</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            logger</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">error</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"刷新微信 AccessToken 时，缺少 appid 或 secret 参数！\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throw</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ServiceException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"刷新微信 AccessToken 时，缺少 appid 或 secret 参数！\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Map</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token generics\"> </span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Object</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> param </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HashMap</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"appid\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\">appid</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"secret\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\">secret</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ResponseEntity</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> resp </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> restTemplate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getForEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">GetAccessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                param</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JSONObject</span><span class=\"token plain\"> jsonObj </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> resp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getBody</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> accessToken </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">jsonObj </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            accessToken </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> jsonObj</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getStr</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"access_token\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> accessToken</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>",
            "url": "https://yuluo-yx.github.io/blog/wechatminiapp-login-get-use-info",
            "title": "微信小程序登录和获取信息功能记录",
            "summary": "背景需求",
            "date_modified": "2024-10-07T21:10:15.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "Unipp",
                "微信小程序",
                "Vue3"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/element-plus-upload-debug",
            "content_html": "<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"背景\">背景<a href=\"https://yuluo-yx.github.io/blog/element-plus-upload-debug#%E8%83%8C%E6%99%AF\" class=\"hash-link\" aria-label=\"背景的直接链接\" title=\"背景的直接链接\">​</a></h2>\n<p>在 Vue3 中使用 Element-plus 的文件上传组件 el-upload 组件上传至 Spring Boot 后台服务端失败，但 Postman 成功！</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"问题原因\">问题原因<a href=\"https://yuluo-yx.github.io/blog/element-plus-upload-debug#%E9%97%AE%E9%A2%98%E5%8E%9F%E5%9B%A0\" class=\"hash-link\" aria-label=\"问题原因的直接链接\" title=\"问题原因的直接链接\">​</a></h2>\n<p>Element-plus 中对上传的文件类型又做了一次封装，导致和后台对应的文件接受失败，出现各种各样的错误：</p>\n<p>Element-plus 文件上传对象定义：</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">export</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">interface</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">UploadFile</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    name</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    percentage</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">number</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    status</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> UploadStatus</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    size</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">number</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    response</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">unknown</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    uid</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">number</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    url</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    raw</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> UploadRawFile</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">export</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">interface</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">UploadRawFile</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">extends</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">File</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    uid</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">number</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>spring boot 后台接口</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@PostMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/avatar\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Result</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">uploadAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestParam</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MultipartFile</span><span class=\"token plain\"> file</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Result</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">uploadService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">uploadAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">file</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"踩坑\">踩坑<a href=\"https://yuluo-yx.github.io/blog/element-plus-upload-debug#%E8%B8%A9%E5%9D%91\" class=\"hash-link\" aria-label=\"踩坑的直接链接\" title=\"踩坑的直接链接\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"no-multipart-boundary-was-found\">no multipart boundary was found<a href=\"https://yuluo-yx.github.io/blog/element-plus-upload-debug#no-multipart-boundary-was-found\" class=\"hash-link\" aria-label=\"no multipart boundary was found的直接链接\" title=\"no multipart boundary was found的直接链接\">​</a></h3>\n<p>没有正确设置 header 中 Content-typ，在 postman 中，使用 form-data 形式上传文件，会自己设置 content-type。在 axios 中，需要手动设置</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"the-request-was-rejected-because-no-multipart-boundary-was-found\">the request was rejected because no multipart boundary was found<a href=\"https://yuluo-yx.github.io/blog/element-plus-upload-debug#the-request-was-rejected-because-no-multipart-boundary-was-found\" class=\"hash-link\" aria-label=\"the request was rejected because no multipart boundary was found的直接链接\" title=\"the request was rejected because no multipart boundary was found的直接链接\">​</a></h3>\n<p>上传 formdata 类型的变量：</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> form </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FormData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">form</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">append</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'file'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> file</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"required-part-file-is-not-present\">Required part 'file' is not present.<a href=\"https://yuluo-yx.github.io/blog/element-plus-upload-debug#required-part-file-is-not-present\" class=\"hash-link\" aria-label=\"Required part 'file' is not present.的直接链接\" title=\"Required part 'file' is not present.的直接链接\">​</a></h3>\n<p>注意上传文件时，使用 Element-plus UploadFile 属性中的 raw 属性值上传，不然就会出现此错误！</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 错误代码</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> </span><span class=\"token function-variable function\" style=\"color:hsl(221, 87%, 60%)\">uploadFile</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">async</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">file</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> File</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">await</span><span class=\"token plain\"> FileAPI</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">uploadAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">file</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">then</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 正确代码</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> </span><span class=\"token function-variable function\" style=\"color:hsl(221, 87%, 60%)\">uploadFile</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">async</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">file</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> UploadFile</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">await</span><span class=\"token plain\"> FileAPI</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">uploadAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">file</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">raw</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">then</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">log</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">res</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"完整代码示例\">完整代码示例<a href=\"https://yuluo-yx.github.io/blog/element-plus-upload-debug#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B\" class=\"hash-link\" aria-label=\"完整代码示例的直接链接\" title=\"完整代码示例的直接链接\">​</a></h2>\n<p>axios 接口封装</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">upload</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">async</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    url</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    file</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> File</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    config</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> AxiosRequestConfig</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">Promise</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token plain\">Result</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;&gt;</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> form </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">FormData</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    form</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">append</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'file'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> file</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> axiosInstance</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">post</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        url</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        form</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            headers</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token string-property property\" style=\"color:hsl(5, 74%, 59%)\">'Content-Type'</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'multipart/form-data'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">...</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">config</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?.</span><span class=\"token plain\">headers </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">||</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">            </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">...</span><span class=\"token plain\">config</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>vue 文件中代码</p>\n<div class=\"language-vue codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-vue codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">// template</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">el-upload</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">avatar-uploader</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">           </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">action</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">/</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:show-file-list</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">false</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:auto-upload</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">false</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">           </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:on-change</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">uploadFile</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">accept</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">.jpg, .jpeg, .png</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">el-avatar</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:size</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">75</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">:src</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">userAvatar</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">el-upload</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">// script</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">const uploadFile = async (file: UploadFile) =&gt; {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    await FileAPI.uploadAvatar(file.raw).then((res) =&gt; {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        log(res)</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    })</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>spring boot：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@PostMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/avatar\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Result</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">uploadAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestParam</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MultipartFile</span><span class=\"token plain\"> file</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 将所有的 HttpServletRequest 参数打印出来，以 debug 参数区别</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// System.out.println(file);</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// request.getParameterMap().forEach((k, v) -&gt; System.out.println(k + \" \" + Arrays.toString(v)));</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// return Result.success(\"success\");</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Result</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">uploadService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">uploadAvatar</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">file</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>",
            "url": "https://yuluo-yx.github.io/blog/element-plus-upload-debug",
            "title": "Element-plus Upload Debug 记录",
            "summary": "背景",
            "date_modified": "2024-09-20T22:34:07.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "Element-plus"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit",
            "content_html": "<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"需求背景\">需求背景<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF\" class=\"hash-link\" aria-label=\"需求背景的直接链接\" title=\"需求背景的直接链接\">​</a></h2>\n<p>甲方用户设备保修，乙方员工根据设备维护需要，在维护完成之后，在 Excel 维修任务文件上对检查维修的项目进行打勾，最后在下面输入一些备注信息。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"调研\">调研<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E8%B0%83%E7%A0%94\" class=\"hash-link\" aria-label=\"调研的直接链接\" title=\"调研的直接链接\">​</a></h2>\n<ol>\n<li>研究了 XLSX 等其他库，均不能完全实现需求，或是 API 太难用，或是样式显示有问题，Excel 文件中有图片，显示不全等等。最后在 Univer 和 LuckySheet 上研究。</li>\n<li>Univer 文档并不是很全面**（是我太菜了，看不懂😭）**，怎么将数据导入到 Univer 中，在 UI 上显示。都不是很好实现，看文档，需要借助他们的后端服务等等，最后没能实现。相关 discussion：<a href=\"https://github.com/dream-num/univer/discussions/3425\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/dream-num/univer/discussions/3425</a> 。结论问题并没有解决，因为我换了 LuckySheet。🤣</li>\n<li>LuckySheet 是Univer 的前身，不同的是 Univer 支持 Word Excel PPT 三种，前者只支持一种。完全实现了我的需求。</li>\n</ol>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"实操\">实操<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E5%AE%9E%E6%93%8D\" class=\"hash-link\" aria-label=\"实操的直接链接\" title=\"实操的直接链接\">​</a></h2>\n<p>我的解决方案是：在后端将 Excel 模板文件传给前端，前端作展示和编辑、。之后乙方维护人员完成 Excel 文件编辑。再传给后端和工单进行绑定。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"初始化项目\">初始化项目<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE\" class=\"hash-link\" aria-label=\"初始化项目的直接链接\" title=\"初始化项目的直接链接\">​</a></h3>\n<p>我使用的是 Vue3 + Vite + LuckySheet。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"准备-luckysheet\">准备 LuckySheet<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E5%87%86%E5%A4%87-luckysheet\" class=\"hash-link\" aria-label=\"准备 LuckySheet的直接链接\" title=\"准备 LuckySheet的直接链接\">​</a></h3>\n<p>参考：<a href=\"https://blog.csdn.net/m0_59415345/article/details/136749058\" target=\"_blank\" rel=\"noopener noreferrer\">https://blog.csdn.net/m0_59415345/article/details/136749058</a></p>\n<p>在项目中 引入 LuckySheet 有两种方式：</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"通过-cdn-引入\">通过 CDN 引入<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E9%80%9A%E8%BF%87-cdn-%E5%BC%95%E5%85%A5\" class=\"hash-link\" aria-label=\"通过 CDN 引入的直接链接\" title=\"通过 CDN 引入的直接链接\">​</a></h4>\n<p>直接在项目的 <code>index.html</code> 文件中引入 CDN 配置即可</p>\n<div class=\"language-html codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-html codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/plugins/css/pluginsCss.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/plugins/plugins.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/css/luckysheet.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/assets/iconfont/iconfont.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">src</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/plugins/js/plugin.js</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token script\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">src</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/luckysheet.umd.js</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token script\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"本地打包之后引入\">本地打包之后引入<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E6%9C%AC%E5%9C%B0%E6%89%93%E5%8C%85%E4%B9%8B%E5%90%8E%E5%BC%95%E5%85%A5\" class=\"hash-link\" aria-label=\"本地打包之后引入的直接链接\" title=\"本地打包之后引入的直接链接\">​</a></h4>\n<blockquote>\n<p>本地引入是将 CDN 需要的文件在本地打包之后在引入，避免网络请求。</p>\n</blockquote>\n<ol>\n<li>\n<p>拉取代码</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">git</span><span class=\"token plain\"> clone https://github.com/dream-num/Luckysheet.git</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>构建</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 按照依赖</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">install</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">install</span><span class=\"token plain\"> gulp </span><span class=\"token parameter variable\" style=\"color:hsl(221, 87%, 60%)\">-g</span><span class=\"token plain\">  </span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>启动预览</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> run dev</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>可以在浏览器中看到如下页面：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Luckysheet 预览\" src=\"https://yuluo-yx.github.io/assets/images/img2-28d4dbe8a508c5a9763401b7e1df3aec.png\" width=\"1640\" height=\"977\" class=\"img_c29J\"></p>\n</li>\n<li>\n<p>打包</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> run build</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>之后将 dist 中的文件全部复制到项目的 public 文件中，**可以根据需要复制到不同位置，在引入时，注意路径即可。**不需要引入 <code>index.html</code>。</p>\n</li>\n</ol>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"项目使用\">项目使用<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8\" class=\"hash-link\" aria-label=\"项目使用的直接链接\" title=\"项目使用的直接链接\">​</a></h4>\n<p>这部分 CDN 引入和本地引入区别不大。只需要注意路径即可：</p>\n<div class=\"language-html codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-html codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">&lt;!-- CDN 引入 --&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/plugins/css/pluginsCss.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/plugins/plugins.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/css/luckysheet.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/assets/iconfont/iconfont.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">src</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/plugins/js/plugin.js</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token script\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">src</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">https://cdn.jsdelivr.net/npm/luckysheet/dist/luckysheet.umd.js</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token script\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">&lt;!-- 本地构建之后引入 --&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">./public/plugins/css/pluginsCss.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">./public/plugins/plugins.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">./public/css/luckysheet.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">link</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">rel</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">stylesheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">href</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">./public/assets/iconfont/iconfont.css</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">'</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">src</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">./public/plugins/js/plugin.js</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token script\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">src</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">./public/luckysheet.umd.js</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token script\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\">  </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">&lt;!-- 注意路径不同 --&gt;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"项目页面\">项目页面<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E9%A1%B9%E7%9B%AE%E9%A1%B5%E9%9D%A2\" class=\"hash-link\" aria-label=\"项目页面的直接链接\" title=\"项目页面的直接链接\">​</a></h3>\n<p>在初始化好的 Vite 项目中 App.vue 中写入如下代码：</p>\n<p>注意需要安装 <code>luckysheet</code>。不然会报错！！！</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> i luckysheet</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<div class=\"language-vue codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-vue codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">template</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">div</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">upload</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">input</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">id</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">uploadBtn</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">type</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">file</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">@change</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">loadExcel</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">/&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">div</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">div</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">id</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">luckysheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">class</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">luckysheet</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">div</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">template</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">lang</span><span class=\"token tag attr-value punctuation attr-equals\" style=\"color:hsl(119, 34%, 47%)\">=</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag attr-value\" style=\"color:hsl(119, 34%, 47%)\">ts</span><span class=\"token tag attr-value punctuation\" style=\"color:hsl(119, 34%, 47%)\">\"</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">setup</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript imports punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript imports\"> onMounted </span><span class=\"token script language-javascript imports punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">\"vue\"</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript imports maybe-class-name\">LuckyExcel</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'luckyexcel'</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript imports\">axios</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword module\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'axios'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">onMounted</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//如果这里luckysheet.create报错</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//请使用 window.luckysheet.create</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  luckysheet</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">create</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">container</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'luckysheet'</span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//这里需要和容器的id名称一致</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 从后端接口获取 excel 文件使用</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">loadExcel</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 按钮上传使用，注意区分</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// const loadExcel = (evt) =&gt; {</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//   const files = evt.target.files</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//   if (files == null || files.length == 0) {</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     alert('请上传文件')</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     return</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//   }</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//   let name = files[0].name</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//   let suffixArr = name.split('.'),</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     suffix = suffixArr[suffixArr.length - 1]</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//   if (suffix != 'xlsx' &amp;&amp; suffix != \"xls\") {</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     alert('只能导入xlsx文件格式的Excel')</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     return</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//   }</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//   LuckyExcel.transformExcelToLucky(files[0], function (exportJson, luckysheetfile) {</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     if (exportJson.sheets == null || exportJson.sheets.length == 0) {</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//       alert('导入失败!')</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//       return</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     }</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     window.luckysheet.destroy()</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     window.luckysheet.create({</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//       container: 'luckysheet', //容器的Id</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//       showinfobar: false,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//       data: exportJson.sheets,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//       title: exportJson.info.name,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//       userInfo: exportJson.info.name.creator</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//     })</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">//   })</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// }</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript function-variable function\" style=\"color:hsl(221, 87%, 60%)\">loadExcel</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">async</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript arrow operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 发送 POST 请求到后端以获取 Excel 文件</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">try</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 接口地址</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> response </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">await</span><span class=\"token script language-javascript\"> axios</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">post</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'http://localhost:8080/api/v1/download/task'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// taskId: '922364778947073' </span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">taskId</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'822364778947073'</span><span class=\"token script language-javascript\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// taskId: '722364778947073' </span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// taskId: '622364778947073'</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">headers</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript string-property property\" style=\"color:hsl(5, 74%, 59%)\">'Content-Type'</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">\"application/json\"</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">responseType</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'blob'</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 将响应转换为 Blob</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// const blob = await response.blob();</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 将 ArrayBuffer 转换为 Blob</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> blob </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript class-name\" style=\"color:hsl(35, 99%, 36%)\">Blob</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token script language-javascript\">response</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">data</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token script language-javascript\"> file </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript class-name\" style=\"color:hsl(35, 99%, 36%)\">File</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token script language-javascript\">blob</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'downloaded_file.xlsx'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">type</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript console class-name\" style=\"color:hsl(35, 99%, 36%)\">console</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">log</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">file</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// // 创建一个临时的 URL</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// const url = URL.createObjectURL(file);</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// // 创建一个链接元素</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// const a = document.createElement('a');</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// a.href = url;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// a.download = file.name; // 设置下载文件名</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// // 触发下载</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// document.body.appendChild(a);</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// a.click();</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// // 清理</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// document.body.removeChild(a);</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// URL.revokeObjectURL(url); // 释放内存</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript maybe-class-name\">LuckyExcel</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">transformExcelToLucky</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">file</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword\" style=\"color:hsl(301, 63%, 40%)\">function</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript parameter\">exportJson</span><span class=\"token script language-javascript parameter punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript parameter\"> luckysheetfile</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">exportJson</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">sheets</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword null nil\" style=\"color:hsl(301, 63%, 40%)\">null</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">||</span><span class=\"token script language-javascript\"> exportJson</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">sheets</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">length</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">==</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">alert</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'1221332, 导入失败!'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript dom variable\" style=\"color:hsl(221, 87%, 60%)\">window</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">luckysheet</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">destroy</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript dom variable\" style=\"color:hsl(221, 87%, 60%)\">window</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">luckysheet</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript method function property-access\" style=\"color:hsl(221, 87%, 60%)\">create</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">container</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript string\" style=\"color:hsl(119, 34%, 47%)\">'luckysheet'</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript comment\" style=\"color:hsl(230, 4%, 64%)\">// 容器的Id</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">showinfobar</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript boolean\" style=\"color:hsl(35, 99%, 36%)\">false</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">data</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> exportJson</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">sheets</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">title</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> exportJson</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">info</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">name</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">        </span><span class=\"token script language-javascript literal-property property\" style=\"color:hsl(5, 74%, 59%)\">userInfo</span><span class=\"token script language-javascript operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token script language-javascript\"> exportJson</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">info</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">name</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript property-access\">creator</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">      </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">catch</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript\">error</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript\"> </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">    </span><span class=\"token script language-javascript function\" style=\"color:hsl(221, 87%, 60%)\">alert</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token script language-javascript template-string template-punctuation string\" style=\"color:hsl(119, 34%, 47%)\">`</span><span class=\"token script language-javascript template-string string\" style=\"color:hsl(119, 34%, 47%)\">导入失败: </span><span class=\"token script language-javascript template-string interpolation interpolation-punctuation punctuation\" style=\"color:hsl(119, 34%, 47%)\">${</span><span class=\"token script language-javascript template-string interpolation\">error</span><span class=\"token script language-javascript template-string interpolation punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token script language-javascript template-string interpolation property-access\">message</span><span class=\"token script language-javascript template-string interpolation interpolation-punctuation punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript template-string template-punctuation string\" style=\"color:hsl(119, 34%, 47%)\">`</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\">  </span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token script language-javascript punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token script language-javascript\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token script language-javascript\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">script</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">style</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\"> </span><span class=\"token tag attr-name\" style=\"color:hsl(35, 99%, 36%)\">scoped</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.luckysheet</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">margin</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">padding</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">position</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> absolute</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">width</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token style language-css unit\">%</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">height</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token style language-css unit\">%</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">left</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">top</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">30</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css comment\" style=\"color:hsl(230, 4%, 64%)\">/* 调整此值以向下移动 */</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css selector class\" style=\"color:hsl(119, 34%, 47%)\">.upload</span><span class=\"token style language-css\"> </span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">position</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> absolute</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">left</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">top</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">z-index</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">10</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css comment\" style=\"color:hsl(230, 4%, 64%)\">/* 确保按钮在最上层 */</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">background-color</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css color\">white</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css comment\" style=\"color:hsl(230, 4%, 64%)\">/* 可选 */</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">border</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">1</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css\"> solid </span><span class=\"token style language-css hexcode color\">#ccc</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css comment\" style=\"color:hsl(230, 4%, 64%)\">/* 可选 */</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css property\" style=\"color:hsl(5, 74%, 59%)\">padding</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token style language-css\"> </span><span class=\"token style language-css number\" style=\"color:hsl(35, 99%, 36%)\">5</span><span class=\"token style language-css unit\">px</span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\">  </span><span class=\"token style language-css comment\" style=\"color:hsl(230, 4%, 64%)\">/* 可选 */</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token style language-css punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token style language-css\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token style language-css\"></span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;/</span><span class=\"token tag\" style=\"color:hsl(5, 74%, 59%)\">style</span><span class=\"token tag punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<blockquote>\n<p>注意上述代码的区别，一个 LoadExcel 方法是上传使用，有参数。另外一个是 onMounted 使用，没有参数。如果从后端传递，注意修改接口地址。</p>\n</blockquote>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"运行\">运行<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E8%BF%90%E8%A1%8C\" class=\"hash-link\" aria-label=\"运行的直接链接\" title=\"运行的直接链接\">​</a></h3>\n<p>最终效果如下：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"本地运行效果图\" src=\"https://yuluo-yx.github.io/assets/images/img1-211722a1e29ef40ba3d0244763898ba5.png\" width=\"1009\" height=\"854\" class=\"img_c29J\"></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"仓库\">仓库<a href=\"https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit#%E4%BB%93%E5%BA%93\" class=\"hash-link\" aria-label=\"仓库的直接链接\" title=\"仓库的直接链接\">​</a></h2>\n<p>相关代码和依赖已经放到：<a href=\"https://github.com/yuluo-yx/deigmata-paideias/tree/main/vue3-vite-lucksheet\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/yuluo-yx/deigmata-paideias/tree/main/vue3-vite-lucksheet</a> 中。</p>",
            "url": "https://yuluo-yx.github.io/blog/vue3-vite-merge-lucky-sheet-preview-excel-edit",
            "title": "Vue3 + Vite 整合 LuckySheet 完成 Excel 文件的预览和编辑",
            "summary": "需求背景",
            "date_modified": "2024-09-14T22:49:58.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "Unipp",
                "微信小程序",
                "Vue3"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp",
            "content_html": "<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"组件介绍\">组件介绍<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D\" class=\"hash-link\" aria-label=\"组件介绍的直接链接\" title=\"组件介绍的直接链接\">​</a></h2>\n<blockquote>\n<p>Vitesse Uni App：<a href=\"https://vitesse-docs.netlify.app/\" target=\"_blank\" rel=\"noopener noreferrer\">https://vitesse-docs.netlify.app/</a></p>\n<p>UI：<a href=\"https://uview-plus.jiangruyi.com/components/intro.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://uview-plus.jiangruyi.com/components/intro.html</a></p>\n<p>编辑器：VScode 安装 Volar（Vue Offices）插件</p>\n</blockquote>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"创建项目\">创建项目<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE\" class=\"hash-link\" aria-label=\"创建项目的直接链接\" title=\"创建项目的直接链接\">​</a></h2>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">pnpm</span><span class=\"token plain\"> create uni </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token plain\">project-name</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token parameter variable\" style=\"color:hsl(221, 87%, 60%)\">-t</span><span class=\"token plain\"> vitesse</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"创建页面\">创建页面<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%88%9B%E5%BB%BA%E9%A1%B5%E9%9D%A2\" class=\"hash-link\" aria-label=\"创建页面的直接链接\" title=\"创建页面的直接链接\">​</a></h2>\n<p>参考：<a href=\"https://vitesse-docs.netlify.app/getting-started/views\" target=\"_blank\" rel=\"noopener noreferrer\">https://vitesse-docs.netlify.app/getting-started/views</a></p>\n<p>创建方式非常简单，即看即会</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"引入-ui-库\">引入 UI 库<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%BC%95%E5%85%A5-ui-%E5%BA%93\" class=\"hash-link\" aria-label=\"引入 UI 库的直接链接\" title=\"引入 UI 库的直接链接\">​</a></h2>\n<blockquote>\n<p>这步稍微有些麻烦。</p>\n<p>安装文档地址：<a href=\"https://uview-plus.jiangruyi.com/components/install.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://uview-plus.jiangruyi.com/components/install.html</a></p>\n<p>配置文档地址：<a href=\"https://uview-plus.jiangruyi.com/components/npmSetting.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://uview-plus.jiangruyi.com/components/npmSetting.html</a></p>\n</blockquote>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"安装-sass\">安装 Sass<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%AE%89%E8%A3%85-sass\" class=\"hash-link\" aria-label=\"安装 Sass的直接链接\" title=\"安装 Sass的直接链接\">​</a></h3>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">// 安装sass</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> i sass </span><span class=\"token parameter variable\" style=\"color:hsl(221, 87%, 60%)\">-D</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">// 安装sass-loader，注意需要版本10，否则可能会导致vue与sass的兼容问题而报错</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> i sass-loader@10 </span><span class=\"token parameter variable\" style=\"color:hsl(221, 87%, 60%)\">-D</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"安装依赖\">安装依赖<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96\" class=\"hash-link\" aria-label=\"安装依赖的直接链接\" title=\"安装依赖的直接链接\">​</a></h4>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">install</span><span class=\"token plain\"> uview-plus</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">install</span><span class=\"token plain\"> dayjs</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">install</span><span class=\"token plain\"> clipboard</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"引入-js-库\">引入 JS 库<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%BC%95%E5%85%A5-js-%E5%BA%93\" class=\"hash-link\" aria-label=\"引入 JS 库的直接链接\" title=\"引入 JS 库的直接链接\">​</a></h4>\n<div class=\"language-js codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-js codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// main.js</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword module\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token plain\"> </span><span class=\"token imports\">uviewPlus</span><span class=\"token plain\"> </span><span class=\"token keyword module\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'uview-plus'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// #ifdef VUE3</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword module\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token plain\"> </span><span class=\"token imports punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token imports\"> createSSRApp </span><span class=\"token imports punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword module\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'vue'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword module\" style=\"color:hsl(301, 63%, 40%)\">export</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">function</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createApp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> app </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createSSRApp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token maybe-class-name\">App</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  app</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token method function property-access\" style=\"color:hsl(221, 87%, 60%)\">use</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">uviewPlus</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword control-flow\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    app</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// #endif</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"引入全局-css\">引入全局 CSS<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%BC%95%E5%85%A5%E5%85%A8%E5%B1%80-css\" class=\"hash-link\" aria-label=\"引入全局 CSS的直接链接\" title=\"引入全局 CSS的直接链接\">​</a></h4>\n<div class=\"language-css codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-css codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">/* uni.scss */</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token atrule rule\" style=\"color:hsl(35, 99%, 36%)\">@import</span><span class=\"token atrule\" style=\"color:hsl(35, 99%, 36%)\"> </span><span class=\"token atrule string\" style=\"color:hsl(119, 34%, 47%)\">'uview-plus/theme.scss'</span><span class=\"token atrule punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"引入基础样式\">引入基础样式<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%BC%95%E5%85%A5%E5%9F%BA%E7%A1%80%E6%A0%B7%E5%BC%8F\" class=\"hash-link\" aria-label=\"引入基础样式的直接链接\" title=\"引入基础样式的直接链接\">​</a></h4>\n<div class=\"language-css codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-css codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">&lt;style lang=</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"scss\"</span><span class=\"token plain\">&gt;</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">/* 注意要写在第一行，同时给style标签加入lang=\"scss\"属性 */</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token atrule rule\" style=\"color:hsl(35, 99%, 36%)\">@import</span><span class=\"token atrule\" style=\"color:hsl(35, 99%, 36%)\"> </span><span class=\"token atrule string\" style=\"color:hsl(119, 34%, 47%)\">\"uview-plus/index.scss\"</span><span class=\"token atrule punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">&lt;/style&gt;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"配置-easycom-模式\">配置 easycom 模式<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E9%85%8D%E7%BD%AE-easycom-%E6%A8%A1%E5%BC%8F\" class=\"hash-link\" aria-label=\"配置 easycom 模式的直接链接\" title=\"配置 easycom 模式的直接链接\">​</a></h4>\n<p>参考：<a href=\"https://uview-plus.jiangruyi.com/components/npmSetting.html#%E9%85%8D%E7%BD%AEeasycom%E7%BB%84%E4%BB%B6%E6%A8%A1%E5%BC%8F\" target=\"_blank\" rel=\"noopener noreferrer\">https://uview-plus.jiangruyi.com/components/npmSetting.html#%E9%85%8D%E7%BD%AEeasycom%E7%BB%84%E4%BB%B6%E6%A8%A1%E5%BC%8F</a></p>\n<div class=\"language-json codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-json codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// pages.json</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"easycom\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"autoscan\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">true</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 注意一定要放在custom里，否则无效，https://ask.dcloud.net.cn/question/131175</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"custom\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"^u--(.*)\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"uview-plus/components/u-$1/u-$1.vue\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"^up-(.*)\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"uview-plus/components/u-$1/u-$1.vue\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">         </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"^u-([^-].*)\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"uview-plus/components/u-$1/u-$1.vue\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 此为本身已有的内容</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"pages\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// ......</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"配置-typescript-支持\">配置 typescript 支持<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E9%85%8D%E7%BD%AE-typescript-%E6%94%AF%E6%8C%81\" class=\"hash-link\" aria-label=\"配置 typescript 支持的直接链接\" title=\"配置 typescript 支持的直接链接\">​</a></h4>\n<div class=\"language-json codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-json codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"compilerOptions\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"sourceMap\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">true</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"baseUrl\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\".\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"paths\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"@/*\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"./src/*\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"lib\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"esnext\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"dom\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"types\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"@dcloudio/types\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"uview-plus/types\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:hsl(5, 74%, 59%)\">\"include\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"src/**/*.ts\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"src/**/*.d.ts\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"src/**/*.tsx\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"src/**/*.vue\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"启动项目查看\">启动项目查看<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%90%AF%E5%8A%A8%E9%A1%B9%E7%9B%AE%E6%9F%A5%E7%9C%8B\" class=\"hash-link\" aria-label=\"启动项目查看的直接链接\" title=\"启动项目查看的直接链接\">​</a></h2>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> run dev:h5</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"预览图片\" src=\"https://yuluo-yx.github.io/assets/images/image-05714b5a60fd80344f150490a67d54f1.png\" width=\"557\" height=\"311\" class=\"img_c29J\"></p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"踩坑记录\">踩坑记录<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95\" class=\"hash-link\" aria-label=\"踩坑记录的直接链接\" title=\"踩坑记录的直接链接\">​</a></h3>\n<p>在 pages.json 中配置 easycom 配置时，再次重新启动项目，会导致 pages.json 中的文件刷新，然后 ui 样式引入失效，需要在 pages.config.json 中配置</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"> defineUniPages </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'@uni-helper/vite-plugin-uni-pages'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">export</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">default</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">defineUniPages</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  pages</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  globalStyle</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    backgroundColor</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'@bgColor'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    backgroundColorBottom</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'@bgColorBottom'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    backgroundColorTop</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'@bgColorTop'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    backgroundTextStyle</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'@bgTxtStyle'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    navigationBarBackgroundColor</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'#000000'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    navigationBarTextStyle</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'@navTxtStyle'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    navigationBarTitleText</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'Vitesse-Uni'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    navigationStyle</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'custom'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// tabBar: {</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">//   backgroundColor: \"@tabBgColor\",</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">//   borderStyle: \"@tabBorderStyle\",</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">//   color: \"@tabFontColor\",</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">//   selectedColor: \"@tabSelectedColor\",</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// },</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token string-property property\" style=\"color:hsl(5, 74%, 59%)\">\"easycom\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token string-property property\" style=\"color:hsl(5, 74%, 59%)\">\"autoscan\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">true</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token string-property property\" style=\"color:hsl(5, 74%, 59%)\">\"custom\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token string-property property\" style=\"color:hsl(5, 74%, 59%)\">\"^u--(.*)\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"uview-plus/components/u-$1/u-$1.vue\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token string-property property\" style=\"color:hsl(5, 74%, 59%)\">\"^up-(.*)\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"uview-plus/components/u-$1/u-$1.vue\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">         </span><span class=\"token string-property property\" style=\"color:hsl(5, 74%, 59%)\">\"^u-([^-].*)\"</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"uview-plus/components/u-$1/u-$1.vue\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"使用-alovajs-作为小程序的请求工具\">使用 alova.js 作为小程序的请求工具<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E4%BD%BF%E7%94%A8-alovajs-%E4%BD%9C%E4%B8%BA%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%AF%B7%E6%B1%82%E5%B7%A5%E5%85%B7\" class=\"hash-link\" aria-label=\"使用 alova.js 作为小程序的请求工具的直接链接\" title=\"使用 alova.js 作为小程序的请求工具的直接链接\">​</a></h2>\n<p>官网：<a href=\"https://alova.js.org/zh-CN/\" target=\"_blank\" rel=\"noopener noreferrer\">https://alova.js.org/zh-CN/</a></p>\n<p>unipp 插件：<a href=\"https://alova.js.org/zh-CN/resource/request-adapter/uniapp\" target=\"_blank\" rel=\"noopener noreferrer\">https://alova.js.org/zh-CN/resource/request-adapter/uniapp</a></p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"安装\">安装<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%AE%89%E8%A3%85\" class=\"hash-link\" aria-label=\"安装的直接链接\" title=\"安装的直接链接\">​</a></h3>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">npm</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">install</span><span class=\"token plain\"> @alova/adapter-uniapp </span><span class=\"token parameter variable\" style=\"color:hsl(221, 87%, 60%)\">--save</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"封装\">封装<a href=\"https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp#%E5%B0%81%E8%A3%85\" class=\"hash-link\" aria-label=\"封装的直接链接\" title=\"封装的直接链接\">​</a></h3>\n<p>index.ts</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">//index.ts</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"> createAlova </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'alova'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token plain\"> AdapterUniapp </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'@alova/adapter-uniapp'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">export</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> AlovaInstance </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createAlova</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  baseURL</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'http://localhost:8080/api/v1/'</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// https://alova.js.org/zh-CN/resource/request-adapter/uniapp#%E5%88%9B%E5%BB%BA-alova</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">...</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">AdapterUniapp</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 请求拦截器</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">beforeRequest</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 响应拦截器</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  responded</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>api.ts</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"> AlovaInstance </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'./index'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> headers </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"> </span><span class=\"token string-property property\" style=\"color:hsl(5, 74%, 59%)\">'Content-Type'</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'application/json;charset=UTF-8'</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> timeout </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">5000</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">export</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> Alova </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createGet</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> params</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> Record</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">any</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> AlovaInstance</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">Get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      headers</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      params</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      timeout</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createPost</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> data</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> Record</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">any</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> params</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> Record</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">any</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> AlovaInstance</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">Post</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> data</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      params</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createTodoPut</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> data</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> Record</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">any</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> params</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> Record</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">any</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> AlovaInstance</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">Put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\">data</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      params</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createDelete</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> data</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> Record</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">any</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> params</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">?</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> Record</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">any</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> AlovaInstance</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">Put</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">url</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\">data</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      params</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>service.ts</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\">Alova</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"./api\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// Law notice</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">export</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> </span><span class=\"token function-variable function\" style=\"color:hsl(221, 87%, 60%)\">getLawNotice</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> Alova</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">createGet</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"law\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>调用：</p>\n<div class=\"language-ts codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-ts codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token plain\">script lang</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"ts\"</span><span class=\"token plain\"> setup</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\">getLawNotice</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"../alova/service\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">import</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\">concatenate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> ulg</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">from</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"../utils/strings/index\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// data</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> content </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token generic-function function\" style=\"color:hsl(221, 87%, 60%)\">ref</span><span class=\"token generic-function generic class-name operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token generic-function generic class-name builtin\" style=\"color:hsl(119, 34%, 47%)\">string</span><span class=\"token generic-function generic class-name operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// const law </span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// request api</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">const</span><span class=\"token plain\"> </span><span class=\"token function-variable function\" style=\"color:hsl(221, 87%, 60%)\">getLawList</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">async</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">await</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getLawNotice</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">then</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">result</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">any</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// check status code</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">if</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">result</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">statusCode </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">===</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// get data</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">let</span><span class=\"token plain\"> lawList </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> result</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">data</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">data</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">for</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">let</span><span class=\"token plain\"> i </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"> i </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token plain\"> lawList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">length</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"> i</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">++</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">let</span><span class=\"token plain\"> text </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> lawList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token plain\">i</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">text</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// ulg(text)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        content</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">value </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">concatenate</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">content</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\" \"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> text</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">catch</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">err</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token builtin\" style=\"color:hsl(119, 34%, 47%)\">any</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=&gt;</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">alert</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">err</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>",
            "url": "https://yuluo-yx.github.io/blog/use-vitesse-unipp-and-alovajs-build-wechatminiapp",
            "title": "使用 Vitesse unipp & Alovajs 构建微信小程序",
            "summary": "组件介绍",
            "date_modified": "2024-09-10T22:57:50.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "Unipp",
                "微信小程序"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/become-apache-committer",
            "content_html": "<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"我的开源历程\">我的开源历程<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E6%88%91%E7%9A%84%E5%BC%80%E6%BA%90%E5%8E%86%E7%A8%8B\" class=\"hash-link\" aria-label=\"我的开源历程的直接链接\" title=\"我的开源历程的直接链接\">​</a></h2>\n<p>说起开源，我在大三刚开始的时候就接触到了。当时的场景仍然历历在目。</p>\n<p>回想起来，我第一个正式的 Github Pull Request 是给 Spring Cloud Alibaba 项目删除了一个多余的 Pom 依赖项。当时手忙脚乱，在捉摸了两个多小时后，才算是成功提交了第一个 Pull Request。非常感谢<a href=\"https://github.com/steverao\" target=\"_blank\" rel=\"noopener noreferrer\">铖朴</a>，是他带着我认识了开源，踏出了参与开源至关重要的第一步。</p>\n<p>从刚开始使用 Git 的手忙脚乱，到现在 <code>git c -m XXX</code>，以及 Github 上参与的各个 PR/Issue。回想起来，真是思绪万千。我觉得人生莫过于如此。学习摸索 -&gt; 熟练使用 -&gt; 做出成绩。</p>\n<p>从大三至今，我仍然保持着对开源的热情，参与开源，直至今日，我已经是三个项目的 Committer 了。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"参与-apache-community\">参与 Apache Community<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E5%8F%82%E4%B8%8E-apache-community\" class=\"hash-link\" aria-label=\"参与 Apache Community的直接链接\" title=\"参与 Apache Community的直接链接\">​</a></h2>\n<p><a href=\"https://community.apache.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Apache 软件基金会（Apache Software Foundation，简称为ASF）</a>，是一家美国的非营利组织，旨在支持各类开源软件项目。ASF最初由 Apache HTTP Server 的一群开发者组成，并在1999年3月25日正式成立。 截至2021年，其总成员数大约在1000名。命名是根据北美当地的一支印第安部落而来，这支部落以高超的军事素养和超人的忍耐力著称，19世纪后半期对侵占他们领土的入侵者进行了反抗。为了对这支印第安部落表示敬仰之意，取该部落名称（Apache）作为服务器名。但一提到这个命名，这里还有流传着一段有意思的故事。因为这个服务器是在 NCSA HTTPd 服务器的基础之上，通过众人努力，不断地修正、打补丁（Patchy）的产物，被戏称为“A Patchy Server”（一个补丁服务器）。在这里，因为“A Patchy”与“Apache”是谐音，故最后正式命名为“Apache Server”。</p>\n<p>以上是来自于维基百科中对 Apache 软件基金会的介绍。</p>\n<p>Apache 软件基金会起初是由开发 <a href=\"https://httpd.apache.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Apache HTTPd</a> 的开发人员组成，他们以 Apache HTTPd 这一网络服务器项目为起点，创建了许多优秀的开源项目，吸引全球共同的开源爱好者参与项目的维护与迭代。不断有项目退休，不断有新项目被孵化，反反复复。才有了今天的 Apache 软件基金会。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Apache HTTPd Server Logo\" src=\"https://yuluo-yx.github.io/assets/images/4-7f27a1963a2a0f34e4798265ccd4eefc.jpg\" width=\"500\" height=\"250\" class=\"img_c29J\"></p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"第一次贡献\">第一次贡献<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%B4%A1%E7%8C%AE\" class=\"hash-link\" aria-label=\"第一次贡献的直接链接\" title=\"第一次贡献的直接链接\">​</a></h3>\n<p>在 Apache 社区中的第一次贡献应该是给 Dubbo 项目删除了一个 <code>{@link}</code> 代码链接。说来惭愧，<a href=\"https://github.com/apache/dubbo\" target=\"_blank\" rel=\"noopener noreferrer\">Dubbo</a> 是我参与 Apache 的第一个开源项目，到现在为止仅有 6 个提交。5 月份的时候通过 <a href=\"https://github.com/LinuxSuRen\" target=\"_blank\" rel=\"noopener noreferrer\">Rick</a> 接触到了 <a href=\"https://github.com/apache/hertzbeat\" target=\"_blank\" rel=\"noopener noreferrer\">Apache Hertzbeat</a> 项目，从单元测试开始了我的 Apache 贡献之路。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"获得提名成为-committer\">获得提名，成为 Committer<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E8%8E%B7%E5%BE%97%E6%8F%90%E5%90%8D%E6%88%90%E4%B8%BA-committer\" class=\"hash-link\" aria-label=\"获得提名，成为 Committer的直接链接\" title=\"获得提名，成为 Committer的直接链接\">​</a></h3>\n<p>此次提名是 Apache HertzbeatP(Incubating) 的 PMC Member <a href=\"https://github.com/zqr10159\" target=\"_blank\" rel=\"noopener noreferrer\">Logic</a> 举荐的，感谢 Apache Hertzbeat Team。顺利提名成为了 Hertzbeat Committer，有了自己的 Apache 邮箱。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Apache ID Email\" src=\"https://yuluo-yx.github.io/assets/images/3-af6b1c6b58b3851a44a826a7f0a59009.jpg\" width=\"1481\" height=\"510\" class=\"img_c29J\"></p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"apache-committer-的意义\">Apache Committer 的意义<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#apache-committer-%E7%9A%84%E6%84%8F%E4%B9%89\" class=\"hash-link\" aria-label=\"Apache Committer 的意义的直接链接\" title=\"Apache Committer 的意义的直接链接\">​</a></h3>\n<p>俗话说，能力越大，任务越大。成为了项目的 Committer 不仅仅是一个身份的转换，更是一个对自己自身能力的认同和肯定。在 Review PR 时，我的 <code>LGTM</code> 不再是一个灰色样式，而是变成了蓝色（因个人 Github 主题不同，展现的颜色也不同）。不用在等待其他的 Committer Approve CI。意味着对项目有了管理权利。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"PR Approve\" src=\"https://yuluo-yx.github.io/assets/images/5-c361870647f85aa061df419ba755da8c.jpg\" width=\"565\" height=\"275\" class=\"img_c29J\"></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"参与开源的方法\">参与开源的方法<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E5%8F%82%E4%B8%8E%E5%BC%80%E6%BA%90%E7%9A%84%E6%96%B9%E6%B3%95\" class=\"hash-link\" aria-label=\"参与开源的方法的直接链接\" title=\"参与开源的方法的直接链接\">​</a></h2>\n<p>任何人去做一件事情，都需要一个契机和引路人。在许许多多的 Apache 项目中，不乏关注项目 Issue List 的人。记忆犹新的一次是：某个晚上在写完工具类的单元测试，发现了一个小 Bug。当时心里想的是，这个上下文信息太多了，写在 PR 里面不太好，于是开了一个 Issue 记录上下文。这个 Bug 小到什么程度呢？小到我刚创建完 Issue，在将单元测试和修复 Bug 的代码一起提交之后，再次刷新 PR List，看到了一个修复 Bug 的 PR Title。</p>\n<p>其实不缺乏关注项目的人，更多的是需要一个契机！参与项目的契机。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"the-apache-way\">The Apache Way<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#the-apache-way\" class=\"hash-link\" aria-label=\"The Apache Way的直接链接\" title=\"The Apache Way的直接链接\">​</a></h3>\n<p>Apache Community 奉行的 <a href=\"https://www.apache.org/theapacheway/\" target=\"_blank\" rel=\"noopener noreferrer\">The Apache Way</a>。社区大于代码，好的社区往往比优秀的代码更重要，社区的组成成分包括开发者，用户等等。用户才是项目代码的第一使用者，健康的社区状态是用户在使用过程中：发现问题，而后报告问题，最后解决问题。更可能发生的一种情况是，用户报告问题，从用户身份转为开发者，解决问题。并在之后持续参与社区项目的维护。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"参与开源的路径\">参与开源的路径<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E5%8F%82%E4%B8%8E%E5%BC%80%E6%BA%90%E7%9A%84%E8%B7%AF%E5%BE%84\" class=\"hash-link\" aria-label=\"参与开源的路径的直接链接\" title=\"参与开源的路径的直接链接\">​</a></h3>\n<p>开源往往很纯粹，Apache 基金会存在的意义也是为了保护项目和开发者。</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"apache-社区身份定义\">Apache 社区身份定义<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#apache-%E7%A4%BE%E5%8C%BA%E8%BA%AB%E4%BB%BD%E5%AE%9A%E4%B9%89\" class=\"hash-link\" aria-label=\"Apache 社区身份定义的直接链接\" title=\"Apache 社区身份定义的直接链接\">​</a></h4>\n<p>参与社区贡献之前，先要了解社区的身份定义是怎样的，项目的 Committer 到底位于哪一层级，怎么才能成为 Committer。Apache 社区对<a href=\"https://community.apache.org/contributor-ladder.html\" target=\"_blank\" rel=\"noopener noreferrer\">贡献者身份</a>有很明确的定义：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Apache contributor label\" src=\"https://yuluo-yx.github.io/assets/images/6-0729cf03ad23c3dfa35048013fc5a156.jpg\" width=\"1464\" height=\"708\" class=\"img_c29J\"></p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"项目-committer-提名条件\">项目 Committer 提名条件<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E9%A1%B9%E7%9B%AE-committer-%E6%8F%90%E5%90%8D%E6%9D%A1%E4%BB%B6\" class=\"hash-link\" aria-label=\"项目 Committer 提名条件的直接链接\" title=\"项目 Committer 提名条件的直接链接\">​</a></h4>\n<p>项目 PMC Team 提名 Committer 的条件是不一样的。以 Apache Hertzbeat 为例：</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Apache Hertzbeat becoming committer\" src=\"https://yuluo-yx.github.io/assets/images/7-305a8108fc8ad9644b9bd053a254ef80.jpg\" width=\"1012\" height=\"551\" class=\"img_c29J\"></p>\n<p>每个项目都有自己的标准，这些标准也不是一成不变，在项目的每个阶段会进行调整。</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"如何参与开源\">如何参与开源<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E5%A6%82%E4%BD%95%E5%8F%82%E4%B8%8E%E5%BC%80%E6%BA%90\" class=\"hash-link\" aria-label=\"如何参与开源的直接链接\" title=\"如何参与开源的直接链接\">​</a></h4>\n<p>接下来是此章节的重头戏，如何参与开源并获得 Committer 提名？</p>\n<h5 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"开源活动\">开源活动<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E5%BC%80%E6%BA%90%E6%B4%BB%E5%8A%A8\" class=\"hash-link\" aria-label=\"开源活动的直接链接\" title=\"开源活动的直接链接\">​</a></h5>\n<p>学生因为身份特殊，没有大型项目的开发经验，也没有机会在生产环境中切身使用。因此参与开源往往很困难，缺少契机。</p>\n<p>我觉得参与开源并获得提名的最好方式是<strong>开源之夏（OSPP）或者谷歌开源之夏（GSOC）活动</strong>。在完成相关课题之后，逐步熟悉项目功能、代码、持续参与就会获得提名。也不乏一些学生在完成题目之后被直接提名成为项目 Committer。</p>\n<p>其次是<strong>提高自己的 Coding 能力</strong>，发现项目中缺少的单元测试和代码 Bug，然后提交 PR 修复。这对刚开始的同学往往是比较难得。Coding 能力往往是在优化项目代码，了解每一次 Change 之后慢慢积累的。</p>\n<p>一个好的项目，<strong>周边生态往往是至关重要的</strong>。一份好的文档，可以让用户/开发者快速上手使用，参与贡献。多语言扩展，可以让项目使用在其他语言构建的项目中，扩大项目受众。一个好的 Example 仓库，可以让用户发现更多项目的使用姿势。因此参与 Example 仓库的建设和文档编写、翻译等工作，也是熟悉项目获得提名的方式之一。</p>\n<p>最后，我要说的是：获得提名是<code>水到渠成</code>的事情，不能为了获得提名而去参与开源，任何时候都不要忘记自己的初心。</p>\n<p>项目社区往往欢迎各种方式的贡献：不论是代码、文档还是布道。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"随想\">随想<a href=\"https://yuluo-yx.github.io/blog/become-apache-committer#%E9%9A%8F%E6%83%B3\" class=\"hash-link\" aria-label=\"随想的直接链接\" title=\"随想的直接链接\">​</a></h2>\n<p>写下此文，是为了纪念成为 Apache Hertzbeat Committer 这个特殊的事情, 同时也是对我之后参与开源的激励。\n保持热情，保持 Coding。感谢在参与开源的时候给与我帮助的各位。</p>",
            "url": "https://yuluo-yx.github.io/blog/become-apache-committer",
            "title": "成为 Apache Committer, 对我参与开源的肯定",
            "summary": "我的开源历程",
            "date_modified": "2024-08-17T16:21:54.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "Open Source",
                "Apache",
                "Committer"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/case-by-unit-test",
            "content_html": "<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"背景概述\">背景概述<a href=\"https://yuluo-yx.github.io/blog/case-by-unit-test#%E8%83%8C%E6%99%AF%E6%A6%82%E8%BF%B0\" class=\"hash-link\" aria-label=\"背景概述的直接链接\" title=\"背景概述的直接链接\">​</a></h2>\n<p>背景来自于给 Apache Hertzbeat 编写单元测试，发现的一个问题。这个问题也是历史遗留问题，之前的测试类是注释的状态。</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">15</span><span class=\"token plain\">:18:38.013 </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token plain\">main</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"> WARN org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver -- Resolved </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token plain\">org.springframework.http.converter.HttpMessageNotWritableException: Could not </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">write</span><span class=\"token plain\"> JSON: </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">was java.lang.UnsupportedOperationException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">java.lang.AssertionError: Status expected:</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">20</span><span class=\"token operator file-descriptor important\" style=\"color:hsl(230, 8%, 24%);font-weight:bold\">0</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\"> but was:</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">50</span><span class=\"token operator file-descriptor important\" style=\"color:hsl(230, 8%, 24%);font-weight:bold\">0</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">Expected :200</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">Actual   :500</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>没有任何其他信息，报错如上。</p>\n<p>单元测试和代码如下：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@GetMapping</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Operation</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">summary </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Example Query the alarm definition list\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">           description </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"You can obtain the list of alarm definitions by querying filter items\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ResponseEntity</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Page</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">AlertDefine</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAlertDefines</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Parameter</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">description </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Alarm Definition ID\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> example </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"6565463543\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestParam</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">required </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">false</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">Long</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> ids</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Parameter</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">description </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Search-Target Expr Template\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> example </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"x\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestParam</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">required </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">false</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> search</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Parameter</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">description </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Alarm Definition Severity\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> example </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"6565463543\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestParam</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">required </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:hsl(35, 99%, 36%)\">false</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Byte</span><span class=\"token plain\"> priority</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Parameter</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">description </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Sort field, default id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> example </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestParam</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">defaultValue </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> sort</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Parameter</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">description </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Sort mode: asc: ascending, desc: descending\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> example </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"desc\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestParam</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">defaultValue </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"desc\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> order</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Parameter</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">description </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"List current page\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> example </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"0\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestParam</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">defaultValue </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"0\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">int</span><span class=\"token plain\"> pageIndex</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Parameter</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">description </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Number of list pages\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> example </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"8\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RequestParam</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">defaultValue </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"8\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">int</span><span class=\"token plain\"> pageSize</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Page</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">AlertDefine</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> alertDefinePage </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> alertDefineService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAlertDefines</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">ids</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> search</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> priority</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> sort</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> order</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> pageIndex</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> pageSize</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ResponseEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">ok</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">alertDefinePage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>测试类：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Test</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAlertDefines</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throws</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Exception</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">when</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">alertDefineService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAlertDefines</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">List</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">1L</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Test\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">byte</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">1</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"desc\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">1</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">10</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">thenReturn</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">PageImpl</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Collections</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">singletonList</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">alertDefine</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    mockMvc</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">perform</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MockMvcRequestBuilders</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">get</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/api/alert/defines\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"ids\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"1\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"search\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Test\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"priority\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"1\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"sort\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"order\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"desc\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"pageIndex\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"1\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">param</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"pageSize\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"10\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">accept</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">MediaType</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">APPLICATION_JSON</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">andExpect</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">status</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">isOk</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">andExpect</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">jsonPath</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"$.code\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">int</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">CommonConstants</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">SUCCESS_CODE</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">andExpect</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">jsonPath</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"$.data.content[0].app\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"linux\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">andExpect</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">jsonPath</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"$.data.content[0].id\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"9\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">andExpect</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">jsonPath</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"$.data.content[0].metric\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">value</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"disk\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">andReturn</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"分析\">分析<a href=\"https://yuluo-yx.github.io/blog/case-by-unit-test#%E5%88%86%E6%9E%90\" class=\"hash-link\" aria-label=\"分析的直接链接\" title=\"分析的直接链接\">​</a></h2>\n<p>经过 google 确定了可能发生问题的原因：</p>\n<ol>\n<li>使用了 Arrays.asList(T t) 方法</li>\n<li>实体类种属性为 null 值，而没有使用 <code>@JsonIgnore</code> 等注解</li>\n<li>没有使用包装类型而使用了 int，long 等基元类型</li>\n<li>在 spring 反向解析对象时，会调用 is 开头返回 boolean 类型的方法</li>\n</ol>\n<p>总共 google 到了以上四种原因，经过和项目中的其他实体类对比和分析，进行逐一排除。最后发现都没有符合上述问题的选项。</p>\n<p>继而看到了返回值的对象类型，发现不是单独的实体类型，而是一个 <code>Page&lt;T&gt;</code> 类型的对象，想到，会不会是 Page 中某个属性为空造成的 Json 序列化异常。</p>\n<p>在 Controller 中加入以下代码片段：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Page</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics class-name\" style=\"color:hsl(35, 99%, 36%)\">AlertDefine</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token plain\"> alertDefinePage </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> alertDefineService</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getAlertDefines</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">ids</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> search</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> priority</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> sort</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> order</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> pageIndex</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> pageSize</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 模拟序列化过程进行调试</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> json </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">JsonUtil</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">toJson</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">alertDefinePage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">System</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">out</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">println</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">json</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ResponseEntity</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">ok</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Message</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">success</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">alertDefinePage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>运行测试，发现确实报错：</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">15</span><span class=\"token plain\">:32:00.342 </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token plain\">main</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"> ERROR org.apache.hertzbeat.common.util.JsonUtil -- </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">was java.lang.UnsupportedOperationException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">through reference chain: org.springframework.data.domain.PageImpl</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"pageable\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\">-</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\">org.springframework.data.domain.Unpaged</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"offset\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">com.fasterxml.jackson.databind.JsonMappingException: </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">was java.lang.UnsupportedOperationException</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">through reference chain: org.springframework.data.domain.PageImpl</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"pageable\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\">-</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\">org.springframework.data.domain.Unpaged</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"offset\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>这样，我们就从控制台看到了更多的错误信息，<code>Unpaged 中的 offset</code> 貌似有点问题。输出它看看</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">System</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">out</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">println</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">alertDefinePage</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getPageable</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getOffset</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">jakarta</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">servlet</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">ServletException</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Request</span><span class=\"token plain\"> processing failed</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">java</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">lang</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">UnsupportedOperationException</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>果不其然，确实有问题。再次 google 之后，找到了社区 issue：<a href=\"https://github.com/spring-projects/spring-data-commons/issues/2987%EF%BC%8C%E5%85%B6%E4%B8%AD%E4%B8%80%E4%BD%8D%E5%BA%94%E8%AF%A5%E6%98%AF%E7%A4%BE%E5%8C%BA%E7%BB%B4%E6%8A%A4%E8%80%85%EF%BC%8C%E6%9B%B4%E6%98%AF%E8%AF%B4%E5%87%BA\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/spring-projects/spring-data-commons/issues/2987，其中一位应该是社区维护者，更是说出</a> Pageable 从未打算被序列化。🥲</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Spring Data 社区回复\" src=\"https://yuluo-yx.github.io/assets/images/1-1e8154dc659932c9d39973427430cfe3.png\" width=\"1232\" height=\"298\" class=\"img_c29J\"></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"修复\">修复<a href=\"https://yuluo-yx.github.io/blog/case-by-unit-test#%E4%BF%AE%E5%A4%8D\" class=\"hash-link\" aria-label=\"修复的直接链接\" title=\"修复的直接链接\">​</a></h2>\n<p>确定了问题之后，寻找修复的办法。</p>\n<p>根据社区 issue 进展，总共有两种修复办法：</p>\n<ol>\n<li>\n<p>通过 PageImpl 重新包装 Page 对象：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Pageable</span><span class=\"token plain\"> pageable </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">PageRequest</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">of</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">10</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">PageImpl</span><span class=\"token plain\"> page </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">PageImpl</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&lt;</span><span class=\"token generics punctuation\" style=\"color:hsl(119, 34%, 47%)\">&gt;</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">myArraylist</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> pageable</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">,</span><span class=\"token plain\"> myArraylist</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">size</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n<li>\n<p>将 <strong>SpringDataJacksonConfiguration.PageModule</strong> 添加到 <strong>Jackson2ObjectMapperBuilder</strong></p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Bean</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Jackson2ObjectMapperBuilder</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">objectMapperBuilder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">SpringDataJacksonConfiguration</span><span class=\"token class-name punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">PageModule</span><span class=\"token plain\"> pageModule</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Jackson2ObjectMapperBuilder</span><span class=\"token plain\"> builder </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Jackson2ObjectMapperBuilder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">modules</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">pageModule</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> builder</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n</li>\n</ol>",
            "url": "https://yuluo-yx.github.io/blog/case-by-unit-test",
            "title": "由单元测试发现的代码 Bug",
            "summary": "背景概述",
            "date_modified": "2024-08-05T15:51:51.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "Spring Data JPA"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/spring-boot-web-app-request-debug",
            "content_html": "<p>线上接口响应太慢，Spring Boot + 内嵌的 Tomcat 服务器，Tomcat 处理请求的最大线程数普通情况是 150 左右，最大是 200，所以当同时处理的请求过多，并且每个请求一直没有处理完成。所有的线程都在繁忙，没有办法处理新的请求，就会导致新的请求排队等待处理，从而造成了迟迟无法响应的线上事故，用户体验太差。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"场景复现\">场景复现<a href=\"https://yuluo-yx.github.io/blog/spring-boot-web-app-request-debug#%E5%9C%BA%E6%99%AF%E5%A4%8D%E7%8E%B0\" class=\"hash-link\" aria-label=\"场景复现的直接链接\" title=\"场景复现的直接链接\">​</a></h2>\n<p>一个简单的 controller 接口</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@RestController</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">SpringBootController</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@GetMapping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"/\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">index</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">throws</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">InterruptedException</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">// 每个线程都睡眠，模拟业务接口响应慢的问题</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Thread</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">sleep</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">60</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">*</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">30</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">*</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">1000</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">System</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">out</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">println</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"current thread: \"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Thread</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">currentThread</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getName</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">return</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Hello Spring Boot!\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>随后设置 tomcat 服务器的最大线程为 5 ：</p>\n<div class=\"language-yml codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-yml codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">server</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">port</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">tomcat</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">threads</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">max</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">5</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">spring</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">application</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> simple</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\">application</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"测试\">测试<a href=\"https://yuluo-yx.github.io/blog/spring-boot-web-app-request-debug#%E6%B5%8B%E8%AF%95\" class=\"hash-link\" aria-label=\"测试的直接链接\" title=\"测试的直接链接\">​</a></h2>\n<p>之后我们在单元测试中模拟 10 个线程对接口发起请求</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">RequestTest</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">main</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">String</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"> args</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">for</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">int</span><span class=\"token plain\"> i </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"> i </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&lt;</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">10</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"> i</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">++</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Thread</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">RequestTask</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">start</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">private</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">static</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">class</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">RequestTask</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">implements</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Runnable</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token annotation punctuation\" style=\"color:hsl(119, 34%, 47%)\">@Override</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">public</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">void</span><span class=\"token plain\"> </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">run</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">try</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">URL</span><span class=\"token plain\"> url </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">new</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">URL</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"http://localhost:8080/\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpURLConnection</span><span class=\"token plain\"> connection </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">HttpURLConnection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> url</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">openConnection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    connection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">setRequestMethod</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"GET\"</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">int</span><span class=\"token plain\"> responseCode </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">=</span><span class=\"token plain\"> connection</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">getResponseCode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">System</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token plain\">out</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">println</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"Response Code: \"</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token plain\"> responseCode</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token keyword\" style=\"color:hsl(301, 63%, 40%)\">catch</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">IOException</span><span class=\"token plain\"> e</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    e</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">printStackTrace</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">;</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>首先，我们注释掉 controller 中的睡眠代码，运行测试得到以下的输出：</p>\n<div class=\"language-java codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-java codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">spring boot web 应用响应输出：</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">2024</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">08</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">01</span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">T15</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">56</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">25.369</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">+</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">08</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">00</span><span class=\"token plain\">  </span><span class=\"token constant\" style=\"color:hsl(35, 99%, 36%)\">INFO</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">7304</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">--</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token plain\">simple</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">application</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">[</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">2</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">]</span><span class=\"token plain\"> </span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">o</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">s</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">web</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name namespace\" style=\"color:hsl(35, 99%, 36%)\">servlet</span><span class=\"token class-name namespace punctuation\" style=\"color:hsl(119, 34%, 47%)\">.</span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">DispatcherServlet</span><span class=\"token plain\">        </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Completed</span><span class=\"token plain\"> initialization in </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">0</span><span class=\"token plain\"> ms</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">4</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">5</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">1</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">2</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">3</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">5</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">2</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">4</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">1</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">current thread</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> http</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">nio</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token plain\">exec</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">3</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">    </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">测试输出：</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Response</span><span class=\"token plain\"> </span><span class=\"token class-name\" style=\"color:hsl(35, 99%, 36%)\">Code</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">200</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>我们看到线程在响应输出。接下来，打开注释代码，模拟事故现场。将会在控制台看不到任何输出，测试方法也会卡住不动。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"排查\">排查<a href=\"https://yuluo-yx.github.io/blog/spring-boot-web-app-request-debug#%E6%8E%92%E6%9F%A5\" class=\"hash-link\" aria-label=\"排查的直接链接\" title=\"排查的直接链接\">​</a></h2>\n<p>我们使用 JVM 的一些命令来进行排查：</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 首先查看 java 的进程 id</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">C:</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">\\</span><span class=\"token plain\">Users</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">\\</span><span class=\"token plain\">Administrator</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\">jps </span><span class=\"token parameter variable\" style=\"color:hsl(221, 87%, 60%)\">-l</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">18400</span><span class=\"token plain\"> indi.yuluo.tomcat.SpringBootApplication</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">10324</span><span class=\"token plain\"> jdk.jcmd/sun.tools.jps.Jps</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">16872</span><span class=\"token plain\"> org.jetbrains.jps.cmdline.Launcher</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">18072</span><span class=\"token plain\"> org.jetbrains.idea.maven.server.RemoteMavenServer36</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">9624</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">7372</span><span class=\"token plain\"> inid.yuluo.tomcat.RequestTest</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>我们看到 SpringBootApplication 和 RequestTest 在运行，之后使用 jstack 命令生成线程快照，并保存为文件。</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">C:</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">\\</span><span class=\"token plain\">Users</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">\\</span><span class=\"token plain\">Administrator</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\">jstack </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">18400</span><span class=\"token plain\"> </span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\"> C:</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">\\</span><span class=\"token plain\">Users</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">\\</span><span class=\"token plain\">Administrator</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">\\</span><span class=\"token plain\">Desktop</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">\\</span><span class=\"token plain\">spring-boot-thread_dump.txt</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>打开线程快照文件，搜索 <code>http-nio</code> 就能看到 Tomcat 的请求处理线程，所有的请求处理线程状态都是 <code>TIMED_WAITING</code> ，表示线程正在等待另一个线程执行特定的动作，但是有一个指定的等待时间。而且能直接看到请求是阻塞在了哪个代码位置。</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">\"http-nio-8080-exec-2\"</span><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\">#28 daemon prio=5 os_prio=0 cpu=0.00ms elapsed=187.14s tid=0x0000015ffe6089f0 nid=0x1ee4 waiting on condition  [0x00000026eb5fc000]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># `TIMED_WAITING`</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   java.lang.Thread.State: TIMED_WAITING </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">sleeping</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> at java.lang.Thread.sleep</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">java.base@17.0.1/Native Method</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 阻塞位置：</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"> at indi.yuluo.tomcat.controller.SpringBootController.index</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">(</span><span class=\"token plain\">SpringBootController.java:18</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">)</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"解决方案\">解决方案<a href=\"https://yuluo-yx.github.io/blog/spring-boot-web-app-request-debug#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\" class=\"hash-link\" aria-label=\"解决方案的直接链接\" title=\"解决方案的直接链接\">​</a></h2>\n<p>适当修改 Tomcat 的最大线程数，可以增加并发请求的处理能力。</p>\n<p>适当调大 Tomcat 的最小空闲线程数，可以确保在并发高峰时刻，Tomcat 能迅速响应新的请求，而不需要重新创建线程。</p>\n<p>修改值需要对用户体量做出预估之后，进行测试之后确定。</p>",
            "url": "https://yuluo-yx.github.io/blog/spring-boot-web-app-request-debug",
            "title": "Spring Boot Web 应用请求故障排查",
            "summary": "线上接口响应太慢，Spring Boot + 内嵌的 Tomcat 服务器，Tomcat 处理请求的最大线程数普通情况是 150 左右，最大是 200，所以当同时处理的请求过多，并且每个请求一直没有处理完成。所有的线程都在繁忙，没有办法处理新的请求，就会导致新的请求排队等待处理，从而造成了迟迟无法响应的线上事故，用户体验太差。",
            "date_modified": "2024-08-01T16:09:46.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "Spring Boot"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/coca-2024",
            "content_html": "<p>东方欲晓，早早起床。准备将这三天的 CommunityOverCode Asia 2024 的参会经历记录一下。也算是一次难得的经历，下次不知道到什么时候了。（PS：封面图来自 <a href=\"https://www.pil0txia.com/\" target=\"_blank\" rel=\"noopener noreferrer\">@pil0txia</a> 的酒店外景。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"one-day\">One Day<a href=\"https://yuluo-yx.github.io/blog/coca-2024#one-day\" class=\"hash-link\" aria-label=\"One Day的直接链接\" title=\"One Day的直接链接\">​</a></h2>\n<p>这一定是三天内最<code>尴尬</code>的一天，前天晚上失眠没睡着。第二天早上起来迟了。洗嗽了下速速出门，刚到楼下准备去做地铁。屋漏偏逢连夜雨，竟然下雨了。于是乎，上去拿了个把伞。一看时间竟然九点了，想到八点半就开始签到了。遂原地打车...</p>\n<p>到了之后，搞了一个参会牌子。牌子拿到手里感觉真不错。😆</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"CocA 2024 参会牌\" src=\"https://yuluo-yx.github.io/assets/images/11-6633ba55feb07f59348264c07aab8820.png\" width=\"2084\" height=\"2778\" class=\"img_c29J\"></p>\n<p>印象中，进去之后，已经到了 Craig 在讲 Apache@25。全程英语，听着还不错，比起之前 Api7 实习的尼泊尔和印度老哥的方言英语，不知道好了多少倍。🥲</p>\n<p>参会途中，与 GSOC 群里的 <a href=\"https://www.pil0txia.com/\" target=\"_blank\" rel=\"noopener noreferrer\">@pil0txia</a> 聊了起来，然后就过去一起坐了。也是聊了很多，But 那天早上感冒，戴了口罩，多多少少有点影响交流了。以至于之后的一天也是如此。最后一天好了不少。终于是取下了口罩。</p>\n<p>第一天中午结束的时候，和 GSOC 群里的小伙伴一起拍了合照（忘记没有摘口罩...</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"GSOC\" src=\"https://yuluo-yx.github.io/assets/images/3-d2d7ae642f432eaffea9e78de0d8c34b.png\" width=\"2604\" height=\"1688\" class=\"img_c29J\"></p>\n<p>下午的分会场议题是在一楼的微服务厅里面，也是看到了熟悉但是没有见过面的军哥（刘军）。因为没有认出来，以至于第二天才去打了招呼。然后匆匆分开。（本来也没啥事情，打招呼不小心看到了电脑屏幕，在写下午 Spring Cloud Alibaba AI 【下文简称 SCA AI】 的 PPT。看来也是临时抱佛脚了。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"two-day\">Two Day<a href=\"https://yuluo-yx.github.io/blog/coca-2024#two-day\" class=\"hash-link\" aria-label=\"Two Day的直接链接\" title=\"Two Day的直接链接\">​</a></h2>\n<p>第二天也算是<code>特殊</code>的经历，本来想多睡会。掏出手机看会议日程，怎么阿里云专场的 SCA AI 演讲在早上？emmm...</p>\n<p>然后匆匆去赶地铁。到了之后，问了何亮，时间改到下午，还是在之前的微服务厅举行。心里郁闷，去吃了饭，找了个空会议厅打游戏到下午一点。又约上了 <a href=\"https://www.pil0txia.com/\" target=\"_blank\" rel=\"noopener noreferrer\">@pil0txia</a> 去二楼站台薅了一袋子纪念品。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"第二天站台纪念品\" src=\"https://yuluo-yx.github.io/assets/images/12-b10d4c52a0208f8d13e9e024b9ba2700.jpg\" width=\"1280\" height=\"1707\" class=\"img_c29J\"></p>\n<p>中途和 <a href=\"https://www.pil0txia.com/\" target=\"_blank\" rel=\"noopener noreferrer\">@pil0txia</a> 一起，以至于也被当成了<code>小红书的老师</code>。🤣</p>\n<p>完了之后，赶去阿里云的会场，看军哥的 SCA AI。没想到又换了位置...</p>\n<p>找到会议厅位置，进去坐着，军哥对我说：今天这个本来应该你去讲（😆）我回答说资历不够，身份不合适，还是应该军哥讲。然后仔细听完了 SCA AI 的演讲，虽然 SCA AI 的代码是我写的，但是听军哥讲，也收获很多。特别是对 Spring AI 接口的抽象解释。因为坐的靠后，拍的照片不清晰，就不放了接口照片了。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"军哥在讲 SCA AI\" src=\"https://yuluo-yx.github.io/assets/images/4-5853c5cc664c22a390c758e95d1d741d.png\" width=\"2772\" height=\"2080\" class=\"img_c29J\"></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"three-day\">Three Day<a href=\"https://yuluo-yx.github.io/blog/coca-2024#three-day\" class=\"hash-link\" aria-label=\"Three Day的直接链接\" title=\"Three Day的直接链接\">​</a></h2>\n<p>第三天去的迟了些，到会场都两点了。也是铁了心要吃到会场的茶歇点心。在二楼转悠了半个小时，时间到就去 room4 前面的吃到了。（挺精致...</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"茶歇点心\" src=\"https://yuluo-yx.github.io/assets/images/5-977514beb922596ed4fef907440e40e7.png\" width=\"1015\" height=\"1106\" class=\"img_c29J\"></p>\n<p>因为 <a href=\"https://www.pil0txia.com/\" target=\"_blank\" rel=\"noopener noreferrer\">@pil0txia</a> 在听 APISIX 的演讲，帮他提前拿了份。之后也是一起拍了张合照。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"第三天茶歇合照\" src=\"https://yuluo-yx.github.io/assets/images/7-1f106e51021e6333842fe81904fe78fc.png\" width=\"4032\" height=\"3024\" class=\"img_c29J\"></p>\n<p>中途蹭进去 room4 拍了张分会场合照。🤣</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Gateway &amp;amp; observability 会场合照\" src=\"https://yuluo-yx.github.io/assets/images/8-bdda264337de87f56edac47b25984e39.png\" width=\"2982\" height=\"1986\" class=\"img_c29J\"></p>\n<p>之后铖朴大佬说他第三天要来，看了日程。竟然也在 room4 演讲。真巧，进去听了铖朴分享的 <code>WebServe/Tomcat 可观测</code> 议题，介绍的是 <code>Graalvm</code> 应用的可观测性，技术性挺强，膜拜一波！😆</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"铖朴可观测性演讲\" src=\"https://yuluo-yx.github.io/assets/images/9-73fec23a8c6f7050cd8421b0a8e4e761.png\" width=\"2772\" height=\"2080\" class=\"img_c29J\"></p>\n<p>结束了之后，过去加了微信。之后出去聊了会。主要是 SCA 社区和找工作上，还有怎么在开源和日常的工作之间均衡自己。学到了不少（铖朴大佬和我脑海中脑补的样子差不多。</p>\n<p>聊完了之后，<a href=\"https://www.pil0txia.com/\" target=\"_blank\" rel=\"noopener noreferrer\">@pil0txia</a> 来了，我说想和 Justin 去拍张照。但是不知道怎么开口。英语能听懂一些，但是说不出来，在 <a href=\"https://www.pil0txia.com/\" target=\"_blank\" rel=\"noopener noreferrer\">@pil0txia</a> 怂恿下，出去了外面。教了我几句，让我这样说。但是真不知道怎么开口（可能是头一次正式合外国人说话，说不出口。然后我准备这样说：<code>hi, justin, Can I take a photo with you, very happy to meet you.</code>。我还在想，<a href=\"https://www.pil0txia.com/\" target=\"_blank\" rel=\"noopener noreferrer\">@pil0txia</a> 已经拉着我过去了，有点局促。拍完之后，疯狂道谢然后跑开。🥲</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"和 justin 的合影\" src=\"https://yuluo-yx.github.io/assets/images/10-84f574047ad0e4c5f1ee46278f7f62f3.png\" width=\"2772\" height=\"2080\" class=\"img_c29J\"></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"latest\">latest<a href=\"https://yuluo-yx.github.io/blog/coca-2024#latest\" class=\"hash-link\" aria-label=\"latest的直接链接\" title=\"latest的直接链接\">​</a></h2>\n<p>最后，非常感谢铖朴（饶子昊）大佬的社区赞助票（就是没有搞到 Apache 的短袖，参会最遗憾的事情！！！</p>\n<p>感谢 Apache 基金会主办方的努力，将 CommunityOverCode 办的如此之好。希望下次有机会能够继续参与。也感谢我自己，努力成为 SCA 的 committer。能够认识铖朴，获得这次参会机会。</p>\n<p>热爱 Coding，热爱开源。一直希望能够在自己熟悉的领域留下一些东西。之后会继续参与开源，下一个目标成为 Apache committer，认识更多志同道合的人。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"余杭傍晚景色\" src=\"https://yuluo-yx.github.io/assets/images/13-78956921be753a72e926ddfbb0cba856.png\" width=\"2772\" height=\"2080\" class=\"img_c29J\"></p>\n<br>\n<div style=\"float:right\"><p>杭州余杭 2024/7/29</p></div>",
            "url": "https://yuluo-yx.github.io/blog/coca-2024",
            "title": "CocA 2024",
            "summary": "东方欲晓，早早起床。准备将这三天的 CommunityOverCode Asia 2024 的参会经历记录一下。也算是一次难得的经历，下次不知道到什么时候了。（PS：封面图来自 @pil0txia 的酒店外景。",
            "date_modified": "2024-07-28T22:13:42.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "Apache",
                "CocA"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/life-run",
            "content_html": "<p>   从 24 年的 5 月份开始到现在，从大学毕业的一系列琐事到现在身居余杭找工作的窘迫。无疑对我是一个巨大的挑战。之前已经找到了一个程序员的工作，但是因为一些特殊的原因。早早的就跑路了。事出有因，也不好再多叙述些什么，我更愿意相信这是命中注定的事情。因为在我的记忆中，每每到了毕业的时候，都会发生一件对我影响很大的事情。显然，这次毕业也不例外。</p>\n<p>  这段时间总是在找工作，看书，开源代码三件事情中循环往复，日子也一天天的过去。找工作的事情也没有任何进展，因为本身学历没有任何优势加之现在这个特殊的时间段，工作更难找了。</p>\n<p>  唯二能让我提起些兴趣的事情，除了代码就是看书。读了《活着》和《瓦尔登湖》。就我的感受来说，这两本书有着异曲同工之处。都在说一个人的人生。</p>\n<p>  《活着》中，余华老师以第三者的身份。从福贵的口中，了解了福贵的一生。从一个地主，历经各种人生经历到最后一个普通的种地人，历经磨难。福贵的一生，发人深省，人这一生到底要活出个什么样子来？这也是我在想的问题。我家在大西北，那里的人就总是想着考个有编制的工作，安安稳稳一辈子。包括我的父亲也是这种想法。我也时常在想，我到底想要怎么样的生活。大学学了四年的计算机，到大学毕业，怀着对计算机技术的满腔热血。直到如在今的计算机就业环境下找不到一个可以安身立命的工作。这段时间里也对自己产生了动摇。或许回家里老老实实考个老师的编制才是最好的选择。但是当一个平凡的老师，一辈子就这样下去。不是我想要的生活。学了几年计算机，心里也有一个计算机的执念，想创造些有价值的东西，能被许多人用的东西......</p>\n<p>  《瓦尔登湖》中作者以超然物外的精神状态，独居瓦尔登湖畔，和大自然为伴。探索生命的真谛，能够感受到作者内心的心无旁骛，宁静致远。以我现在的精神状态，犹不及也。现在总是内心充满烦躁......</p>\n<p>  每天的时间除了刷刷短视频，更多的时间花在了写代码上。这一个月，给 apache 的项目提了许多单元测试的 pr，当然不能纯粹的说是为了热爱开源，也夹带着一些私心，想混进去 Apache 社区，提升下自己的软实力。但是更多的是想留下一些自己的痕迹。</p>\n<p>  往后继续找工作......</p>\n<hr>\n<div style=\"float:right\">2024/07/24 杭州余杭</div>",
            "url": "https://yuluo-yx.github.io/blog/life-run",
            "title": "无题",
            "summary": "&emsp;&emsp; 从 24 年的 5 月份开始到现在，从大学毕业的一系列琐事到现在身居余杭找工作的窘迫。无疑对我是一个巨大的挑战。之前已经找到了一个程序员的工作，但是因为一些特殊的原因。早早的就跑路了。事出有因，也不好再多叙述些什么，我更愿意相信这是命中注定的事情。因为在我的记忆中，每每到了毕业的时候，都会发生一件对我影响很大的事情。显然，这次毕业也不例外。",
            "date_modified": "2024-07-24T22:28:38.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "随笔"
            ]
        },
        {
            "id": "https://yuluo-yx.github.io/blog/windows-deploy-ollama3-install-llama3",
            "content_html": "<blockquote>\n<p>部署中为了尽可能减少对本地环境的污染，使用 Docker 安装！</p>\n</blockquote>\n<p>github: <a href=\"https://github.com/ollama/ollama\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/ollama/ollama</a></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"准备部署文件\">准备部署文件<a href=\"https://yuluo-yx.github.io/blog/windows-deploy-ollama3-install-llama3#%E5%87%86%E5%A4%87%E9%83%A8%E7%BD%B2%E6%96%87%E4%BB%B6\" class=\"hash-link\" aria-label=\"准备部署文件的直接链接\" title=\"准备部署文件的直接链接\">​</a></h2>\n<div class=\"language-yml codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-yml codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">version</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'3.8'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">services</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">ollama</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">volumes</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\"> ./models</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\">/root/.ollama  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 将本地文件夹挂载到容器中的 /root/.ollama 目录 （模型下载位置）</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">container_name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> ollama</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">pull_policy</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> always</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">tty</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:hsl(230, 8%, 24%);font-weight:bold\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">restart</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> unless</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\">stopped</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">image</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> ollama/ollama</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">ports</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\"> 11434</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">11434</span><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># Ollama API 端口</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">   </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">open-webui</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">build</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">context</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> .</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">args</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">         </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">OLLAMA_BASE_URL</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'/ollama'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">dockerfile</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> Dockerfile</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">image</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> ghcr.io/open</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\">webui/open</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\">webui</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\">main</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">container_name</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> open</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\">webui</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">volumes</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\"> ./open</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\">webui</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\">/app/backend/data  </span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># 前端页面数据挂载位置</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">depends_on</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\"> ollama</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">ports</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">{</span><span class=\"token plain\">OPEN_WEBUI_PORT</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">3005</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">}</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">8080</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">environment</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'OLLAMA_BASE_URL=http://ollama:11434'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'WEBUI_SECRET_KEY='</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">extra_hosts</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">       </span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\"> host.docker.internal</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\">host</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\">gateway</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">     </span><span class=\"token key atrule\" style=\"color:hsl(35, 99%, 36%)\">restart</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">:</span><span class=\"token plain\"> unless</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">-</span><span class=\"token plain\">stopped</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>之后使用 <code>docker compose up -d</code> 等待一段时间之后，docker images pull 成功。即可执行下一步。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"下载-llm-模型\">下载 LLM 模型<a href=\"https://yuluo-yx.github.io/blog/windows-deploy-ollama3-install-llama3#%E4%B8%8B%E8%BD%BD-llm-%E6%A8%A1%E5%9E%8B\" class=\"hash-link\" aria-label=\"下载 LLM 模型的直接链接\" title=\"下载 LLM 模型的直接链接\">​</a></h2>\n<p>LLM 模型参考：</p>\n<table><thead><tr><th><strong>Model</strong></th><th><strong>Parameters</strong></th><th><strong>Size</strong></th><th><strong>Download</strong></th></tr></thead><tbody><tr><td>Llama 3</td><td>8B</td><td>4.7GB</td><td><code>ollama run llama3</code></td></tr><tr><td>qwen</td><td>4b</td><td>2.3G</td><td><code>ollama run qwen:4b</code></td></tr><tr><td>Llama 3</td><td>70B</td><td>40GB</td><td><code>ollama run llama3:70b</code></td></tr><tr><td>Phi-3</td><td>3,8B</td><td>2.3GB</td><td><code>ollama run phi3</code></td></tr><tr><td>Mistral</td><td>7B</td><td>4.1GB</td><td><code>ollama run mistral</code></td></tr><tr><td>Neural Chat</td><td>7B</td><td>4.1GB</td><td><code>ollama run neural-chat</code></td></tr><tr><td>Starling</td><td>7B</td><td>4.1GB</td><td><code>ollama run starling-lm</code></td></tr><tr><td>Code Llama</td><td>7B</td><td>3.8GB</td><td><code>ollama run codellama</code></td></tr><tr><td>Llama 2 Uncensored</td><td>7B</td><td>3.8GB</td><td><code>ollama run llama2-uncensored</code></td></tr><tr><td>LLaVA</td><td>7B</td><td>4.5GB</td><td><code>ollama run llava</code></td></tr><tr><td>Gemma</td><td>2B</td><td>1.4GB</td><td><code>ollama run gemma:2b</code></td></tr><tr><td>Gemma</td><td>7B</td><td>4.8GB</td><td><code>ollama run gemma:7b</code></td></tr><tr><td>Solar</td><td>10.7B</td><td>6.1GB</td><td><code>ollama run solar</code></td></tr></tbody></table>\n<p>这里选择最小体积且最好用的模型： llama3:4b 模型，qwen:4b 模型质量很差。</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">ollama3 run llama3</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>成功之后会看到下面这样：</p>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">root@c5e5ff20a533:/</span><span class=\"token comment\" style=\"color:hsl(230, 4%, 64%)\"># ollama run llama3</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">pulling manifest </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">pulling 6a0746a1ec1a</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">..</span><span class=\"token plain\">. </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token plain\">% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████▏ </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">4.7</span><span class=\"token plain\"> GB                         </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">pulling 4fa551d4f938</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">..</span><span class=\"token plain\">. </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token plain\">% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████▏  </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">12</span><span class=\"token plain\"> KB                         </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">pulling 8ab4849b038c</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">..</span><span class=\"token plain\">. </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token plain\">% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████▏  </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">254</span><span class=\"token plain\"> B                         </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">pulling 577073ffcc6c</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">..</span><span class=\"token plain\">. </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token plain\">% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████▏  </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">110</span><span class=\"token plain\"> B                         </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">pulling 3f8eb4da87fa</span><span class=\"token punctuation\" style=\"color:hsl(119, 34%, 47%)\">..</span><span class=\"token plain\">. </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">100</span><span class=\"token plain\">% ▕██████████████████████████████████████████████████████████████████████████████████████████████████████████▏  </span><span class=\"token number\" style=\"color:hsl(35, 99%, 36%)\">485</span><span class=\"token plain\"> B                         </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">verifying sha256 digest </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">writing manifest </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">removing any unused layers </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">success </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;&gt;</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\"> 你好</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">💖 你好！我很高兴地看到你的消息！ 😊</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;&gt;</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">&gt;</span><span class=\"token plain\"> 你能介绍下自己吗</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">😊 I</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'d be happy to introduce myself.</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">My name is LLaMA, and I'</span><span class=\"token plain\">m a large language model trained by Meta AI. I</span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'m a computer program designed to understand and generate human-like text, so we can have </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">conversations like this one! 🤖</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">I was trained on a massive dataset of text from the internet, which allows me to learn about various topics, including history, science, culture, and more. This </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">training enables me to answer questions, provide information, and even engage in creative writing or storytelling.</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">As a conversational AI, my goal is to assist and entertain users like you. I'</span><span class=\"token plain\">m designed to be helpful, friendly, and respectful, so please feel </span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">free</span><span class=\"token plain\"> to ask me </span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\">anything or share your thoughts with me</span><span class=\"token operator\" style=\"color:hsl(221, 87%, 60%)\">!</span><span class=\"token plain\"> 💬</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>下载后的模型将被挂载到在 <code>./models</code> 文件中。</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"访问\">访问<a href=\"https://yuluo-yx.github.io/blog/windows-deploy-ollama3-install-llama3#%E8%AE%BF%E9%97%AE\" class=\"hash-link\" aria-label=\"访问的直接链接\" title=\"访问的直接链接\">​</a></h2>\n<p>上面已经介绍了一种访问方式，通过 run 的方式。下面介绍通过 web ui 和 api 的方式访问。</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"api\">API<a href=\"https://yuluo-yx.github.io/blog/windows-deploy-ollama3-install-llama3#api\" class=\"hash-link\" aria-label=\"API的直接链接\" title=\"API的直接链接\">​</a></h3>\n<div class=\"language-shell codeBlockContainer_APcc theme-code-block\" style=\"--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)\"><div class=\"codeBlockContent_m3Ux\"><pre class=\"prism-code language-shell codeBlock_qGQc thin-scrollbar\" style=\"background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)\"><code class=\"codeBlockLines_p187\"><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">curl</span><span class=\"token plain\"> http://localhost:11434/api/generate </span><span class=\"token parameter variable\" style=\"color:hsl(221, 87%, 60%)\">-d</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'{</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">    \"model\":\"llama3\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">    \"prompt\": \"请分别翻译成中文、韩文、日文 -&gt; Meta Llama 3: The most capable openly available LLM to date\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">    \"stream\": false</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">}'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token plain\"></span><span class=\"token function\" style=\"color:hsl(221, 87%, 60%)\">curl</span><span class=\"token plain\"> http://localhost:11434/api/chat </span><span class=\"token parameter variable\" style=\"color:hsl(221, 87%, 60%)\">-d</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">'{</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">  \"model\": \"llama3\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">  \"messages\": [</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">    {</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">      \"role\": \"user\",</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">      \"content\": \"why is the sky blue?\"</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">    }</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">  ],</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">  \"stream\": true</span><br></span><span class=\"token-line\" style=\"color:hsl(230, 8%, 24%)\"><span class=\"token string\" style=\"color:hsl(119, 34%, 47%)\">}'</span><br></span></code></pre><div class=\"buttonGroup_6DOT\"><button type=\"button\" aria-label=\"复制代码到剪贴板\" title=\"复制\" class=\"clean-btn\"><span class=\"copyButtonIcons_FhaS\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_phi_\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_FfTR\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_vMh4\" id=\"web-ui\">Web ui<a href=\"https://yuluo-yx.github.io/blog/windows-deploy-ollama3-install-llama3#web-ui\" class=\"hash-link\" aria-label=\"Web ui的直接链接\" title=\"Web ui的直接链接\">​</a></h3>\n<p>浏览器访问 localhost:3005即可。</p>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"image-20240718162933068\" src=\"https://yuluo-yx.github.io/assets/images/ai-1-82e6e30934bba3b6abb8965c0b94c749.png\" width=\"1237\" height=\"472\" class=\"img_c29J\"></p>",
            "url": "https://yuluo-yx.github.io/blog/windows-deploy-ollama3-install-llama3",
            "title": "Windows 电脑部署 ollama3 并安装 llama3",
            "summary": "部署中为了尽可能减少对本地环境的污染，使用 Docker 安装！",
            "date_modified": "2024-07-18T16:36:22.000Z",
            "author": {
                "name": "牧生",
                "url": "https://github.com/yuluo-yx"
            },
            "tags": [
                "windows",
                "AI"
            ]
        }
    ]
}